<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="第二十一章 数组 在 初始化和清理 一章的最后，你已经学过如何定义和初始化一个数组。  简单来看，数组需要你去创建和初始化，你可以通过下标对数组元素进行访问，数组的大小不会改变。大多数时候你只需要知道这些，但有时候你必须在数组上进行更复杂的操作，你也可能需要在数组和更加灵活的 集合 (Collection)之间做出评估。因此本章我们将对数组进行更加深入的分析。 注意： 随着 Java Colle">
<meta property="og:type" content="article">
<meta property="og:title" content="第二十一章 数组">
<meta property="og:url" content="http://yoursite.com/2019/07/01/3/3_book/OnJava8/21-Arrays/index.html">
<meta property="og:site_name" content="水门的博客">
<meta property="og:description" content="第二十一章 数组 在 初始化和清理 一章的最后，你已经学过如何定义和初始化一个数组。  简单来看，数组需要你去创建和初始化，你可以通过下标对数组元素进行访问，数组的大小不会改变。大多数时候你只需要知道这些，但有时候你必须在数组上进行更复杂的操作，你也可能需要在数组和更加灵活的 集合 (Collection)之间做出评估。因此本章我们将对数组进行更加深入的分析。 注意： 随着 Java Colle">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-03-21T10:13:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第二十一章 数组">
<meta name="twitter:description" content="第二十一章 数组 在 初始化和清理 一章的最后，你已经学过如何定义和初始化一个数组。  简单来看，数组需要你去创建和初始化，你可以通过下标对数组元素进行访问，数组的大小不会改变。大多数时候你只需要知道这些，但有时候你必须在数组上进行更复杂的操作，你也可能需要在数组和更加灵活的 集合 (Collection)之间做出评估。因此本章我们将对数组进行更加深入的分析。 注意： 随着 Java Colle">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/07/01/3/3_book/OnJava8/21-Arrays/">





  <title>第二十一章 数组 | 水门的博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">水门的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/01/3/3_book/OnJava8/21-Arrays/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kay wu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="水门的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第二十一章 数组</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-01T00:00:02+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  19.9k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <!-- Arrays -->
<h1 id="第二十一章-数组"><a href="#第二十一章-数组" class="headerlink" title="第二十一章 数组"></a>第二十一章 数组</h1><blockquote>
<p>在 <a href="book/06-Housekeeping.md">初始化和清理</a> 一章的最后，你已经学过如何定义和初始化一个数组。</p>
</blockquote>
<p>简单来看，数组需要你去创建和初始化，你可以通过下标对数组元素进行访问，数组的大小不会改变。大多数时候你只需要知道这些，但有时候你必须在数组上进行更复杂的操作，你也可能需要在数组和更加灵活的 <strong>集合</strong> (Collection)之间做出评估。因此本章我们将对数组进行更加深入的分析。</p>
<p><strong>注意：</strong> 随着 Java Collection 和 Stream 类中高级功能的不断增加，日常编程中使用数组的需求也在变少，所以你暂且可以放心地略读甚至跳过这一章。但是，即使你自己避免使用数组，也总会有需要阅读别人数组代码的那一天。那时候，本章依然在这里等着你来翻阅。</p>
<!-- Why Arrays are Special -->
<h2 id="数组特性"><a href="#数组特性" class="headerlink" title="数组特性"></a>数组特性</h2><p>明明还有很多其他的办法来保存对象，那么是什么令数组如此特别？</p>
<p>将数组和其他类型的集合区分开来的原因有三：效率，类型，保存基本数据类型的能力。在 Java 中，使用数组存储和随机访问对象引用序列是非常高效的。数组是简单的线性序列，这使得对元素的访问变得非常快。然而这种高速也是有代价的，代价就是数组对象的大小是固定的，且在该数组的生存期内不能更改。</p>
<p>速度通常并不是问题，如果有问题，你保存和检索对象的方式也很少是罪魁祸首。你应该总是从 <strong>ArrayList</strong> (来自 <a href="book/12-Collections.md">集合</a>)开始，它将数组封装起来。必要时，它会自动分配更多的数组空间，创建新数组，并将旧数组中的引用移动到新数组。这种灵活性需要开销，所以一个 <strong>ArrayList</strong> 的效率不如数组。在极少的情况下效率会成为问题，所以这种时候你可以直接使用数组。</p>
<p>数组和集合(Collections)都不能滥用。不管你使用数组还是集合，如果你越界，你都会得到一个 <strong>RuntimeException</strong> 的异常提醒，这表明你的程序中存在错误。</p>
<p>在泛型前，其他的集合类以一种宽泛的方式处理对象（就好像它们没有特定类型一样）。事实上，这些集合类把保存对象的类型默认为 <strong>Object</strong>，也就是 Java 中所有类的基类。而数组是优于 <strong>预泛型</strong> (pre-generic)集合类的，因为你创建一个数组就可以保存特定类型的数据。这意味着你获得了一个编译时的类型检查，而这可以防止你插入错误的数据类型，或者搞错你正在提取的数据类型。</p>
<p>当然，不管在编译时还是运行时，Java都会阻止你犯向对象发送不正确消息的错误。然而不管怎样，使用数组都不会有更大的风险。比较好的地方在于，如果编译器报错，最终的用户更容易理解抛出异常的含义。</p>
<p>一个数组可以保存基本数据类型，而一个预泛型的集合不可以。然而对于泛型而言，集合可以指定和检查他们保存对象的类型，而通过 <strong>自动装箱</strong> (autoboxing)机制，集合表现地就像它们可以保存基本数据类型一样，因为这种转换是自动的。</p>
<p>下面给出一例用于比较数组和泛型集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/CollectionComparison.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BerylliumSphere</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Sphere "</span> + id;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionComparison</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    BerylliumSphere[] spheres =</span><br><span class="line">      <span class="keyword">new</span> BerylliumSphere[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">      spheres[i] = <span class="keyword">new</span> BerylliumSphere();</span><br><span class="line">    show(spheres);</span><br><span class="line">    System.out.println(spheres[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    List&lt;BerylliumSphere&gt; sphereList = Suppliers.create(</span><br><span class="line">      ArrayList::<span class="keyword">new</span>, BerylliumSphere::<span class="keyword">new</span>, <span class="number">5</span>);</span><br><span class="line">    System.out.println(sphereList);</span><br><span class="line">    System.out.println(sphereList.get(<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] integers = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    show(integers);</span><br><span class="line">    System.out.println(integers[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    List&lt;Integer&gt; intList = <span class="keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">      Arrays.asList(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">    intList.add(<span class="number">97</span>);</span><br><span class="line">    System.out.println(intList);</span><br><span class="line">    System.out.println(intList.get(<span class="number">4</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Sphere 0, Sphere 1, Sphere 2, Sphere 3, Sphere 4,</span></span><br><span class="line"><span class="comment">null, null, null, null, null]</span></span><br><span class="line"><span class="comment">Sphere 4</span></span><br><span class="line"><span class="comment">[Sphere 5, Sphere 6, Sphere 7, Sphere 8, Sphere 9]</span></span><br><span class="line"><span class="comment">Sphere 9</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 97]</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Suppliers.create()</strong> 方法在<a href="book/20-Generics.md">泛型</a>一章中被定义。上面两种保存对象的方式都是有类型检查的，唯一比较明显的区别就是数组使用 <strong>[ ]</strong> 来随机存取元素，而一个 <strong>List</strong> 使用诸如 <code>add()</code> 和 <code>get()</code> 等方法。数组和 <strong>ArrayList</strong> 之间的相似是设计者有意为之，所以在概念上，两者很容易切换。但是就像你在<a href="book/12-Collections.md">集合</a>中看到的，集合的功能明显多于数组。随着 Java 自动装箱技术的出现，通过集合使用基本数据类型几乎和通过数组一样简单。数组唯一剩下的优势就是效率。然而，当你解决一个更加普遍的问题时，数组可能限制太多，这种情形下，您可以使用集合类。</p>
<h3 id="用于显示数组的实用程序"><a href="#用于显示数组的实用程序" class="headerlink" title="用于显示数组的实用程序"></a>用于显示数组的实用程序</h3><p>在本章中，我们处处都要显示数组。Java 提供了 <strong>Arrays.toString()</strong> 来将数组转换为可读字符串，然后可以在控制台上显示。然而这种方式视觉上噪音太大，所以我们创建一个小的库来完成这项工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/ArrayShow.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ArrayShow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(Object[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">boolean</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">byte</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">char</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">short</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">long</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">float</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">double</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Start with a description:</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, Object[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">boolean</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">byte</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">char</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">short</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">int</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">long</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">float</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String info, <span class="keyword">double</span>[] a)</span> </span>&#123;</span><br><span class="line">    System.out.print(info + <span class="string">": "</span>);</span><br><span class="line">    show(a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个方法适用于对象数组，包括那些包装基本数据类型的数组。所有的方法重载对于不同的数据类型是必要的。</p>
<p>第二组重载方法可以让你显示带有信息 <strong>字符串</strong> 前缀的数组。</p>
<p>为了简单起见，你通常可以静态地导入它们。</p>
<!-- Arrays are First-Class Objects -->
<h2 id="一等对象"><a href="#一等对象" class="headerlink" title="一等对象"></a>一等对象</h2><p>不管你使用的什么类型的数组，数组中的数据集实际上都是对堆中真正对象的引用。数组是保存指向其他对象的引用的对象，数组可以隐式地创建，作为数组初始化语法的一部分，也可以显式地创建，比如使用一个 <strong>new</strong> 表达式。数组对象的一部分（事实上，你唯一可以使用的方法）就是只读的 <strong>length</strong> 成员函数，它能告诉你数组对象中可以存储多少元素。<strong>[ ]</strong> 语法是你访问数组对象的唯一方式。</p>
<p>下面的例子总结了初始化数组的多种方式，并且展示了如何给不同的数组对象分配数组引用。同时也可以看出对象数组和基元数组在使用上是完全相同的。唯一的不同之处就是对象数组存储的是对象的引用，而基元数组则直接存储基本数据类型的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ArrayOptions.java</span></span><br><span class="line"><span class="comment">// Initialization &amp; re-assignment of arrays</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOptions</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Arrays of objects:</span></span><br><span class="line">    BerylliumSphere[] a; <span class="comment">// Uninitialized local</span></span><br><span class="line">    BerylliumSphere[] b = <span class="keyword">new</span> BerylliumSphere[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The references inside the array are</span></span><br><span class="line">    <span class="comment">// automatically initialized to null:</span></span><br><span class="line">    show(<span class="string">"b"</span>, b);</span><br><span class="line">    BerylliumSphere[] c = <span class="keyword">new</span> BerylliumSphere[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; c.length; i++)</span><br><span class="line">      <span class="keyword">if</span>(c[i] == <span class="keyword">null</span>) <span class="comment">// Can test for null reference</span></span><br><span class="line">        c[i] = <span class="keyword">new</span> BerylliumSphere();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Aggregate initialization:</span></span><br><span class="line">    BerylliumSphere[] d = &#123;</span><br><span class="line">      <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">      <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">      <span class="keyword">new</span> BerylliumSphere()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dynamic aggregate initialization:</span></span><br><span class="line">    a = <span class="keyword">new</span> BerylliumSphere[]&#123;</span><br><span class="line">      <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// (Trailing comma is optional)</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"a.length = "</span> + a.length);</span><br><span class="line">    System.out.println(<span class="string">"b.length = "</span> + b.length);</span><br><span class="line">    System.out.println(<span class="string">"c.length = "</span> + c.length);</span><br><span class="line">    System.out.println(<span class="string">"d.length = "</span> + d.length);</span><br><span class="line">    a = d;</span><br><span class="line">    System.out.println(<span class="string">"a.length = "</span> + a.length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Arrays of primitives:</span></span><br><span class="line">    <span class="keyword">int</span>[] e; <span class="comment">// Null reference</span></span><br><span class="line">    <span class="keyword">int</span>[] f = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The primitives inside the array are</span></span><br><span class="line">    <span class="comment">// automatically initialized to zero:</span></span><br><span class="line">    show(<span class="string">"f"</span>, f);</span><br><span class="line">    <span class="keyword">int</span>[] g = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g.length; i++)</span><br><span class="line">      g[i] = i*i;</span><br><span class="line">    <span class="keyword">int</span>[] h = &#123; <span class="number">11</span>, <span class="number">47</span>, <span class="number">93</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  Compile error: variable e not initialized:</span></span><br><span class="line">    <span class="comment">//- System.out.println("e.length = " + e.length);</span></span><br><span class="line">    System.out.println(<span class="string">"f.length = "</span> + f.length);</span><br><span class="line">    System.out.println(<span class="string">"g.length = "</span> + g.length);</span><br><span class="line">    System.out.println(<span class="string">"h.length = "</span> + h.length);</span><br><span class="line">    e = h;</span><br><span class="line">    System.out.println(<span class="string">"e.length = "</span> + e.length);</span><br><span class="line">    e = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123; <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">    System.out.println(<span class="string">"e.length = "</span> + e.length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">b: [null, null, null, null, null]</span></span><br><span class="line"><span class="comment">a.length = 2</span></span><br><span class="line"><span class="comment">b.length = 5</span></span><br><span class="line"><span class="comment">c.length = 4</span></span><br><span class="line"><span class="comment">d.length = 3</span></span><br><span class="line"><span class="comment">a.length = 3</span></span><br><span class="line"><span class="comment">f: [0, 0, 0, 0, 0]</span></span><br><span class="line"><span class="comment">f.length = 5</span></span><br><span class="line"><span class="comment">g.length = 4</span></span><br><span class="line"><span class="comment">h.length = 3</span></span><br><span class="line"><span class="comment">e.length = 3</span></span><br><span class="line"><span class="comment">e.length = 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>数组 <strong>a</strong> 是一个未初始化的本地变量，编译器不会允许你使用这个引用直到你正确地对其进行初始化。数组 <strong>b</strong> 被初始化成一系列指向 <strong>BerylliumSphere</strong> 对象的引用，但是并没有真正的 <strong>BerylliumSphere</strong> 对象被存储在数组中。尽管你仍然可以获得这个数组的大小，因为 <strong>b</strong> 指向合法对象。这带来了一个小问题：你无法找出到底有多少元素存储在数组中，因为 <strong>length</strong> 只能告诉你数组可以存储多少元素；这就是说，数组对象的大小并不是真正存储在数组中对象的个数。然而，当你创建一个数组对象，其引用将自动初始化为 <strong>null</strong>，因此你可以通过检查特定数组元素中的引用是否为 <strong>null</strong> 来判断其中是否有对象。基元数组也有类似的机制，比如自动将数值类型初始化为 <strong>0</strong>，char 型初始化为 <strong>(char)0</strong>，布尔类型初始化为 <strong>false</strong>。</p>
<p>数组 <strong>c</strong> 展示了创建数组对象后给数组中各元素分配 <strong>BerylliumSphere</strong> 对象。数组 <strong>d</strong> 展示了创建数组对象的聚合初始化语法（隐式地使用 <strong>new</strong> 在堆中创建对象，就像 <strong>c</strong> 一样）并且初始化成 <strong>BeryliumSphere</strong> 对象，这一切都在一条语句中完成。</p>
<p>下一个数组初始化可以被看做是一个“动态聚合初始化”。 <strong>d</strong> 使用的聚合初始化必须在 <strong>d</strong> 定义处使用，但是使用第二种语法，你可以在任何地方创建和初始化数组对象。例如，假设 <strong>hide()</strong> 是一个需要使用一系列的 <strong>BeryliumSphere</strong>对象。你可以这样调用它：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hide(d);</span><br></pre></td></tr></table></figure>
<p>你也可以动态地创建你用作参数传递的数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hide(<span class="keyword">new</span> BerylliumSphere[]&#123;</span><br><span class="line">    <span class="keyword">new</span> BerlliumSphere(),</span><br><span class="line">    <span class="keyword">new</span> BerlliumSphere()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>很多情况下这种语法写代码更加方便。</p>
<p>表达式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = d;</span><br></pre></td></tr></table></figure>
<p>显示了你如何获取指向一个数组对象的引用并将其分配给另一个数组对象。就像你可以处理其他类型的对象引用。现在 <strong>a</strong> 和 <strong>d</strong> 都指向了堆中的同一个数组对象。</p>
<p><strong>ArrayOptions.java</strong> 的第二部分展示了基元数组的语法就像对象数组一样，除了基元数组直接保存基本数据类型的值。</p>
<!-- Returning an Array -->
<h2 id="返回数组"><a href="#返回数组" class="headerlink" title="返回数组"></a>返回数组</h2><p>假设你写了一个方法，这个方法不是返回一个元素，而是返回多个元素。对 C++/C 这样的语言来说这是很困难的，因为你无法返回一个数组，只能是返回一个指向数组的指针。这会带来一些问题，因为对数组生存期的控制变得很混乱，这会导致内存泄露。</p>
<p>而在 Java 中，你只需返回数组，你永远不用为数组担心，只要你需要它，它就可用，垃圾收集器会在你用完后把它清理干净。</p>
<p>下面，我们返回一个 <strong>字符串</strong> 数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/IceCreamFlavors.java</span></span><br><span class="line"><span class="comment">// Returning arrays from methods</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCreamFlavors</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> SplittableRandom rand =</span><br><span class="line">    <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> String[] FLAVORS = &#123;</span><br><span class="line">    <span class="string">"Chocolate"</span>, <span class="string">"Strawberry"</span>, <span class="string">"Vanilla Fudge Swirl"</span>,</span><br><span class="line">    <span class="string">"Mint Chip"</span>, <span class="string">"Mocha Almond Fudge"</span>, <span class="string">"Rum Raisin"</span>,</span><br><span class="line">    <span class="string">"Praline Cream"</span>, <span class="string">"Mud Pie"</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String[] flavorSet(<span class="keyword">int</span> n) &#123;</span><br><span class="line">    <span class="keyword">if</span>(n &gt; FLAVORS.length)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Set too big"</span>);</span><br><span class="line">    String[] results = <span class="keyword">new</span> String[n];</span><br><span class="line">    <span class="keyword">boolean</span>[] picked = <span class="keyword">new</span> <span class="keyword">boolean</span>[FLAVORS.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">int</span> t;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        t = rand.nextInt(FLAVORS.length);</span><br><span class="line">      <span class="keyword">while</span>(picked[t]);</span><br><span class="line">      results[i] = FLAVORS[t];</span><br><span class="line">      picked[t] = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">      show(flavorSet(<span class="number">3</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[Praline Cream, Mint Chip, Vanilla Fudge Swirl]</span></span><br><span class="line"><span class="comment">[Strawberry, Vanilla Fudge Swirl, Mud Pie]</span></span><br><span class="line"><span class="comment">[Chocolate, Strawberry, Vanilla Fudge Swirl]</span></span><br><span class="line"><span class="comment">[Rum Raisin, Praline Cream, Chocolate]</span></span><br><span class="line"><span class="comment">[Mint Chip, Rum Raisin, Mocha Almond Fudge]</span></span><br><span class="line"><span class="comment">[Mocha Almond Fudge, Mud Pie, Vanilla Fudge Swirl]</span></span><br><span class="line"><span class="comment">[Mocha Almond Fudge, Mud Pie, Mint Chip]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>flavorset()</strong> 创建名为 <strong>results</strong> 的 <strong>String</strong> 类型的数组。 这个数组的大小 <strong>n</strong> 取决于你传进方法的参数。然后从数组 <strong>FLAVORS</strong> 中随机选择 flavors 并且把它们放进 <strong>results</strong> 里并返回。返回一个数组就像返回其他任何对象一样，实际上返回的是引用。数组是在 <strong>flavorSet()</strong> 中或者是在其他什么地方创建的并不重要。垃圾收集器会清理你用完的数组，你需要的数组则会保留。</p>
<p>如果你必须要返回一系列不同类型的元素，你可以使用 <a href="book/20-Generics.md">泛型</a> 中介绍的 <strong>元组</strong> 。</p>
<p>注意，当 <strong>flavorSet()</strong> 随机选择 flavors，它应该确保某个特定的选项没被选中。这在一个 <strong>do</strong> 循环中执行，它将一直做出随机选择直到它发现一个元素不在 <strong>picked</strong> 数组中。（一个字符串</p>
<p>比较将显示出随机选中的元素是不是已经存在于 <strong>results</strong> 数组中）。如果成功了，它将添加条目并且寻找下一个（ <strong>i</strong> 递增）。输出结果显示 <strong>flavorSet()</strong> 每一次都是按照随机顺序选择 flavors。</p>
<p>一直到现在，随机数都是通过 <strong>java.util.Random</strong> 类生成的，这个类从 Java 1.0 就有，甚至更新过以提供 Java 8 流。现在我们可以介绍 Java 8 中的 <strong>SplittableRandom</strong> ,它不仅能在并行操作使用（你最终会学到），而且提供了一个高质量的随机数。这本书的剩余部分都使用  <strong>SplittableRandom</strong> 。</p>
<!-- Multidimensional Arrays -->
<h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><p>要创建多维的基元数组，你要用大括号来界定数组中的向量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/MultidimensionalPrimitiveArray.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultidimensionalPrimitiveArray</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[][] a = &#123;</span><br><span class="line">      &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, &#125;,</span><br><span class="line">      &#123; <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(Arrays.deepToString(a));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[1, 2, 3], [4, 5, 6]]</span></span><br><span class="line"><span class="comment">*/</span>。</span><br></pre></td></tr></table></figure>
<p>每个嵌套的大括号都代表了数组的一个维度。</p>
<p>这个例子使用 <strong>Arrays.deepToString()</strong> 方法，将多维数组转换成 <strong>String</strong> 类型，就像输出中显示的那样。</p>
<p>你也可以使用 <strong>new</strong> 分配数组。这是一个使用 <strong>new</strong> 表达式分配的三维数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ThreeDWithNew.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeDWithNew</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 3-D array with fixed length:</span></span><br><span class="line">    <span class="keyword">int</span>[][][] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">2</span>][<span class="number">4</span>];</span><br><span class="line">    System.out.println(Arrays.deepToString(a));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0,</span></span><br><span class="line"><span class="comment">0]]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>倘若你不对基元数组进行显式的初始化，它的值会自动初始化。而对象数组将被初始化为 <strong>null</strong> 。</p>
<p>组成矩阵的数组中每一个向量都可以是任意长度的（这叫做不规则数组）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/RaggedArray.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RaggedArray</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> val = <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SplittableRandom rand = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="comment">// 3-D array with varied-length vectors:</span></span><br><span class="line">    <span class="keyword">int</span>[][][] a = <span class="keyword">new</span> <span class="keyword">int</span>[rand.nextInt(<span class="number">7</span>)][][];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">      a[i] = <span class="keyword">new</span> <span class="keyword">int</span>[rand.nextInt(<span class="number">5</span>)][];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a[i].length; j++) &#123;</span><br><span class="line">        a[i][j] = <span class="keyword">new</span> <span class="keyword">int</span>[rand.nextInt(<span class="number">5</span>)];</span><br><span class="line">        Arrays.setAll(a[i][j], n -&gt; val++); <span class="comment">// [1]</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(Arrays.deepToString(a));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[[1], []], [[2, 3, 4, 5], [6]], [[7, 8, 9], [10, 11,</span></span><br><span class="line"><span class="comment">12], []]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>第一个 <strong>new</strong> 创建了一个数组，这个数组首元素长度随机，其余的则不确定。第二个 <strong>new</strong> 在 for 循环中给数组填充了第二个元素，第三个 <strong>new</strong>  为数组的最后一个索引填充元素。</p>
<ul>
<li><strong>[1]</strong> Java 8 增加了 <strong>Arrays.setAll()</strong> 方法,其使用生成器来生成插入数组中的值。此生成器符合函数式接口 <strong>IntUnaryOperator</strong> ，只使用一个非 <strong>默认</strong> 的方法 <strong>ApplyAsint(int操作数)</strong> 。 <strong>Arrays.setAll()</strong> 传递当前数组索引作为操作数，因此一个选项是提供 <strong>n -&gt; n</strong> 的 lambda 表达式来显示数组的索引（在上面的代码中很容易尝试）。这里，我们忽略索引，只是插入递增计数器的值。</li>
</ul>
<p>非基元的对象数组也可以定义为不规则数组。这里，我们收集了许多使用大括号的 <strong>new</strong> 表达式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/MultidimensionalObjectArrays.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultidimensionalObjectArrays</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    BerylliumSphere[][] spheres = &#123;</span><br><span class="line">      &#123; <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere() &#125;,</span><br><span class="line">      &#123; <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">        <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere() &#125;,</span><br><span class="line">      &#123; <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">        <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">        <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere(),</span><br><span class="line">        <span class="keyword">new</span> BerylliumSphere(), <span class="keyword">new</span> BerylliumSphere() &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(Arrays.deepToString(spheres));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[Sphere 0, Sphere 1], [Sphere 2, Sphere 3, Sphere 4,</span></span><br><span class="line"><span class="comment">Sphere 5], [Sphere 6, Sphere 7, Sphere 8, Sphere 9,</span></span><br><span class="line"><span class="comment">Sphere 10, Sphere 11, Sphere 12, Sphere 13]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>数组初始化时使用自动装箱技术：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/AutoboxingArrays.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoboxingArrays</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer[][] a = &#123; <span class="comment">// Autoboxing:</span></span><br><span class="line">      &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span> &#125;,</span><br><span class="line">      &#123; <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span> &#125;,</span><br><span class="line">      &#123; <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span> &#125;,</span><br><span class="line">      &#123; <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(Arrays.deepToString(a));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[1, 2, 3, 4, 5, 6, 7, 8, 9, 10], [21, 22, 23, 24, 25,</span></span><br><span class="line"><span class="comment">26, 27, 28, 29, 30], [51, 52, 53, 54, 55, 56, 57, 58,</span></span><br><span class="line"><span class="comment">59, 60], [71, 72, 73, 74, 75, 76, 77, 78, 79, 80]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>以下是如何逐个构建非基元的对象数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/AssemblingMultidimensionalArrays.java</span></span><br><span class="line"><span class="comment">// Creating multidimensional arrays</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssemblingMultidimensionalArrays</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer[][] a;</span><br><span class="line">    a = <span class="keyword">new</span> Integer[<span class="number">3</span>][];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">      a[i] = <span class="keyword">new</span> Integer[<span class="number">3</span>];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a[i].length; j++)</span><br><span class="line">        a[i][j] = i * j; <span class="comment">// Autoboxing</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(Arrays.deepToString(a));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[[0, 0, 0], [0, 1, 2], [0, 2, 4]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>i * j</strong> 在这里只是为了向 <strong>Integer</strong> 中添加有趣的值。</p>
<p><strong>Arrays.deepToString()</strong> 方法同时适用于基元数组和对象数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/MultiDimWrapperArray.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"><span class="comment">// Multidimensional arrays of "wrapper" objects</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiDimWrapperArray</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer[][] a1 = &#123; <span class="comment">// Autoboxing</span></span><br><span class="line">      &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, &#125;,</span><br><span class="line">      &#123; <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    Double[][][] a2 = &#123; <span class="comment">// Autoboxing</span></span><br><span class="line">      &#123; &#123; <span class="number">1.1</span>, <span class="number">2.2</span> &#125;, &#123; <span class="number">3.3</span>, <span class="number">4.4</span> &#125; &#125;,</span><br><span class="line">      &#123; &#123; <span class="number">5.5</span>, <span class="number">6.6</span> &#125;, &#123; <span class="number">7.7</span>, <span class="number">8.8</span> &#125; &#125;,</span><br><span class="line">      &#123; &#123; <span class="number">9.9</span>, <span class="number">1.2</span> &#125;, &#123; <span class="number">2.3</span>, <span class="number">3.4</span> &#125; &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    String[][] a3 = &#123;</span><br><span class="line">      &#123; <span class="string">"The"</span>, <span class="string">"Quick"</span>, <span class="string">"Sly"</span>, <span class="string">"Fox"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"Jumped"</span>, <span class="string">"Over"</span> &#125;,</span><br><span class="line">      &#123; <span class="string">"The"</span>, <span class="string">"Lazy"</span>, <span class="string">"Brown"</span>, <span class="string">"Dog"</span>, <span class="string">"&amp;"</span>, <span class="string">"friend"</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"a1: "</span> + Arrays.deepToString(a1));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"a2: "</span> + Arrays.deepToString(a2));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"a3: "</span> + Arrays.deepToString(a3));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">a1: [[1, 2, 3], [4, 5, 6]]</span></span><br><span class="line"><span class="comment">a2: [[[1.1, 2.2], [3.3, 4.4]], [[5.5, 6.6], [7.7,</span></span><br><span class="line"><span class="comment">8.8]], [[9.9, 1.2], [2.3, 3.4]]]</span></span><br><span class="line"><span class="comment">a3: [[The, Quick, Sly, Fox], [Jumped, Over], [The,</span></span><br><span class="line"><span class="comment">Lazy, Brown, Dog, &amp;, friend]]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>同样的，在 <strong>Integer</strong> 和 <strong>Double</strong> 数组中，自动装箱可为你创建包装器对象。</p>
<!-- Arrays and Generics -->
<h2 id="泛型数组"><a href="#泛型数组" class="headerlink" title="泛型数组"></a>泛型数组</h2><p>一般来说，数组和泛型并不能很好的结合。你不能实例化参数化类型的数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Peel&lt;Banana&gt;[] peels = <span class="keyword">new</span> Peel&lt;Banana&gt;[<span class="number">10</span>]; <span class="comment">// Illegal</span></span><br></pre></td></tr></table></figure>
<p>类型擦除需要删除参数类型信息，而且数组必须知道它们所保存的确切类型，以强制保证类型安全。</p>
<p>但是，可以参数化数组本身的类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ParameterizedArrayType.java</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassParameter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> T[] f(T[] arg) &#123; <span class="keyword">return</span> arg; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodParameter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] f(T[] arg) &#123; <span class="keyword">return</span> arg; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParameterizedArrayType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer[] ints = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    Double[] doubles = &#123; <span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>, <span class="number">4.4</span>, <span class="number">5.5</span> &#125;;</span><br><span class="line">    Integer[] ints2 =</span><br><span class="line">      <span class="keyword">new</span> ClassParameter&lt;Integer&gt;().f(ints);</span><br><span class="line">    Double[] doubles2 =</span><br><span class="line">      <span class="keyword">new</span> ClassParameter&lt;Double&gt;().f(doubles);</span><br><span class="line">    ints2 = MethodParameter.f(ints);</span><br><span class="line">    doubles2 = MethodParameter.f(doubles);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比起使用参数化类，使用参数化方法很方便。您不必为应用它的每个不同类型都实例化一个带有参数的类，但是可以使它成为 <strong>静态</strong> 的。你不能总是选择使用参数化方法而不用参数化的类，但通常参数化方法是更好的选择。</p>
<p>你不能创建泛型类型的数组，这种说法并不完全正确。是的，编译器不会让你 <em>实例化</em> 一个泛型的数组。但是，它将允许您创建对此类数组的引用。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] ls;</span><br></pre></td></tr></table></figure>
<p>无可争议的，这可以通过编译。尽管不能创建包含泛型的实际数组对象，但是你可以创建一个非泛型的数组并对其进行强制类型转换：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ArrayOfGenerics.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOfGenerics</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt;[] ls;</span><br><span class="line">    List[] la = <span class="keyword">new</span> List[<span class="number">10</span>];</span><br><span class="line">    ls = (List&lt;String&gt;[])la; <span class="comment">// Unchecked cast</span></span><br><span class="line">    ls[<span class="number">0</span>] = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//- ls[1] = new ArrayList&lt;Integer&gt;();</span></span><br><span class="line">    <span class="comment">// error: incompatible types: ArrayList&lt;Integer&gt;</span></span><br><span class="line">    <span class="comment">// cannot be converted to List&lt;String&gt;</span></span><br><span class="line">    <span class="comment">//     ls[1] = new ArrayList&lt;Integer&gt;();</span></span><br><span class="line">    <span class="comment">//             ^</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The problem: List&lt;String&gt; is a subtype of Object</span></span><br><span class="line">    Object[] objects = ls; <span class="comment">// So assignment is OK</span></span><br><span class="line">    <span class="comment">// Compiles and runs without complaint:</span></span><br><span class="line">    objects[<span class="number">1</span>] = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// However, if your needs are straightforward it is</span></span><br><span class="line">    <span class="comment">// possible to create an array of generics, albeit</span></span><br><span class="line">    <span class="comment">// with an "unchecked cast" warning:</span></span><br><span class="line">    List&lt;BerylliumSphere&gt;[] spheres =</span><br><span class="line">      (List&lt;BerylliumSphere&gt;[])<span class="keyword">new</span> List[<span class="number">10</span>];</span><br><span class="line">    Arrays.setAll(spheres, n -&gt; <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦你有了对 <strong>List<string>[]</string></strong> 的引用 , 你会发现多了一些编译时检查。问题是数组是协变的，所以 <strong>List<string>[]</string></strong> 也是一个 <strong>Object[]</strong>  ，你可以用这来将 <strong>ArrayList<integer> </integer></strong> 分配进你的数组，在编译或者运行时都不会出错。</p>
<p>如果你知道你不会进行向上类型转换，你的需求相对简单，那么可以创建一个泛型数组，它将提供基本的编译时类型检查。然而，一个泛型 <strong>Collection</strong> 实际上是一个比泛型数组更好的选择。</p>
<p>一般来说，您会发现泛型在类或方法的边界上是有效的。在内部，擦除常常会使泛型不可使用。所以，就像下面的例子，不能创建泛型类型的数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ArrayOfGenericType.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOfGenericType</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  T[] array; <span class="comment">// OK</span></span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ArrayOfGenericType</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// error: generic array creation:</span></span><br><span class="line">    <span class="comment">//- array = new T[size];</span></span><br><span class="line">    array = (T[])<span class="keyword">new</span> Object[size]; <span class="comment">// unchecked cast</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// error: generic array creation:</span></span><br><span class="line">  <span class="comment">//- public &lt;U&gt; U[] makeArray() &#123; return new U[10]; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>擦除再次从中作梗，这个例子试图创建已经擦除的类型数组，因此它们是未知的类型。你可以创建一个 <strong>对象</strong> 数组，然后对其进行强制类型转换，但如果没有 <strong>@SuppressWarnings</strong> 注释，你将会得到一个 “unchecked” 警告，因为数组实际上不真正支持而且将对类型 <strong>T</strong> 动态检查 。这就是说，如果我创建了一个 <strong>String[]</strong> , Java将在编译时和运行时强制执行，我只能在数组中放置字符串对象。然而，如果我创建一个 <strong>Object[]</strong> ,我可以把除了基元类型外的任何东西放入数组。</p>
<!-- Arrays.fill() -->
<h2 id="Arrays的fill方法"><a href="#Arrays的fill方法" class="headerlink" title="Arrays的fill方法"></a>Arrays的fill方法</h2><p>通常情况下，当对数组和程序进行实验时，能够很轻易地生成充满测试数据的数组是很有帮助的。 Java 标准库 <strong>Arrays</strong> 类包括一个普通的 <strong>fill()</strong> 方法，该方法将单个值复制到整个数组，或者在对象数组的情况下，将相同的引用复制到整个数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/FillingArrays.java</span></span><br><span class="line"><span class="comment">// Using Arrays.fill()</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FillingArrays</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">boolean</span>[] a1 = <span class="keyword">new</span> <span class="keyword">boolean</span>[size];</span><br><span class="line">    <span class="keyword">byte</span>[] a2 = <span class="keyword">new</span> <span class="keyword">byte</span>[size];</span><br><span class="line">    <span class="keyword">char</span>[] a3 = <span class="keyword">new</span> <span class="keyword">char</span>[size];</span><br><span class="line">    <span class="keyword">short</span>[] a4 = <span class="keyword">new</span> <span class="keyword">short</span>[size];</span><br><span class="line">    <span class="keyword">int</span>[] a5 = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line">    <span class="keyword">long</span>[] a6 = <span class="keyword">new</span> <span class="keyword">long</span>[size];</span><br><span class="line">    <span class="keyword">float</span>[] a7 = <span class="keyword">new</span> <span class="keyword">float</span>[size];</span><br><span class="line">    <span class="keyword">double</span>[] a8 = <span class="keyword">new</span> <span class="keyword">double</span>[size];</span><br><span class="line">    String[] a9 = <span class="keyword">new</span> String[size];</span><br><span class="line">    Arrays.fill(a1, <span class="keyword">true</span>);</span><br><span class="line">    show(<span class="string">"a1"</span>, a1);</span><br><span class="line">    Arrays.fill(a2, (<span class="keyword">byte</span>)<span class="number">11</span>);</span><br><span class="line">    show(<span class="string">"a2"</span>, a2);</span><br><span class="line">    Arrays.fill(a3, <span class="string">'x'</span>);</span><br><span class="line">    show(<span class="string">"a3"</span>, a3);</span><br><span class="line">    Arrays.fill(a4, (<span class="keyword">short</span>)<span class="number">17</span>);</span><br><span class="line">    show(<span class="string">"a4"</span>, a4);</span><br><span class="line">    Arrays.fill(a5, <span class="number">19</span>);</span><br><span class="line">    show(<span class="string">"a5"</span>, a5);</span><br><span class="line">    Arrays.fill(a6, <span class="number">23</span>);</span><br><span class="line">    show(<span class="string">"a6"</span>, a6);</span><br><span class="line">    Arrays.fill(a7, <span class="number">29</span>);</span><br><span class="line">    show(<span class="string">"a7"</span>, a7);</span><br><span class="line">    Arrays.fill(a8, <span class="number">47</span>);</span><br><span class="line">    show(<span class="string">"a8"</span>, a8);</span><br><span class="line">    Arrays.fill(a9, <span class="string">"Hello"</span>);</span><br><span class="line">    show(<span class="string">"a9"</span>, a9);</span><br><span class="line">    <span class="comment">// Manipulating ranges:</span></span><br><span class="line">    Arrays.fill(a9, <span class="number">3</span>, <span class="number">5</span>, <span class="string">"World"</span>);</span><br><span class="line">    show(<span class="string">"a9"</span>, a9);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;gedan</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">a1: [true, true, true, true, true, true]</span></span><br><span class="line"><span class="comment">a2: [11, 11, 11, 11, 11, 11]</span></span><br><span class="line"><span class="comment">a3: [x, x, x, x, x, x]</span></span><br><span class="line"><span class="comment">a4: [17, 17, 17, 17, 17, 17]</span></span><br><span class="line"><span class="comment">a5: [19, 19, 19, 19, 19, 19]</span></span><br><span class="line"><span class="comment">a6: [23, 23, 23, 23, 23, 23]</span></span><br><span class="line"><span class="comment">a7: [29.0, 29.0, 29.0, 29.0, 29.0, 29.0]</span></span><br><span class="line"><span class="comment">a8: [47.0, 47.0, 47.0, 47.0, 47.0, 47.0]</span></span><br><span class="line"><span class="comment">a9: [Hello, Hello, Hello, Hello, Hello, Hello]</span></span><br><span class="line"><span class="comment">a9: [Hello, Hello, Hello, World, World, Hello]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>你既可以填充整个数组，也可以像最后两个语句所示，填充一系列的元素。但是由于你只能使用单个值调用 <strong>Arrays.fill()</strong> ，因此结果并非特别有用。</p>
<!-- Arrays.setAll() -->
<h2 id="Arrays的setAll方法"><a href="#Arrays的setAll方法" class="headerlink" title="Arrays的setAll方法"></a>Arrays的setAll方法</h2><p>在Java 8中， 在<strong>RaggedArray.java</strong> 中引入并在 <strong>ArrayOfGenerics.java.Array.setAll()</strong> 中重用。它使用一个生成器并生成不同的值，可以选择基于数组的索引元素（通过访问当前索引，生成器可以读取数组值并对其进行修改）。 <strong>static Arrays.setAll()</strong> 的重载签名为：</p>
<ul>
<li><strong>void setAll(int[] a, IntUnaryOperator gen)</strong></li>
<li><strong>void setAll(long[] a, IntToLongFunction gen)</strong></li>
<li><strong>void setAll(double[] a, IntToDoubleFunctiongen)</strong></li>
<li><strong><t> void setAll(T[] a, IntFunction&lt;? extendsT&gt; gen)</t></strong></li>
</ul>
<p>除了 <strong>int</strong> , <strong>long</strong> , <strong>double</strong> 有特殊的版本，其他的一切都由泛型版本处理。生成器不是 <strong>Supplier</strong> 因为它们不带参数，并且必须将 <strong>int</strong> 数组索引作为参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/SimpleSetAll.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bob</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> id;</span><br><span class="line">  Bob(<span class="keyword">int</span> n) &#123; id = n; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Bob"</span> + id; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleSetAll</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SZ = <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> val = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span>[] chars = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">    .toCharArray();</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">char</span> <span class="title">getChar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> chars[n]; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] ia = <span class="keyword">new</span> <span class="keyword">int</span>[SZ];</span><br><span class="line">    <span class="keyword">long</span>[] la = <span class="keyword">new</span> <span class="keyword">long</span>[SZ];</span><br><span class="line">    <span class="keyword">double</span>[] da = <span class="keyword">new</span> <span class="keyword">double</span>[SZ];</span><br><span class="line">    Arrays.setAll(ia, n -&gt; n); <span class="comment">// [1]</span></span><br><span class="line">    Arrays.setAll(la, n -&gt; n);</span><br><span class="line">    Arrays.setAll(da, n -&gt; n);</span><br><span class="line">    show(ia);</span><br><span class="line">    show(la);</span><br><span class="line">    show(da);</span><br><span class="line">    Arrays.setAll(ia, n -&gt; val++); <span class="comment">// [2]</span></span><br><span class="line">    Arrays.setAll(la, n -&gt; val++);</span><br><span class="line">    Arrays.setAll(da, n -&gt; val++);</span><br><span class="line">    show(ia);</span><br><span class="line">    show(la);</span><br><span class="line">    show(da);</span><br><span class="line"></span><br><span class="line">    Bob[] ba = <span class="keyword">new</span> Bob[SZ];</span><br><span class="line">    Arrays.setAll(ba, Bob::<span class="keyword">new</span>); <span class="comment">// [3]</span></span><br><span class="line">    show(ba);</span><br><span class="line"></span><br><span class="line">    Character[] ca = <span class="keyword">new</span> Character[SZ];</span><br><span class="line">    Arrays.setAll(ca, SimpleSetAll::getChar); <span class="comment">// [4]</span></span><br><span class="line">    show(ca);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0]</span></span><br><span class="line"><span class="comment">[1, 2, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line"><span class="comment">[9, 10, 11, 12, 13, 14, 15, 16]</span></span><br><span class="line"><span class="comment">[17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0]</span></span><br><span class="line"><span class="comment">[Bob0, Bob1, Bob2, Bob3, Bob4, Bob5, Bob6, Bob7]</span></span><br><span class="line"><span class="comment">[a, b, c, d, e, f, g, h]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>[1]</strong> 这里，我们只是将数组索引作为值插入数组。这将自动转化为 <strong>long</strong> 和 <strong>double</strong> 版本。</li>
<li><strong>[2]</strong> 这个函数只需要接受索引就能产生正确结果。这个，我们忽略索引值并且使用 <strong>val</strong> 生成结果。</li>
<li><strong>[3]</strong> 方法引用有效，因为 <strong>Bob</strong> 的构造器接收一个 <strong>int</strong> 参数。只要我们传递的函数接收一个 <strong>int</strong> 参数且能产生正确的结果，就认为它完成了工作。</li>
<li><strong>[4]</strong> 为了处理除了  <strong>int</strong> ，<strong>long</strong> ，<strong>double</strong> 之外的基元类型，请为基元创建包装类的数组。然后使用 <strong>setAll()</strong> 的泛型版本。请注意，<strong>getChar（）</strong> 生成基元类型，因此这是自动装箱到 <strong>Character</strong> 。</li>
</ul>
<!-- Incremental Generators -->
<h2 id="增量生成"><a href="#增量生成" class="headerlink" title="增量生成"></a>增量生成</h2><p>这是一个方法库，用于为不同类型生成增量值。</p>
<p>这些被作为内部类来生成容易记住的名字；比如，为了使用 <strong>Integer</strong> 工具你可以用 <strong>new Conut.Interger()</strong> , 如果你想要使用基本数据类型 <strong>int</strong> 工具，你可以用 <strong>new Count.Pint()</strong>  (基本类型的名字不能被直接使用，所以它们都在前面添加一个 <strong>P</strong>  来表示基本数据类型’primitive’, 我们的第一选择是使用基本类型名字后面跟着下划线，比如 <strong>int_</strong> 和 <strong>double_</strong>  ,但是这种方式违背Java的命名习惯）。每个包装类的生成器都使用 <strong>get()</strong> 方法实现了它的 <strong>Supplier</strong> 。要使用<strong>Array.setAll()</strong> ，一个重载的 <strong>get(int n)</strong> 方法要接受（并忽略）其参数，以便接受 <strong>setAll()</strong> 传递的索引值。</p>
<p>注意，通过使用包装类的名称作为内部类名，我们必须调用 <strong>java.lang</strong> 包来保证我们可以使用实际包装类的名字：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Count.java</span></span><br><span class="line"><span class="comment">// Generate incremental values of different types</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ConvertTo.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Count</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> b = <span class="keyword">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      b = !b;</span><br><span class="line">      <span class="keyword">return</span> java.lang.Boolean.valueOf(b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Boolean[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Boolean[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Boolean[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pboolean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> b = <span class="keyword">true</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      b = !b;</span><br><span class="line">      <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Boolean().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Byte</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span> b;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> b++; &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Byte[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Byte[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Byte[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pbyte</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span> b;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> b++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Byte().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">char</span>[] CHARS =</span><br><span class="line">    <span class="string">"abcdefghijklmnopqrstuvwxyz"</span>.toCharArray();</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Character</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      i = (i + <span class="number">1</span>) % CHARS.length;</span><br><span class="line">      <span class="keyword">return</span> CHARS[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Character[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Character[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Character[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pchar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      i = (i + <span class="number">1</span>) % CHARS.length;</span><br><span class="line">      <span class="keyword">return</span> CHARS[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">char</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Character().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Short</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">short</span> s;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> s++; &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Short[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Short[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Short[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pshort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">short</span> s;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> s++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">short</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Short().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Integer</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i++; &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Integer[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Integer[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Integer[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pint</span> <span class="keyword">implements</span> <span class="title">IntSupplier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAsInt</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Integer().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Long</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> l;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> l++; &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Long[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Long[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Long[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Plong</span> <span class="keyword">implements</span> <span class="title">LongSupplier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> l;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> l++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getAsLong</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Long().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Float</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> java.lang.Float.valueOf(i++);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Float[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Float[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Float[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pfloat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Float().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Double</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> java.lang.Double.valueOf(i++);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Double[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Double[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Double[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pdouble</span> <span class="keyword">implements</span> <span class="title">DoubleSupplier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> get(); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAsDouble</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> get(<span class="number">0</span>); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Double().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于 <strong>int</strong> ，<strong>long</strong> ，<strong>double</strong> 这三个有特殊 <strong>Supplier</strong> 接口的原始数据类型来说，<strong>Pint</strong> ， <strong>Plong</strong> 和 <strong>Pdouble</strong> 实现了这些接口。</p>
<p>这里是对 <strong>Count</strong> 的测试，这同样给我们提供了如何使用它的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/TestCount.java</span></span><br><span class="line"><span class="comment">// Test counting generators</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCount</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SZ = <span class="number">5</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Boolean"</span>);</span><br><span class="line">    Boolean[] a1 = <span class="keyword">new</span> Boolean[SZ];</span><br><span class="line">    Arrays.setAll(a1, <span class="keyword">new</span> Count.Boolean()::get);</span><br><span class="line">    show(a1);</span><br><span class="line">    a1 = Stream.generate(<span class="keyword">new</span> Count.Boolean())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Boolean[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a1);</span><br><span class="line">    a1 = <span class="keyword">new</span> Count.Boolean().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a1);</span><br><span class="line">    <span class="keyword">boolean</span>[] a1b =</span><br><span class="line">      <span class="keyword">new</span> Count.Pboolean().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a1b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Byte"</span>);</span><br><span class="line">    Byte[] a2 = <span class="keyword">new</span> Byte[SZ];</span><br><span class="line">    Arrays.setAll(a2, <span class="keyword">new</span> Count.Byte()::get);</span><br><span class="line">    show(a2);</span><br><span class="line">    a2 = Stream.generate(<span class="keyword">new</span> Count.Byte())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Byte[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a2);</span><br><span class="line">    a2 = <span class="keyword">new</span> Count.Byte().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a2);</span><br><span class="line">    <span class="keyword">byte</span>[] a2b = <span class="keyword">new</span> Count.Pbyte().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a2b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Character"</span>);</span><br><span class="line">    Character[] a3 = <span class="keyword">new</span> Character[SZ];</span><br><span class="line">    Arrays.setAll(a3, <span class="keyword">new</span> Count.Character()::get);</span><br><span class="line">    show(a3);</span><br><span class="line">    a3 = Stream.generate(<span class="keyword">new</span> Count.Character())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Character[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a3);</span><br><span class="line">    a3 = <span class="keyword">new</span> Count.Character().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a3);</span><br><span class="line">    <span class="keyword">char</span>[] a3b = <span class="keyword">new</span> Count.Pchar().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a3b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Short"</span>);</span><br><span class="line">    Short[] a4 = <span class="keyword">new</span> Short[SZ];</span><br><span class="line">    Arrays.setAll(a4, <span class="keyword">new</span> Count.Short()::get);</span><br><span class="line">    show(a4);</span><br><span class="line">    a4 = Stream.generate(<span class="keyword">new</span> Count.Short())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Short[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a4);</span><br><span class="line">    a4 = <span class="keyword">new</span> Count.Short().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a4);</span><br><span class="line">    <span class="keyword">short</span>[] a4b = <span class="keyword">new</span> Count.Pshort().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a4b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Integer"</span>);</span><br><span class="line">    <span class="keyword">int</span>[] a5 = <span class="keyword">new</span> <span class="keyword">int</span>[SZ];</span><br><span class="line">    Arrays.setAll(a5, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">    show(a5);</span><br><span class="line">    Integer[] a5b =</span><br><span class="line">      Stream.generate(<span class="keyword">new</span> Count.Integer())</span><br><span class="line">        .limit(SZ + <span class="number">1</span>).toArray(Integer[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a5b);</span><br><span class="line">    a5b = <span class="keyword">new</span> Count.Integer().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a5b);</span><br><span class="line">    a5 = IntStream.generate(<span class="keyword">new</span> Count.Pint())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a5);</span><br><span class="line">    a5 = <span class="keyword">new</span> Count.Pint().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a5);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Long"</span>);</span><br><span class="line">    <span class="keyword">long</span>[] a6 = <span class="keyword">new</span> <span class="keyword">long</span>[SZ];</span><br><span class="line">    Arrays.setAll(a6, <span class="keyword">new</span> Count.Long()::get);</span><br><span class="line">    show(a6);</span><br><span class="line">    Long[] a6b = Stream.generate(<span class="keyword">new</span> Count.Long())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Long[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a6b);</span><br><span class="line">    a6b = <span class="keyword">new</span> Count.Long().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a6b);</span><br><span class="line">    a6 = LongStream.generate(<span class="keyword">new</span> Count.Plong())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a6);</span><br><span class="line">    a6 = <span class="keyword">new</span> Count.Plong().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a6);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Float"</span>);</span><br><span class="line">    Float[] a7 = <span class="keyword">new</span> Float[SZ];</span><br><span class="line">    Arrays.setAll(a7, <span class="keyword">new</span> Count.Float()::get);</span><br><span class="line">    show(a7);</span><br><span class="line">    a7 = Stream.generate(<span class="keyword">new</span> Count.Float())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Float[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a7);</span><br><span class="line">    a7 = <span class="keyword">new</span> Count.Float().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a7);</span><br><span class="line">    <span class="keyword">float</span>[] a7b = <span class="keyword">new</span> Count.Pfloat().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a7b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Double"</span>);</span><br><span class="line">    <span class="keyword">double</span>[] a8 = <span class="keyword">new</span> <span class="keyword">double</span>[SZ];</span><br><span class="line">    Arrays.setAll(a8, <span class="keyword">new</span> Count.Double()::get);</span><br><span class="line">    show(a8);</span><br><span class="line">    Double[] a8b =</span><br><span class="line">      Stream.generate(<span class="keyword">new</span> Count.Double())</span><br><span class="line">        .limit(SZ + <span class="number">1</span>).toArray(Double[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a8b);</span><br><span class="line">    a8b = <span class="keyword">new</span> Count.Double().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a8b);</span><br><span class="line">    a8 = DoubleStream.generate(<span class="keyword">new</span> Count.Pdouble())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a8);</span><br><span class="line">    a8 = <span class="keyword">new</span> Count.Pdouble().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a8);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Boolean</span></span><br><span class="line"><span class="comment">[false, true, false, true, false]</span></span><br><span class="line"><span class="comment">[false, true, false, true, false, true]</span></span><br><span class="line"><span class="comment">[false, true, false, true, false, true, false]</span></span><br><span class="line"><span class="comment">[false, true, false, true, false, true, false, true]</span></span><br><span class="line"><span class="comment">Byte</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">Character</span></span><br><span class="line"><span class="comment">[b, c, d, e, f]</span></span><br><span class="line"><span class="comment">[b, c, d, e, f, g]</span></span><br><span class="line"><span class="comment">[b, c, d, e, f, g, h]</span></span><br><span class="line"><span class="comment">[b, c, d, e, f, g, h, i]</span></span><br><span class="line"><span class="comment">Short</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">Integer</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">Long</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line"><span class="comment">Float</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0]</span></span><br><span class="line"><span class="comment">Double</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0]</span></span><br><span class="line"><span class="comment">[0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>注意到原始数组类型 <strong>int[]</strong> ，<strong>long[]</strong> ，<strong>double[]</strong> 可以直接被 <strong>Arrays.setAll()</strong> 填充，但是其他的原始类型都要求用包装器类型的数组。</p>
<p>通过 <strong>Stream.generate()</strong> 创建的包装数组显示了 <strong>toArray（）</strong> 的重载用法，在这里你应该提供给它要创建的数组类型的构造器。</p>
<!-- Random Generators -->
<h2 id="随机生成"><a href="#随机生成" class="headerlink" title="随机生成"></a>随机生成</h2><p>我们可以按照 <strong>Count.java</strong> 的结构创建一个生成随机值的工具：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Rand.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"><span class="comment">// Generate random values of different types</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ConvertTo.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rand</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> MOD = <span class="number">10_000</span>;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.nextBoolean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Boolean[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Boolean[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Boolean[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pboolean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Boolean().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Byte</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">byte</span>)r.nextInt(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Byte[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Byte[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Byte[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pbyte</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Byte().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Character</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">char</span>)r.nextInt(<span class="string">'a'</span>, <span class="string">'z'</span> + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Character[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Character[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Character[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pchar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">char</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Character().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Short</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">short</span>)r.nextInt(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Short[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Short[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Short[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pshort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">short</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Short().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Integer</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.nextInt(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Integer[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">int</span>[] primitive = <span class="keyword">new</span> Pint().array(sz);</span><br><span class="line">      java.lang.Integer[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Integer[sz];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++)</span><br><span class="line">        result[i] = primitive[i];</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pint</span> <span class="keyword">implements</span> <span class="title">IntSupplier</span> </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAsInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.nextInt(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> getAsInt(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> r.ints(sz, <span class="number">0</span>, MOD).toArray();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Long</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.nextLong(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Long[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">long</span>[] primitive = <span class="keyword">new</span> Plong().array(sz);</span><br><span class="line">      java.lang.Long[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Long[sz];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++)</span><br><span class="line">        result[i] = primitive[i];</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Plong</span> <span class="keyword">implements</span> <span class="title">LongSupplier</span> </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getAsLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.nextLong(MOD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> getAsLong(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> r.longs(sz, <span class="number">0</span>, MOD).toArray();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Float</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">float</span>)trim(r.nextDouble());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Float[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.Float[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Float[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pfloat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">return</span> primitive(<span class="keyword">new</span> Float().array(sz));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">trim</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">      ((<span class="keyword">double</span>)Math.round(d * <span class="number">1000.0</span>)) / <span class="number">100.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Double</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> trim(r.nextDouble());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.Double[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">double</span>[] primitive =</span><br><span class="line">        <span class="keyword">new</span> Rand.Pdouble().array(sz);</span><br><span class="line">      java.lang.Double[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.Double[sz];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++)</span><br><span class="line">        result[i] = primitive[i];</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Pdouble</span> <span class="keyword">implements</span> <span class="title">DoubleSupplier</span> </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAsDouble</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> trim(r.nextDouble());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> getAsDouble();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      <span class="keyword">double</span>[] result = r.doubles(sz).toArray();</span><br><span class="line">      Arrays.setAll(result,</span><br><span class="line">        n -&gt; result[n] = trim(result[n]));</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> strlen = <span class="number">7</span>; <span class="comment">// Default length</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span> strLength)</span> </span>&#123;</span><br><span class="line">      strlen = strLength;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r.ints(strlen, <span class="string">'a'</span>, <span class="string">'z'</span> + <span class="number">1</span>)</span><br><span class="line">        .collect(StringBuilder::<span class="keyword">new</span>,</span><br><span class="line">                 StringBuilder::appendCodePoint,</span><br><span class="line">                 StringBuilder::append).toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">get</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> java.lang.String[] array(<span class="keyword">int</span> sz) &#123;</span><br><span class="line">      java.lang.String[] result =</span><br><span class="line">        <span class="keyword">new</span> java.lang.String[sz];</span><br><span class="line">      Arrays.setAll(result, n -&gt; get());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于除了 <strong>int</strong> 、 <strong>long</strong> 和 <strong>double</strong> 之外的所有基本类型元素生成器，只生成数组，而不是 Count 中看到的完整操作集。这只是一个设计选择，因为本书不需要额外的功能。</p>
<p>下面是对所有 <strong>Rand</strong> 工具的测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/TestRand.java</span></span><br><span class="line"><span class="comment">// Test random generators</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRand</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SZ = <span class="number">5</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Boolean"</span>);</span><br><span class="line">    Boolean[] a1 = <span class="keyword">new</span> Boolean[SZ];</span><br><span class="line">    Arrays.setAll(a1, <span class="keyword">new</span> Rand.Boolean()::get);</span><br><span class="line">    show(a1);</span><br><span class="line">    a1 = Stream.generate(<span class="keyword">new</span> Rand.Boolean())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Boolean[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a1);</span><br><span class="line">    a1 = <span class="keyword">new</span> Rand.Boolean().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a1);</span><br><span class="line">    <span class="keyword">boolean</span>[] a1b =</span><br><span class="line">      <span class="keyword">new</span> Rand.Pboolean().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a1b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Byte"</span>);</span><br><span class="line">    Byte[] a2 = <span class="keyword">new</span> Byte[SZ];</span><br><span class="line">    Arrays.setAll(a2, <span class="keyword">new</span> Rand.Byte()::get);</span><br><span class="line">    show(a2);</span><br><span class="line">    a2 = Stream.generate(<span class="keyword">new</span> Rand.Byte())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Byte[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a2);</span><br><span class="line">    a2 = <span class="keyword">new</span> Rand.Byte().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a2);</span><br><span class="line">    <span class="keyword">byte</span>[] a2b = <span class="keyword">new</span> Rand.Pbyte().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a2b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Character"</span>);</span><br><span class="line">    Character[] a3 = <span class="keyword">new</span> Character[SZ];</span><br><span class="line">    Arrays.setAll(a3, <span class="keyword">new</span> Rand.Character()::get);</span><br><span class="line">    show(a3);</span><br><span class="line">    a3 = Stream.generate(<span class="keyword">new</span> Rand.Character())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Character[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a3);</span><br><span class="line">    a3 = <span class="keyword">new</span> Rand.Character().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a3);</span><br><span class="line">    <span class="keyword">char</span>[] a3b = <span class="keyword">new</span> Rand.Pchar().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a3b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Short"</span>);</span><br><span class="line">    Short[] a4 = <span class="keyword">new</span> Short[SZ];</span><br><span class="line">    Arrays.setAll(a4, <span class="keyword">new</span> Rand.Short()::get);</span><br><span class="line">    show(a4);</span><br><span class="line">    a4 = Stream.generate(<span class="keyword">new</span> Rand.Short())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Short[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a4);</span><br><span class="line">    a4 = <span class="keyword">new</span> Rand.Short().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a4);</span><br><span class="line">    <span class="keyword">short</span>[] a4b = <span class="keyword">new</span> Rand.Pshort().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a4b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Integer"</span>);</span><br><span class="line">    <span class="keyword">int</span>[] a5 = <span class="keyword">new</span> <span class="keyword">int</span>[SZ];</span><br><span class="line">    Arrays.setAll(a5, <span class="keyword">new</span> Rand.Integer()::get);</span><br><span class="line">    show(a5);</span><br><span class="line">    Integer[] a5b =</span><br><span class="line">      Stream.generate(<span class="keyword">new</span> Rand.Integer())</span><br><span class="line">        .limit(SZ + <span class="number">1</span>).toArray(Integer[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a5b);</span><br><span class="line">    a5b = <span class="keyword">new</span> Rand.Integer().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a5b);</span><br><span class="line">    a5 = IntStream.generate(<span class="keyword">new</span> Rand.Pint())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a5);</span><br><span class="line">    a5 = <span class="keyword">new</span> Rand.Pint().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a5);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Long"</span>);</span><br><span class="line">    <span class="keyword">long</span>[] a6 = <span class="keyword">new</span> <span class="keyword">long</span>[SZ];</span><br><span class="line">    Arrays.setAll(a6, <span class="keyword">new</span> Rand.Long()::get);</span><br><span class="line">    show(a6);</span><br><span class="line">    Long[] a6b = Stream.generate(<span class="keyword">new</span> Rand.Long())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Long[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a6b);</span><br><span class="line">    a6b = <span class="keyword">new</span> Rand.Long().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a6b);</span><br><span class="line">    a6 = LongStream.generate(<span class="keyword">new</span> Rand.Plong())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a6);</span><br><span class="line">    a6 = <span class="keyword">new</span> Rand.Plong().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a6);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Float"</span>);</span><br><span class="line">    Float[] a7 = <span class="keyword">new</span> Float[SZ];</span><br><span class="line">    Arrays.setAll(a7, <span class="keyword">new</span> Rand.Float()::get);</span><br><span class="line">    show(a7);</span><br><span class="line">    a7 = Stream.generate(<span class="keyword">new</span> Rand.Float())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray(Float[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a7);</span><br><span class="line">    a7 = <span class="keyword">new</span> Rand.Float().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a7);</span><br><span class="line">    <span class="keyword">float</span>[] a7b = <span class="keyword">new</span> Rand.Pfloat().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a7b);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Double"</span>);</span><br><span class="line">    <span class="keyword">double</span>[] a8 = <span class="keyword">new</span> <span class="keyword">double</span>[SZ];</span><br><span class="line">    Arrays.setAll(a8, <span class="keyword">new</span> Rand.Double()::get);</span><br><span class="line">    show(a8);</span><br><span class="line">    Double[] a8b =</span><br><span class="line">      Stream.generate(<span class="keyword">new</span> Rand.Double())</span><br><span class="line">        .limit(SZ + <span class="number">1</span>).toArray(Double[]::<span class="keyword">new</span>);</span><br><span class="line">    show(a8b);</span><br><span class="line">    a8b = <span class="keyword">new</span> Rand.Double().array(SZ + <span class="number">2</span>);</span><br><span class="line">    show(a8b);</span><br><span class="line">    a8 = DoubleStream.generate(<span class="keyword">new</span> Rand.Pdouble())</span><br><span class="line">      .limit(SZ + <span class="number">1</span>).toArray();</span><br><span class="line">    show(a8);</span><br><span class="line">    a8 = <span class="keyword">new</span> Rand.Pdouble().array(SZ + <span class="number">3</span>);</span><br><span class="line">    show(a8);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"String"</span>);</span><br><span class="line">    String[] s = <span class="keyword">new</span> String[SZ - <span class="number">1</span>];</span><br><span class="line">    Arrays.setAll(s, <span class="keyword">new</span> Rand.String()::get);</span><br><span class="line">    show(s);</span><br><span class="line">    s = Stream.generate(<span class="keyword">new</span> Rand.String())</span><br><span class="line">      .limit(SZ).toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">    show(s);</span><br><span class="line">    s = <span class="keyword">new</span> Rand.String().array(SZ + <span class="number">1</span>);</span><br><span class="line">    show(s);</span><br><span class="line"></span><br><span class="line">    Arrays.setAll(s, <span class="keyword">new</span> Rand.String(<span class="number">4</span>)::get);</span><br><span class="line">    show(s);</span><br><span class="line">    s = Stream.generate(<span class="keyword">new</span> Rand.String(<span class="number">4</span>))</span><br><span class="line">      .limit(SZ).toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">    show(s);</span><br><span class="line">    s = <span class="keyword">new</span> Rand.String(<span class="number">4</span>).array(SZ + <span class="number">1</span>);</span><br><span class="line">    show(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Boolean</span></span><br><span class="line"><span class="comment">[true, false, true, true, true]</span></span><br><span class="line"><span class="comment">[true, false, true, true, true, false]</span></span><br><span class="line"><span class="comment">[true, false, true, true, true, false, false]</span></span><br><span class="line"><span class="comment">[true, false, true, true, true, false, false, true]</span></span><br><span class="line"><span class="comment">Byte</span></span><br><span class="line"><span class="comment">[123, 33, 101, 112, 33]</span></span><br><span class="line"><span class="comment">[123, 33, 101, 112, 33, 31]</span></span><br><span class="line"><span class="comment">[123, 33, 101, 112, 33, 31, 0]</span></span><br><span class="line"><span class="comment">[123, 33, 101, 112, 33, 31, 0, -72]</span></span><br><span class="line"><span class="comment">Character</span></span><br><span class="line"><span class="comment">[b, t, p, e, n]</span></span><br><span class="line"><span class="comment">[b, t, p, e, n, p]</span></span><br><span class="line"><span class="comment">[b, t, p, e, n, p, c]</span></span><br><span class="line"><span class="comment">[b, t, p, e, n, p, c, c]</span></span><br><span class="line"><span class="comment">Short</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479, 6656]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479, 6656, 3768]</span></span><br><span class="line"><span class="comment">Integer</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479, 6656]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">[635, 8737, 3941, 4720, 6177, 8479, 6656, 3768]</span></span><br><span class="line"><span class="comment">Long</span></span><br><span class="line"><span class="comment">[6882, 3765, 692, 9575, 4439]</span></span><br><span class="line"><span class="comment">[6882, 3765, 692, 9575, 4439, 2638]</span></span><br><span class="line"><span class="comment">[6882, 3765, 692, 9575, 4439, 2638, 4011]</span></span><br><span class="line"><span class="comment">[6882, 3765, 692, 9575, 4439, 2638]</span></span><br><span class="line"><span class="comment">[6882, 3765, 692, 9575, 4439, 2638, 4011, 9610]</span></span><br><span class="line"><span class="comment">Float</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18, 0.99]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18, 0.99, 8.28]</span></span><br><span class="line"><span class="comment">Double</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18, 0.99]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18, 0.99, 8.28]</span></span><br><span class="line"><span class="comment">String</span></span><br><span class="line"><span class="comment">[btpenpc, cuxszgv, gmeinne, eloztdv]</span></span><br><span class="line"><span class="comment">[btpenpc, cuxszgv, gmeinne, eloztdv, ewcippc]</span></span><br><span class="line"><span class="comment">[btpenpc, cuxszgv, gmeinne, eloztdv, ewcippc, ygpoalk]</span></span><br><span class="line"><span class="comment">[btpe, npcc, uxsz, gvgm, einn, eelo]</span></span><br><span class="line"><span class="comment">[btpe, npcc, uxsz, gvgm, einn]</span></span><br><span class="line"><span class="comment">[btpe, npcc, uxsz, gvgm, einn, eelo]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>注意（除了 <strong>String</strong> 部分之外），这段代码与 <strong>TestCount.java</strong> 中的代码相同，<strong>Count</strong> 被 <strong>Rand</strong> 替换。</p>
<!-- Generics and Primitive Arrays -->
<h2 id="泛型和基本数组"><a href="#泛型和基本数组" class="headerlink" title="泛型和基本数组"></a>泛型和基本数组</h2><p>在本章的前面，我们被提醒，泛型不能和基元一起工作。在这种情况下，我们必须从基元数组转换为包装类型的数组，并且还必须从另一个方向转换。下面是一个转换器可以同时对所有类型的数据执行操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/ConvertTo.java</span></span><br><span class="line"><span class="comment">// (c)2017 MindView LLC: see Copyright.txt</span></span><br><span class="line"><span class="comment">// We make no guarantees that this code is fit for any purpose.</span></span><br><span class="line"><span class="comment">// Visit http://OnJava8.com for more book information.</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConvertTo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">boolean</span>[] primitive(Boolean[] in) &#123;</span><br><span class="line">    <span class="keyword">boolean</span>[] result = <span class="keyword">new</span> <span class="keyword">boolean</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i]; <span class="comment">// Autounboxing</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span>[] primitive(Character[] in) &#123;</span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">byte</span>[] primitive(Byte[] in) &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] result = <span class="keyword">new</span> <span class="keyword">byte</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">short</span>[] primitive(Short[] in) &#123;</span><br><span class="line">    <span class="keyword">short</span>[] result = <span class="keyword">new</span> <span class="keyword">short</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span>[] primitive(Integer[] in) &#123;</span><br><span class="line">    <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">long</span>[] primitive(Long[] in) &#123;</span><br><span class="line">    <span class="keyword">long</span>[] result = <span class="keyword">new</span> <span class="keyword">long</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">float</span>[] primitive(Float[] in) &#123;</span><br><span class="line">    <span class="keyword">float</span>[] result = <span class="keyword">new</span> <span class="keyword">float</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">double</span>[] primitive(Double[] in) &#123;</span><br><span class="line">    <span class="keyword">double</span>[] result = <span class="keyword">new</span> <span class="keyword">double</span>[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Convert from primitive array to wrapped array:</span></span><br><span class="line">  <span class="keyword">static</span> Boolean[] boxed(<span class="keyword">boolean</span>[] in) &#123;</span><br><span class="line">    Boolean[] result = <span class="keyword">new</span> Boolean[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i]; <span class="comment">// Autoboxing</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Character[] boxed(<span class="keyword">char</span>[] in) &#123;</span><br><span class="line">    Character[] result = <span class="keyword">new</span> Character[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Byte[] boxed(<span class="keyword">byte</span>[] in) &#123;</span><br><span class="line">    Byte[] result = <span class="keyword">new</span> Byte[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Short[] boxed(<span class="keyword">short</span>[] in) &#123;</span><br><span class="line">    Short[] result = <span class="keyword">new</span> Short[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Integer[] boxed(<span class="keyword">int</span>[] in) &#123;</span><br><span class="line">    Integer[] result = <span class="keyword">new</span> Integer[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Long[] boxed(<span class="keyword">long</span>[] in) &#123;</span><br><span class="line">    Long[] result = <span class="keyword">new</span> Long[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Float[] boxed(<span class="keyword">float</span>[] in) &#123;</span><br><span class="line">    Float[] result = <span class="keyword">new</span> Float[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Double[] boxed(<span class="keyword">double</span>[] in) &#123;</span><br><span class="line">    Double[] result = <span class="keyword">new</span> Double[in.length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++)</span><br><span class="line">      result[i] = in[i];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>primitive()</strong> 的每个版本都创建一个准确长度的适当基元数组，然后从包装类的 <strong>in</strong> 数组中复制元素。如果任何包装的数组元素是 <strong>null</strong> ，你将得到一个异常（这是合理的—否则无法选择有意义的值进行替换)。注意在这个任务中自动装箱如何发生。</p>
<p>下面是对 <strong>ConvertTo</strong> 中所有方法的测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/TestConvertTo.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ConvertTo.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConvertTo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">6</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Boolean[] a1 = <span class="keyword">new</span> Boolean[SIZE];</span><br><span class="line">    Arrays.setAll(a1, <span class="keyword">new</span> Rand.Boolean()::get);</span><br><span class="line">    <span class="keyword">boolean</span>[] a1p = primitive(a1);</span><br><span class="line">    show(<span class="string">"a1p"</span>, a1p);</span><br><span class="line">    Boolean[] a1b = boxed(a1p);</span><br><span class="line">    show(<span class="string">"a1b"</span>, a1b);</span><br><span class="line"></span><br><span class="line">    Byte[] a2 = <span class="keyword">new</span> Byte[SIZE];</span><br><span class="line">    Arrays.setAll(a2, <span class="keyword">new</span> Rand.Byte()::get);</span><br><span class="line">    <span class="keyword">byte</span>[] a2p = primitive(a2);</span><br><span class="line">    show(<span class="string">"a2p"</span>, a2p);</span><br><span class="line">    Byte[] a2b = boxed(a2p);</span><br><span class="line">    show(<span class="string">"a2b"</span>, a2b);</span><br><span class="line"></span><br><span class="line">    Character[] a3 = <span class="keyword">new</span> Character[SIZE];</span><br><span class="line">    Arrays.setAll(a3, <span class="keyword">new</span> Rand.Character()::get);</span><br><span class="line">    <span class="keyword">char</span>[] a3p = primitive(a3);</span><br><span class="line">    show(<span class="string">"a3p"</span>, a3p);</span><br><span class="line">    Character[] a3b = boxed(a3p);</span><br><span class="line">    show(<span class="string">"a3b"</span>, a3b);</span><br><span class="line"></span><br><span class="line">    Short[] a4 = <span class="keyword">new</span> Short[SIZE];</span><br><span class="line">    Arrays.setAll(a4, <span class="keyword">new</span> Rand.Short()::get);</span><br><span class="line">    <span class="keyword">short</span>[] a4p = primitive(a4);</span><br><span class="line">    show(<span class="string">"a4p"</span>, a4p);</span><br><span class="line">    Short[] a4b = boxed(a4p);</span><br><span class="line">    show(<span class="string">"a4b"</span>, a4b);</span><br><span class="line"></span><br><span class="line">    Integer[] a5 = <span class="keyword">new</span> Integer[SIZE];</span><br><span class="line">    Arrays.setAll(a5, <span class="keyword">new</span> Rand.Integer()::get);</span><br><span class="line">    <span class="keyword">int</span>[] a5p = primitive(a5);</span><br><span class="line">    show(<span class="string">"a5p"</span>, a5p);</span><br><span class="line">    Integer[] a5b = boxed(a5p);</span><br><span class="line">    show(<span class="string">"a5b"</span>, a5b);</span><br><span class="line"></span><br><span class="line">    Long[] a6 = <span class="keyword">new</span> Long[SIZE];</span><br><span class="line">    Arrays.setAll(a6, <span class="keyword">new</span> Rand.Long()::get);</span><br><span class="line">    <span class="keyword">long</span>[] a6p = primitive(a6);</span><br><span class="line">    show(<span class="string">"a6p"</span>, a6p);</span><br><span class="line">    Long[] a6b = boxed(a6p);</span><br><span class="line">    show(<span class="string">"a6b"</span>, a6b);</span><br><span class="line"></span><br><span class="line">    Float[] a7 = <span class="keyword">new</span> Float[SIZE];</span><br><span class="line">    Arrays.setAll(a7, <span class="keyword">new</span> Rand.Float()::get);</span><br><span class="line">    <span class="keyword">float</span>[] a7p = primitive(a7);</span><br><span class="line">    show(<span class="string">"a7p"</span>, a7p);</span><br><span class="line">    Float[] a7b = boxed(a7p);</span><br><span class="line">    show(<span class="string">"a7b"</span>, a7b);</span><br><span class="line"></span><br><span class="line">    Double[] a8 = <span class="keyword">new</span> Double[SIZE];</span><br><span class="line">    Arrays.setAll(a8, <span class="keyword">new</span> Rand.Double()::get);</span><br><span class="line">    <span class="keyword">double</span>[] a8p = primitive(a8);</span><br><span class="line">    show(<span class="string">"a8p"</span>, a8p);</span><br><span class="line">    Double[] a8b = boxed(a8p);</span><br><span class="line">    show(<span class="string">"a8b"</span>, a8b);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">a1p: [true, false, true, true, true, false]</span></span><br><span class="line"><span class="comment">a1b: [true, false, true, true, true, false]</span></span><br><span class="line"><span class="comment">a2p: [123, 33, 101, 112, 33, 31]</span></span><br><span class="line"><span class="comment">a2b: [123, 33, 101, 112, 33, 31]</span></span><br><span class="line"><span class="comment">a3p: [b, t, p, e, n, p]</span></span><br><span class="line"><span class="comment">a3b: [b, t, p, e, n, p]</span></span><br><span class="line"><span class="comment">a4p: [635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">a4b: [635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">a5p: [635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">a5b: [635, 8737, 3941, 4720, 6177, 8479]</span></span><br><span class="line"><span class="comment">a6p: [6882, 3765, 692, 9575, 4439, 2638]</span></span><br><span class="line"><span class="comment">a6b: [6882, 3765, 692, 9575, 4439, 2638]</span></span><br><span class="line"><span class="comment">a7p: [4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">a7b: [4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">a8p: [4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">a8b: [4.83, 2.89, 2.9, 1.97, 3.01, 0.18]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>在每种情况下，原始数组都是为包装类型创建的，并使用 <strong>Arrays.setAll()</strong> 填充，正如我们在 <strong>TestCouner.java</strong> 中所做的那样（这也验证了 <strong>Arrays.setAll()</strong> 是否能同 <strong>Integer</strong> ，<strong>Long</strong> ，和 <strong>Double</strong> ）。然后 <strong>ConvertTo.primitive()</strong>  将包装器数组转换为对应的基元数组，<strong>ConverTo.boxed()</strong> 将其转换回来。</p>
<!-- Modifying Existing Array Elements -->
<h2 id="数组元素修改"><a href="#数组元素修改" class="headerlink" title="数组元素修改"></a>数组元素修改</h2><p>传递给 <strong>Arrays.setAll()</strong> 的生成器函数可以使用它接收到的数组索引修改现有的数组元素:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ModifyExisting.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModifyExisting</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span>[] da = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">7</span>];</span><br><span class="line">        Arrays.setAll(da, <span class="keyword">new</span> Rand.Double()::get);</span><br><span class="line">        show(da);</span><br><span class="line">        Arrays.setAll(da, n -&gt; da[n] / <span class="number">100</span>); <span class="comment">// [1]</span></span><br><span class="line">        show(da);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[4.83, 2.89, 2.9, 1.97, 3.01, 0.18, 0.99]</span></span><br><span class="line"><span class="comment">[0.0483, 0.028900000000000002, 0.028999999999999998,</span></span><br><span class="line"><span class="comment">0.0197, 0.0301, 0.0018, 0.009899999999999999]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>[1] Lambdas在这里特别有用，因为数组总是在lambda表达式的范围内。</p>
<!-- An Aside On Parallelism -->
<h2 id="数组并行"><a href="#数组并行" class="headerlink" title="数组并行"></a>数组并行</h2><p>我们很快就不得不面对并行的主题。例如，“并行”一词在许多Java库方法中使用。您可能听说过类似“并行程序运行得更快”这样的说法，这是有道理的—当您可以有多个处理器时，为什么只有一个处理器在您的程序上工作呢? 如果您认为您应该利用其中的“并行”，这是很容易被原谅的。<br>要是这么简单就好了。不幸的是，通过采用这种方法，您可以很容易地编写比非并行版本运行速度更慢的代码。在你深刻理解所有的问题之前，并行编程看起来更像是一门艺术而非科学。<br>以下是简短的版本:用简单的方法编写代码。不要开始处理并行性，除非它成为一个问题。您仍然会遇到并行性。在本章中，我们将介绍一些为并行执行而编写的Java库方法。因此，您必须对它有足够的了解，以便进行基本的讨论，并避免出现错误。</p>
<p>在阅读并发编程这一章之后，您将更深入地理解它(但是，唉，这还远远不够。只是这些的话，充分理解这个主题是不可能的)。<br>在某些情况下，即使您只有一个处理器，无论您是否显式地尝试并行，并行实现是惟一的、最佳的或最符合逻辑的选择。它是一个可以一直使用的工具，所以您必须了解它的相关问题。</p>
<p>最好从数据的角度来考虑并行性。对于大量数据(以及可用的额外处理器)，并行可能会有所帮助。但您也可能使事情变得更糟。</p>
<p>在本书的其余部分，我们将遇到不同的情况:</p>
<ul>
<li><p>1、所提供的惟一选项是并行的。这很简单，因为我们别无选择，只能使用它。这种情况是比较罕见的。</p>
</li>
<li><p>2、有多个选项，但是并行版本(通常是最新的版本)被设计成在任何地方都可以使用(甚至在那些不关心并行性的代码中)，如案例#1。我们将按预期使用并行版本。</p>
</li>
<li><p>3、案例1和案例2并不经常发生。相反，您将遇到某些算法的两个版本，一个用于并行使用，另一个用于正常使用。我将描述并行的一个，但不会在普通代码中使用它，因为它也许会产生所有可能的问题。</p>
</li>
</ul>
<p>我建议您在自己的代码中采用这种方法。</p>
<p><a href="要进一步了解为什么这是一个难题，请参阅Doug Lea的文章。">http://gee.cs.oswego.edu/dl/html/StreamParallelGuidance.html</a></p>
<p><strong>parallelSetAll()</strong></p>
<p>流式编程产生优雅的代码。例如，假设我们想要创建一个数值由从零开始填充的长数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/CountUpward.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.LongStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountUpward</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span>[] fillCounted(<span class="keyword">int</span> size) &#123;</span><br><span class="line">        <span class="keyword">return</span> LongStream.iterate(<span class="number">0</span>, i -&gt; i + <span class="number">1</span>).limit(size).toArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span>[] l1 = fillCounted(<span class="number">20</span>); <span class="comment">// No problem</span></span><br><span class="line">        show(l1);</span><br><span class="line">        <span class="comment">// On my machine, this runs out of heap space:</span></span><br><span class="line">        <span class="comment">// - long[] l2 = fillCounted(10_000_000);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,</span></span><br><span class="line"><span class="comment">16, 17, 18, 19]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>流</strong> 实际上可以存储到将近1000万，但是之后就会耗尽堆空间。常规的 <strong>setAll()</strong> 是有效的，但是如果我们能更快地处理如此大量的数字，那就更好了。<br>我们可以使用 <strong>setAll()</strong> 初始化更大的数组。如果速度成为一个问题，<strong>Arrays.parallelSetAll()</strong> 将(可能)更快地执行初始化(请记住并行性中描述的问题)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// arrays/ParallelSetAll.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParallelSetAll</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">10_000_000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">intArray</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] ia = <span class="keyword">new</span> <span class="keyword">int</span>[SIZE];</span><br><span class="line">        Arrays.setAll(ia, <span class="keyword">new</span> Rand.Pint()::get);</span><br><span class="line">        Arrays.parallelSetAll(ia, <span class="keyword">new</span> Rand.Pint()::get);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">longArray</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span>[] la = <span class="keyword">new</span> <span class="keyword">long</span>[SIZE];</span><br><span class="line">        Arrays.setAll(la, <span class="keyword">new</span> Rand.Plong()::get);</span><br><span class="line">        Arrays.parallelSetAll(la, <span class="keyword">new</span> Rand.Plong()::get);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        intArray();</span><br><span class="line">        longArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数组分配和初始化是在单独的方法中执行的，因为如果两个数组都在 <strong>main()</strong> 中分配，它会耗尽内存(至少在我的机器上是这样。还有一些方法可以告诉Java在启动时分配更多的内存)。</p>
<!-- Arrays Utilities -->
<h2 id="Arrays工具类"><a href="#Arrays工具类" class="headerlink" title="Arrays工具类"></a>Arrays工具类</h2><p>您已经看到了 <strong>java.util.Arrays</strong> 中的 <strong>fill()</strong> 和 <strong>setAll()/parallelSetAll()</strong> 。该类包含许多其他有用的 <strong>静态</strong> 程序方法，我们将对此进行研究。</p>
<p>概述:</p>
<ul>
<li><p><strong>asList()</strong>: 获取任何序列或数组，并将其转换为一个 <strong>列表集合</strong> （集合章节介绍了此方法）。</p>
</li>
<li><p><strong>copyOf()</strong>：以新的长度创建现有数组的新副本。</p>
</li>
<li><p><strong>copyOfRange()</strong>：创建现有数组的一部分的新副本。</p>
</li>
<li><p><strong>equals()</strong>：比较两个数组是否相等。</p>
</li>
<li><p><strong>deepEquals()</strong>：多维数组的相等性比较。</p>
</li>
<li><p><strong>stream()</strong>：生成数组元素的流。</p>
</li>
<li><p><strong>hashCode()</strong>：生成数组的哈希值(您将在附录中了解这意味着什么:理解equals()和hashCode())。</p>
</li>
<li><p><strong>deepHashCode()</strong>: 多维数组的哈希值。</p>
</li>
<li><p><strong>sort()</strong>：排序数组</p>
</li>
<li><p><strong>parallelSort()</strong>：对数组进行并行排序，以提高速度。</p>
</li>
<li><p><strong>binarySearch()</strong>：在已排序的数组中查找元素。</p>
</li>
<li><p><strong>parallelPrefix()</strong>：使用提供的函数并行累积(以获得速度)。基本上，就是数组的reduce()。</p>
</li>
<li><p><strong>spliterator()</strong>：从数组中产生一个Spliterator;这是本书没有涉及到的流的高级部分。</p>
</li>
<li><p><strong>toString()</strong>：为数组生成一个字符串表示。你在整个章节中经常看到这种用法。</p>
</li>
<li><p><strong>deepToString()</strong>：为多维数组生成一个字符串。你在整个章节中经常看到这种用法。对于所有基本类型和对象，所有这些方法都是重载的。</p>
</li>
</ul>
<!-- Copying an Array -->
<h2 id="数组拷贝"><a href="#数组拷贝" class="headerlink" title="数组拷贝"></a>数组拷贝</h2><p>与使用for循环手工执行复制相比，<strong>copyOf()</strong> 和 <strong>copyOfRange()</strong> 复制数组要快得多。这些方法被重载以处理所有类型。</p>
<p>我们从复制 <strong>int</strong> 和 <strong>Integer</strong> 数组开始:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ArrayCopying.java</span></span><br><span class="line"><span class="comment">// Demonstrate Arrays.copy() and Arrays.copyOf()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sup</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Superclass</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    Sup(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        id = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName() + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sub</span> <span class="keyword">extends</span> <span class="title">Sup</span> </span>&#123; <span class="comment">// Subclass</span></span><br><span class="line"></span><br><span class="line">    Sub(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">super</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayCopying</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SZ = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] a1 = <span class="keyword">new</span> <span class="keyword">int</span>[SZ];</span><br><span class="line">        Arrays.setAll(a1, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        show(<span class="string">"a1"</span>, a1);</span><br><span class="line">        <span class="keyword">int</span>[] a2 = Arrays.copyOf(a1, a1.length); <span class="comment">// [1]</span></span><br><span class="line">        <span class="comment">// Prove they are distinct arrays:</span></span><br><span class="line">        Arrays.fill(a1, <span class="number">1</span>);</span><br><span class="line">        show(<span class="string">"a1"</span>, a1);</span><br><span class="line">        show(<span class="string">"a2"</span>, a2);</span><br><span class="line">        <span class="comment">// Create a shorter result:</span></span><br><span class="line">        a2 = Arrays.copyOf(a2, a2.length / <span class="number">2</span>); <span class="comment">// [2]</span></span><br><span class="line">        show(<span class="string">"a2"</span>, a2);</span><br><span class="line">        <span class="comment">// Allocate more space:</span></span><br><span class="line">        a2 = Arrays.copyOf(a2, a2.length + <span class="number">5</span>);</span><br><span class="line">        show(<span class="string">"a2"</span>, a2);</span><br><span class="line">        <span class="comment">// Also copies wrapped arrays:</span></span><br><span class="line">        Integer[] a3 = <span class="keyword">new</span> Integer[SZ]; <span class="comment">// [3]</span></span><br><span class="line">        Arrays.setAll(a3, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        Integer[] a4 = Arrays.copyOfRange(a3, <span class="number">4</span>, <span class="number">12</span>);</span><br><span class="line">        show(<span class="string">"a4"</span>, a4);</span><br><span class="line">        Sub[] d = <span class="keyword">new</span> Sub[SZ / <span class="number">2</span>];</span><br><span class="line">        Arrays.setAll(d, Sub::<span class="keyword">new</span>); <span class="comment">// Produce Sup[] from Sub[]:</span></span><br><span class="line">        Sup[] b = Arrays.copyOf(d, d.length, Sup[].class); <span class="comment">// [4]</span></span><br><span class="line">        show(b); <span class="comment">// This "downcast" works fine:</span></span><br><span class="line">        Sub[] d2 = Arrays.copyOf(b, b.length, Sub[].class); <span class="comment">// [5]</span></span><br><span class="line">        show(d2); <span class="comment">// Bad "downcast" compiles but throws exception:</span></span><br><span class="line">        Sup[] b2 = <span class="keyword">new</span> Sup[SZ / <span class="number">2</span>];</span><br><span class="line">        Arrays.setAll(b2, Sup::<span class="keyword">new</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Sub[] d3 = Arrays.copyOf(b2, b2.length, Sub[].class); <span class="comment">// [6]</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output: a1: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14] a1: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</span></span><br><span class="line"><span class="comment">           a2:[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]a2:[0, 1, 2, 3, 4, 5, 6]a2:[</span></span><br><span class="line"><span class="comment">           0, 1, 2, 3, 4, 5, 6, 0, 0, 0, 0, 0]a4:[4, 5, 6, 7, 8, 9, 10, 11][Sub0, Sub1, Sub2, Sub3, Sub4, Sub5, Sub6][</span></span><br><span class="line"><span class="comment">           Sub0, Sub1, Sub2, Sub3, Sub4, Sub5, Sub6]java.lang.ArrayStoreException */</span></span><br></pre></td></tr></table></figure></p>
<p>[1] 这是复制的基本方法;只需给出返回的复制数组的大小。这对于编写需要调整存储大小的算法很有帮助。复制之后，我们把a1的所有元素都设为1，以证明a1的变化不会影响a2中的任何东西。</p>
<p>[2] 通过更改最后一个参数，我们可以缩短或延长返回的复制数组。</p>
<p>[3] <strong>copyOf()</strong> 和 <strong>copyOfRange()</strong> 也可以使用包装类型。<strong>copyOfRange()</strong> 需要一个开始和结束索引。</p>
<p>[4] <strong>copyOf()</strong> 和 <strong>copyOfRange()</strong> 都有一个版本，该版本通过在方法调用的末尾添加目标类型来创建不同类型的数组。我首先想到的是，这可能是一种从原生数组生成包装数组的方法，反之亦然。<br>但这没用。它的实际用途是“向上转换”和“向下转换”数组。也就是说，如果您有一个子类型(派生类型)的数组，而您想要一个基类型的数组，那么这些方法将生成所需的数组。</p>
<p>[5] 您甚至可以成功地“向下强制转换”，并从超类型的数组生成子类型的数组。这个版本运行良好，因为我们只是“upcast”。</p>
<p>[6] 这个“数组转换”将编译，但是如果类型不兼容，您将得到一个运行时异常。在这里，强制将基类型转换为派生类型是非法的，因为派生对象中可能有基对象中没有的属性和方法。</p>
<p>实例表明，原生数组和对象数组都可以被复制。但是，如果复制对象的数组，那么只复制引用—不复制对象本身。这称为浅拷贝(有关更多细节，请参阅附录:传递和返回对象)。</p>
<p>还有一个方法 <strong>System.arraycopy()</strong> ，它将一个数组复制到另一个已经分配的数组中。这将不会执行自动装箱或自动卸载—两个数组必须是完全相同的类型。</p>
<!-- Comparing Arrays -->
<h2 id="数组比较"><a href="#数组比较" class="headerlink" title="数组比较"></a>数组比较</h2><p><strong>数组</strong> 提供了 <strong>equals()</strong> 来比较一维数组，以及 <strong>deepEquals()</strong> 来比较多维数组。对于所有原生类型和对象，这些方法都是重载的。</p>
<p>数组相等的含义：数组必须有相同数量的元素，并且每个元素必须与另一个数组中的对应元素相等，对每个元素使用 <strong>equals()</strong>(对于原生类型，使用原生类型的包装类的 <strong>equals()</strong> 方法;例如，int的Integer.equals()。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ComparingArrays.java</span></span><br><span class="line"><span class="comment">// Using Arrays.equals()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComparingArrays</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SZ = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String[][] twoDArray() &#123;</span><br><span class="line">        String[][] md = <span class="keyword">new</span> String[<span class="number">5</span>][];</span><br><span class="line">        Arrays.setAll(md, n -&gt; <span class="keyword">new</span> String[n]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; md.length; i++) Arrays.setAll(md[i], <span class="keyword">new</span> Rand.String()::get);</span><br><span class="line">        <span class="keyword">return</span> md;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] a1 = <span class="keyword">new</span> <span class="keyword">int</span>[SZ], a2 = <span class="keyword">new</span> <span class="keyword">int</span>[SZ];</span><br><span class="line">        Arrays.setAll(a1, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        Arrays.setAll(a2, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        System.out.println(<span class="string">"a1 == a2: "</span> + Arrays.equals(a1, a2));</span><br><span class="line">        a2[<span class="number">3</span>] = <span class="number">11</span>;</span><br><span class="line">        System.out.println(<span class="string">"a1 == a2: "</span> + Arrays.equals(a1, a2));</span><br><span class="line">        Integer[] a1w = <span class="keyword">new</span> Integer[SZ], a2w = <span class="keyword">new</span> Integer[SZ];</span><br><span class="line">        Arrays.setAll(a1w, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        Arrays.setAll(a2w, <span class="keyword">new</span> Count.Integer()::get);</span><br><span class="line">        System.out.println(<span class="string">"a1w == a2w: "</span> + Arrays.equals(a1w, a2w));</span><br><span class="line">        a2w[<span class="number">3</span>] = <span class="number">11</span>;</span><br><span class="line">        System.out.println(<span class="string">"a1w == a2w: "</span> + Arrays.equals(a1w, a2w));</span><br><span class="line">        String[][] md1 = twoDArray(), md2 = twoDArray();</span><br><span class="line">        System.out.println(Arrays.deepToString(md1));</span><br><span class="line">        System.out.println(<span class="string">"deepEquals(md1, md2): "</span> + Arrays.deepEquals(md1, md2));</span><br><span class="line">        System.out.println(<span class="string">"md1 == md2: "</span> + Arrays.equals(md1, md2));</span><br><span class="line">        md1[<span class="number">4</span>][<span class="number">1</span>] = <span class="string">"#$#$#$#"</span>;</span><br><span class="line">        System.out.println(Arrays.deepToString(md1));</span><br><span class="line">        System.out.println(<span class="string">"deepEquals(md1, md2): "</span> + Arrays.deepEquals(md1, md2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">a1 == a2: true</span></span><br><span class="line"><span class="comment">a1 == a2: false</span></span><br><span class="line"><span class="comment">a1w == a2w: true</span></span><br><span class="line"><span class="comment">a1w == a2w: false</span></span><br><span class="line"><span class="comment">[[], [btpenpc], [btpenpc, cuxszgv], [btpenpc, cuxszgv,</span></span><br><span class="line"><span class="comment"> gmeinne], [btpenpc, cuxszgv, gmeinne, eloztdv]]</span></span><br><span class="line"><span class="comment"> deepEquals(md1, md2): true</span></span><br><span class="line"><span class="comment"> md1 == md2: false</span></span><br><span class="line"><span class="comment"> [[], [btpenpc], [btpenpc, cuxszgv], [btpenpc, cuxszgv,</span></span><br><span class="line"><span class="comment"> gmeinne], [btpenpc, #$#$#$#, gmeinne, eloztdv]]</span></span><br><span class="line"><span class="comment"> deepEquals(md1, md2): false</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<p>最初，a1和a2是完全相等的，所以输出是true，但是之后其中一个元素改变了，这使得结果为false。a1w和a2w是对一个封装类型数组重复该练习。</p>
<p><strong>md1</strong> 和 <strong>md2</strong> 是通过 <strong>twoDArray()</strong> 以相同方式初始化的多维字符串数组。注意，<strong>deepEquals()</strong> 返回 <strong>true</strong>，因为它执行了适当的比较，而普通的 <strong>equals()</strong> 错误地返回 <strong>false</strong>。如果我们更改数组中的一个元素，<strong>deepEquals()</strong> 将检测它。</p>
<!-- Streams and Arrays -->
<h2 id="流和数组"><a href="#流和数组" class="headerlink" title="流和数组"></a>流和数组</h2><p><strong>stream()</strong> 方法很容易从某些类型的数组中生成元素流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/StreamFromArray.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamFromArray</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] s = <span class="keyword">new</span> Rand.String().array(<span class="number">10</span>);</span><br><span class="line">        Arrays.stream(s).skip(<span class="number">3</span>).limit(<span class="number">5</span>).map(ss -&gt; ss + <span class="string">"!"</span>).forEach(System.out::println);</span><br><span class="line">        <span class="keyword">int</span>[] ia = <span class="keyword">new</span> Rand.Pint().array(<span class="number">10</span>);</span><br><span class="line">        Arrays.stream(ia).skip(<span class="number">3</span>).limit(<span class="number">5</span>)</span><br><span class="line">                .map(i -&gt; i * <span class="number">10</span>).forEach(System.out::println);</span><br><span class="line">        Arrays.stream(<span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">10</span>]);</span><br><span class="line">        Arrays.stream(<span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">10</span>]);</span><br><span class="line">        <span class="comment">// Only int, long and double work:</span></span><br><span class="line">        <span class="comment">// - Arrays.stream(new boolean[10]);</span></span><br><span class="line">        <span class="comment">// - Arrays.stream(new byte[10]);</span></span><br><span class="line">        <span class="comment">// - Arrays.stream(new char[10]);</span></span><br><span class="line">        <span class="comment">// - Arrays.stream(new short[10]);</span></span><br><span class="line">        <span class="comment">// - Arrays.stream(new float[10]);</span></span><br><span class="line">        <span class="comment">// For the other types you must use wrapped arrays:</span></span><br><span class="line">        <span class="keyword">float</span>[] fa = <span class="keyword">new</span> Rand.Pfloat().array(<span class="number">10</span>);</span><br><span class="line">        Arrays.stream(ConvertTo.boxed(fa));</span><br><span class="line">        Arrays.stream(<span class="keyword">new</span> Rand.Float().array(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">    eloztdv!</span></span><br><span class="line"><span class="comment">    ewcippc!</span></span><br><span class="line"><span class="comment">    ygpoalk!</span></span><br><span class="line"><span class="comment">    ljlbynx!</span></span><br><span class="line"><span class="comment">    taprwxz!</span></span><br><span class="line"><span class="comment">    47200</span></span><br><span class="line"><span class="comment">    61770</span></span><br><span class="line"><span class="comment">    84790</span></span><br><span class="line"><span class="comment">    66560</span></span><br><span class="line"><span class="comment">    37680</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>只有“原生类型” <strong>int</strong>、<strong>long</strong> 和 <strong>double</strong> 可以与 <strong>Arrays.stream()</strong> 一起使用;对于其他的，您必须以某种方式获得一个包装类型的数组。</p>
<p>通常，将数组转换为流来生成所需的结果要比直接操作数组容易得多。请注意，即使流已经“用完”(您不能重复使用它)，您仍然拥有该数组，因此您可以以其他方式使用它—-包括生成另一个流。</p>
<!-- Sorting Arrays -->
<h2 id="数组排序"><a href="#数组排序" class="headerlink" title="数组排序"></a>数组排序</h2><p>根据对象的实际类型执行比较排序。一种方法是为不同的类型编写对应的排序方法，但是这样的代码不能复用。</p>
<p>编程设计的一个主要目标是“将易变的元素与稳定的元素分开”，在这里，保持不变的代码是一般的排序算法，但是变化的是对象的比较方式。因此，使用策略设计模式而不是将比较代码放入许多不同的排序源码中。使用策略模式时，变化的代码部分被封装在一个单独的类(策略对象)中。</p>
<p>您将一个策略对象交给相同的代码，该代码使用策略模式来实现其算法。通过这种方式，您将使用相同的排序代码，使不同的对象表达不同的比较方式。</p>
<p>Java有两种方式提供比较功能。第一种方法是通过实现 <strong>java.lang.Comparable</strong> 接口的原生方法。这是一个简单的接口，只含有一个方法 <strong>compareTo()</strong>。该方法接受另一个与参数类型相同的对象作为参数，如果当前对象小于参数，则产生一个负值;如果参数相等，则产生零值;如果当前对象大于参数，则产生一个正值。</p>
<p>这里有一个类，它实现了 <strong>Comparable</strong> 接口并演示了可比性，而且使用Java标准库方法 <strong>Arrays.sort()</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/CompType.java</span></span><br><span class="line"><span class="comment">// Implementing Comparable in a class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.SplittableRandom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompType</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">CompType</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SplittableRandom r = <span class="keyword">new</span> SplittableRandom(<span class="number">47</span>);</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CompType</span><span class="params">(<span class="keyword">int</span> n1, <span class="keyword">int</span> n2)</span> </span>&#123;</span><br><span class="line">        i = n1;</span><br><span class="line">        j = n2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CompType <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CompType(r.nextInt(<span class="number">100</span>), r.nextInt(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CompType[] a = <span class="keyword">new</span> CompType[<span class="number">12</span>];</span><br><span class="line">        Arrays.setAll(a, n -&gt; get());</span><br><span class="line">        show(<span class="string">"Before sorting"</span>, a);</span><br><span class="line">        Arrays.sort(a);</span><br><span class="line">        show(<span class="string">"After sorting"</span>, a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String result = <span class="string">"[i = "</span> + i + <span class="string">", j = "</span> + j + <span class="string">"]"</span>;</span><br><span class="line">        <span class="keyword">if</span> (count++ % <span class="number">3</span> == <span class="number">0</span>) result += <span class="string">"\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(CompType rv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (i &lt; rv.i ? -<span class="number">1</span> : (i == rv.i ? <span class="number">0</span> : <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Before sorting: [[i = 35, j = 37], [i = 41, j = 20], [i = 77, j = 79] ,</span></span><br><span class="line"><span class="comment">                [i = 56, j = 68], [i = 48, j = 93],</span></span><br><span class="line"><span class="comment">                [i = 70, j = 7] , [i = 0, j = 25],</span></span><br><span class="line"><span class="comment">                [i = 62, j = 34], [i = 50, j = 82] ,</span></span><br><span class="line"><span class="comment">                [i = 31, j = 67], [i = 66, j = 54],</span></span><br><span class="line"><span class="comment">                [i = 21, j = 6] ]</span></span><br><span class="line"><span class="comment">After sorting: [[i = 0, j = 25], [i = 21, j = 6], [i = 31, j = 67] ,</span></span><br><span class="line"><span class="comment">               [i = 35, j = 37], [i = 41, j = 20], [i = 48, j = 93] ,</span></span><br><span class="line"><span class="comment">               [i = 50, j = 82], [i = 56, j = 68], [i = 62, j = 34] ,</span></span><br><span class="line"><span class="comment">               [i = 66, j = 54], [i = 70, j = 7], [i = 77, j = 79] ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>当您定义比较方法时，您有责任决定将一个对象与另一个对象进行比较意味着什么。这里，在比较中只使用i值和j值<br>将被忽略。</p>
<p><strong>get()</strong> 方法通过使用随机值初始化CompType对象来构建它们。在 <strong>main()</strong> 中，<strong>get()</strong> 与 <strong>Arrays.setAll()</strong> 一起使用，以填充一个 <strong>CompType类型</strong> 数组，然后对其排序。如果没有实现 <strong>Comparable接口</strong>，那么当您试图调用 <strong>sort()</strong> 时，您将在运行时获得一个 <strong>ClassCastException</strong> 。这是因为 <strong>sort()</strong> 将其参数转换为 <strong>Comparable类型</strong>。</p>
<p>现在假设有人给了你一个没有实现 <strong>Comparable接口</strong> 的类，或者给了你一个实现 <strong>Comparable接口</strong> 的类，但是你不喜欢它的工作方式而愿意有一个不同的对于此类型的比较方法。为了解决这个问题，创建一个实现 <strong>Comparator</strong> 接口的单独的类(在集合一章中简要介绍)。它有两个方法，<strong>compare()</strong> 和 <strong>equals()</strong>。但是，除了特殊的性能需求外，您不需要实现 <strong>equals()</strong>，因为无论何时创建一个类，它都是隐式地继承自 <strong>Object</strong>，<strong>Object</strong> 有一个equals()。您可以只使用默认的 <strong>Object equals()</strong> 来满足接口的规范。</p>
<p>集合类(注意复数;我们将在下一章节讨论它) 包含一个方法 <strong>reverseOrder()</strong>，它生成一个来 <strong>Comparator</strong>（比较器）反转自然排序顺序。这可以应用到比较对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/Reverse.java</span></span><br><span class="line"><span class="comment">// The Collections.reverseOrder() Comparator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reverse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CompType[] a = <span class="keyword">new</span> CompType[<span class="number">12</span>];</span><br><span class="line">        Arrays.setAll(a, n -&gt; CompType.get());</span><br><span class="line">        show(<span class="string">"Before sorting"</span>, a);</span><br><span class="line">        Arrays.sort(a, Collections.reverseOrder());</span><br><span class="line">        show(<span class="string">"After sorting"</span>, a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Before sorting: [[i = 35, j = 37], [i = 41, j = 20],</span></span><br><span class="line"><span class="comment">                [i = 77, j = 79] , [i = 56, j = 68],</span></span><br><span class="line"><span class="comment">                [i = 48, j = 93], [i = 70, j = 7],</span></span><br><span class="line"><span class="comment">                [i = 0, j = 25], [i = 62, j = 34],</span></span><br><span class="line"><span class="comment">                [i = 50, j = 82] , [i = 31, j = 67],</span></span><br><span class="line"><span class="comment">                [i = 66, j = 54], [i = 21, j = 6] ]</span></span><br><span class="line"><span class="comment">After sorting: [[i = 77, j = 79], [i = 70, j = 7],</span></span><br><span class="line"><span class="comment">                [i = 66, j = 54] , [i = 62, j = 34],</span></span><br><span class="line"><span class="comment">                [i = 56, j = 68], [i = 50, j = 82] ,</span></span><br><span class="line"><span class="comment">                [i = 48, j = 93], [i = 41, j = 20],</span></span><br><span class="line"><span class="comment">                [i = 35, j = 37] , [i = 31, j = 67],</span></span><br><span class="line"><span class="comment">                [i = 21, j = 6], [i = 0, j = 25] ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>您还可以编写自己的比较器。这个比较CompType对象基于它们的j值而不是它们的i值:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ComparatorTest.java</span></span><br><span class="line"><span class="comment">// Implementing a Comparator for a class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompTypeComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">CompType</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(CompType o1, CompType o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (o1.j &lt; o2.j ? -<span class="number">1</span> : (o1.j == o2.j ? <span class="number">0</span> : <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComparatorTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CompType[] a = <span class="keyword">new</span> CompType[<span class="number">12</span>];</span><br><span class="line">        Arrays.setAll(a, n -&gt; CompType.get());</span><br><span class="line">        show(<span class="string">"Before sorting"</span>, a);</span><br><span class="line">        Arrays.sort(a, <span class="keyword">new</span> CompTypeComparator());</span><br><span class="line">        show(<span class="string">"After sorting"</span>, a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Before sorting:[[i = 35, j = 37], [i = 41, j = 20], [i = 77, j = 79] ,</span></span><br><span class="line"><span class="comment">                [i = 56, j = 68], [i = 48, j = 93], [i = 70, j = 7] ,</span></span><br><span class="line"><span class="comment">                [i = 0, j = 25], [i = 62, j = 34], [i = 50, j = 82],</span></span><br><span class="line"><span class="comment">                [i = 31, j = 67], [i = 66, j = 54], [i = 21, j = 6] ]</span></span><br><span class="line"><span class="comment">After sorting: [[i = 21, j = 6], [i = 70, j = 7], [i = 41, j = 20] ,</span></span><br><span class="line"><span class="comment">                [i = 0, j = 25], [i = 62, j = 34], [i = 35, j = 37] ,</span></span><br><span class="line"><span class="comment">                [i = 66, j = 54], [i = 31, j = 67], [i = 56, j = 68] ,</span></span><br><span class="line"><span class="comment">                [i = 77, j = 79], [i = 50, j = 82], [i = 48, j = 93] ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<!-- Using Arrays.sort() -->
<h2 id="Arrays-sort-的使用"><a href="#Arrays-sort-的使用" class="headerlink" title="Arrays.sort()的使用"></a>Arrays.sort()的使用</h2><p>使用内置的排序方法，您可以对实现了 <strong>Comparable</strong> 接口或具有 <strong>Comparator</strong> 的任何对象数组 或 任何原生数组进行排序。这里我们生成一个随机字符串对象数组并对其排序:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/StringSorting.java</span></span><br><span class="line"><span class="comment">// Sorting an array of Strings</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringSorting</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] sa = <span class="keyword">new</span> Rand.String().array(<span class="number">20</span>);</span><br><span class="line">        show(<span class="string">"Before sort"</span>, sa);</span><br><span class="line">        Arrays.sort(sa);</span><br><span class="line">        show(<span class="string">"After sort"</span>, sa);</span><br><span class="line">        Arrays.sort(sa, Collections.reverseOrder());</span><br><span class="line">        show(<span class="string">"Reverse sort"</span>, sa);</span><br><span class="line">        Arrays.sort(sa, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        show(<span class="string">"Case-insensitive sort"</span>, sa);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Before sort: [btpenpc, cuxszgv, gmeinne, eloztdv, ewcippc,</span></span><br><span class="line"><span class="comment">            ygpoalk, ljlbynx, taprwxz, bhmupju, cjwzmmr,</span></span><br><span class="line"><span class="comment">            anmkkyh, fcjpthl, skddcat, jbvlgwc, mvducuj,</span></span><br><span class="line"><span class="comment">            ydpulcq, zehpfmm, zrxmclh, qgekgly, hyoubzl]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">After sort: [anmkkyh, bhmupju, btpenpc, cjwzmmr, cuxszgv,</span></span><br><span class="line"><span class="comment">            eloztdv, ewcippc, fcjpthl, gmeinne, hyoubzl,</span></span><br><span class="line"><span class="comment">            jbvlgwc, ljlbynx, mvducuj, qgekgly, skddcat,</span></span><br><span class="line"><span class="comment">            taprwxz, ydpulcq, ygpoalk, zehpfmm, zrxmclh]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Reverse sort: [zrxmclh, zehpfmm, ygpoalk, ydpulcq,taprwxz,</span></span><br><span class="line"><span class="comment">            skddcat, qgekgly, mvducuj, ljlbynx, jbvlgwc,</span></span><br><span class="line"><span class="comment">            hyoubzl, gmeinne, fcjpthl, ewcippc, eloztdv,</span></span><br><span class="line"><span class="comment">            cuxszgv, cjwzmmr, btpenpc, bhmupju, anmkkyh]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Case-insensitive sort: [anmkkyh, bhmupju, btpenpc, cjwzmmr,</span></span><br><span class="line"><span class="comment">                cuxszgv, eloztdv, ewcippc, fcjpthl, gmeinne,</span></span><br><span class="line"><span class="comment">                hyoubzl, jbvlgwc, ljlbynx, mvducuj, qgekgly,</span></span><br><span class="line"><span class="comment">                skddcat, taprwxz, ydpulcq, ygpoalk, zehpfmm, zrxmclh]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>注意字符串排序算法中的输出。它是字典式的，所以它把所有以大写字母开头的单词放在前面，然后是所有以小写字母开头的单词。(电话簿通常是这样分类的。)无论大小写，要将单词组合在一起，请使用 <strong>String.CASE_INSENSITIVE_ORDER</strong> ，如对sort()的最后一次调用所示。</p>
<p>Java标准库中使用的排序算法被设计为最适合您正在排序的类型—-原生类型的快速排序和对象的归并排序。</p>
<!-- Sorting in Parallel -->
<h2 id="并行排序"><a href="#并行排序" class="headerlink" title="并行排序"></a>并行排序</h2><p>如果排序性能是一个问题，那么可以使用 <strong>Java 8 parallelSort()</strong>，它为所有不可预见的情况(包括数组的排序区域或使用了比较器)提供了重载版本。为了查看相比于普通的sort(), <strong>parallelSort()</strong> 的优点，我们使用了用来验证代码时的 <strong>JMH</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/jmh/ParallelSort.java</span></span><br><span class="line"><span class="keyword">package</span> arrays.jmh;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@State</span>(Scope.Thread)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParallelSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span>[] la;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setup</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        la = <span class="keyword">new</span> Rand.Plong().array(<span class="number">100_000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Arrays.sort(la);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parallelSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Arrays.parallelSort(la);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>parallelSort()</strong> 算法将大数组拆分成更小的数组，直到数组大小达到极限，然后使用普通的 <strong>Arrays .sort()</strong> 方法。然后合并结果。该算法需要不大于原始数组的额外工作空间。</p>
<p>您可能会看到不同的结果，但是在我的机器上，并行排序将速度提高了大约3倍。由于并行版本使用起来很简单，所以很容易考虑在任何地方使用它，而不是<br><strong>Arrays.sort ()</strong>。当然，它可能不是那么简单—看看微基准测试。</p>
<!-- Searching with Arrays.binarySearch() -->
<h2 id="binarySearch二分查找"><a href="#binarySearch二分查找" class="headerlink" title="binarySearch二分查找"></a>binarySearch二分查找</h2><p>一旦数组被排序，您就可以通过使用 <strong>Arrays.binarySearch()</strong> 来执行对特定项的快速搜索。但是，如果尝试在未排序的数组上使用 <strong>binarySearch()</strong>，结果是不可预测的。下面的示例使用 <strong>Rand.Pint</strong> 类来创建一个填充随机整形值的数组，然后调用 <strong>getAsInt()</strong> (因为 <strong>Rand.Pint</strong> 是一个 <strong>IntSupplier</strong>)来产生搜索值:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ArraySearching.java</span></span><br><span class="line"><span class="comment">// Using Arrays.binarySearch()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArraySearching</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Rand.Pint rand = <span class="keyword">new</span> Rand.Pint();</span><br><span class="line">        <span class="keyword">int</span>[] a = <span class="keyword">new</span> Rand.Pint().array(<span class="number">25</span>);</span><br><span class="line">        Arrays.sort(a);</span><br><span class="line">        show(<span class="string">"Sorted array"</span>, a);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> r = rand.getAsInt();</span><br><span class="line">            <span class="keyword">int</span> location = Arrays.binarySearch(a, r);</span><br><span class="line">            <span class="keyword">if</span> (location &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Location of "</span> + r + <span class="string">" is "</span> + location + <span class="string">", a["</span> + location + <span class="string">"] is "</span> + a[location]);</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// Out of while loop</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Sorted array: [125, 267, 635, 650, 1131, 1506, 1634, 2400, 2766,</span></span><br><span class="line"><span class="comment">               3063, 3768, 3941, 4720, 4762, 4948, 5070, 5682,</span></span><br><span class="line"><span class="comment">               5807, 6177, 6193, 6656, 7021, 8479, 8737, 9954]</span></span><br><span class="line"><span class="comment">Location of 635 is 2, a[2] is 635</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>在while循环中，随机值作为搜索项生成，直到在数组中找到其中一个为止。</p>
<p>如果找到了搜索项，<strong>Arrays.binarySearch()</strong> 将生成一个大于或等于零的值。否则，它将产生一个负值，表示如果手动维护已排序的数组，则应该插入元素的位置。产生的值是 -(插入点) - 1 。插入点是大于键的第一个元素的索引，如果数组中的所有元素都小于指定的键，则是 <strong>a.size()</strong> 。</p>
<p>如果数组包含重复的元素，则无法保证找到其中的那些重复项。搜索算法不是为了支持重复的元素，而是为了容忍它们。如果需要没有重复元素的排序列表，可以使用 <strong>TreeSet</strong> (用于维持排序顺序)或 <strong>LinkedHashSet</strong> (用于维持插入顺序)。这些类自动为您处理所有的细节。只有在出现性能瓶颈的情况下，才应该使用手工维护的数组替换这些类中的一个。</p>
<p>如果使用比较器(原语数组不允许使用比较器进行排序)对对象数组进行排序，那么在执行 <strong>binarySearch()</strong> (使用重载版本的binarySearch())时必须包含相同的比较器。例如，可以修改 <strong>StringSorting.java</strong> 来执行搜索:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/AlphabeticSearch.java</span></span><br><span class="line"><span class="comment">// Searching with a Comparator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlphabeticSearch</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] sa = <span class="keyword">new</span> Rand.String().array(<span class="number">30</span>);</span><br><span class="line">        Arrays.sort(sa, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        show(sa);</span><br><span class="line">        <span class="keyword">int</span> index = Arrays.binarySearch(sa, sa[<span class="number">10</span>], String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        System.out.println(<span class="string">"Index: "</span> + index + <span class="string">"\n"</span> + sa[index]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[anmkkyh, bhmupju, btpenpc, cjwzmmr, cuxszgv, eloztdv, ewcippc,</span></span><br><span class="line"><span class="comment">ezdeklu, fcjpthl, fqmlgsh, gmeinne, hyoubzl, jbvlgwc, jlxpqds,</span></span><br><span class="line"><span class="comment">ljlbynx, mvducuj, qgekgly, skddcat, taprwxz, uybypgp, vjsszkn,</span></span><br><span class="line"><span class="comment">vniyapk, vqqakbm, vwodhcf, ydpulcq, ygpoalk, yskvett, zehpfmm,</span></span><br><span class="line"><span class="comment">zofmmvm, zrxmclh]</span></span><br><span class="line"><span class="comment">Index: 10 gmeinne</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>比较器必须作为第三个参数传递给重载的 <strong>binarySearch()</strong> 。在本例中，成功是有保证的，因为搜索项是从数组本身中选择的。</p>
<!-- Accumulating with parallelPrefix() -->
<h2 id="parallelPrefix并行前缀"><a href="#parallelPrefix并行前缀" class="headerlink" title="parallelPrefix并行前缀"></a>parallelPrefix并行前缀</h2><p>没有“prefix()”方法，只有 <strong>parallelPrefix()</strong>。这类似于 <strong>Stream</strong> 类中的 <strong>reduce()</strong> 方法:它对前一个元素和当前元素执行一个操作，并将结果放入当前元素位置:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ParallelPrefix1.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParallelPrefix1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] nums = <span class="keyword">new</span> Count.Pint().array(<span class="number">10</span>);</span><br><span class="line">        show(nums);</span><br><span class="line">        System.out.println(Arrays.stream(nums).reduce(Integer::sum).getAsInt());</span><br><span class="line">        Arrays.parallelPrefix(nums, Integer::sum);</span><br><span class="line">        show(nums);</span><br><span class="line">        System.out.println(Arrays.stream(<span class="keyword">new</span> Count.Pint().array(<span class="number">6</span>)).reduce(Integer::sum).getAsInt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line"><span class="comment">45</span></span><br><span class="line"><span class="comment">[0, 1, 3, 6, 10, 15, 21, 28, 36, 45]</span></span><br><span class="line"><span class="comment">15</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这里我们对数组应用Integer::sum。在位置0中，它将先前计算的值(因为没有先前的值)与原始数组位置0中的值组合在一起。在位置1中，它获取之前计算的值(它只是存储在位置0中)，并将其与位置1中先前计算的值相结合。依次往复。</p>
<p>使用 <strong>Stream.reduce()</strong>，您只能得到最终结果，而使用 <strong>Arrays.parallelPrefix()</strong>，您还可以得到所有中间计算，以确保它们是有用的。注意，第二个 <strong>Stream.reduce()</strong> 计算的结果已经在 <strong>parallelPrefix()</strong> 计算的数组中。</p>
<p>使用字符串可能更清楚:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ParallelPrefix2.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.ArrayShow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParallelPrefix2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] strings = <span class="keyword">new</span> Rand.String(<span class="number">1</span>).array(<span class="number">8</span>);</span><br><span class="line">        show(strings);</span><br><span class="line">        Arrays.parallelPrefix(strings, (a, b) -&gt; a + b);</span><br><span class="line">        show(strings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[b, t, p, e, n, p, c, c]</span></span><br><span class="line"><span class="comment">[b, bt, btp, btpe, btpen, btpenp, btpenpc, btpenpcc]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>如前所述，使用流进行初始化非常优雅，但是对于大型数组，这种方法可能会耗尽堆空间。使用 <strong>setAll()</strong> 执行初始化更节省内存:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arrays/ParallelPrefix3.java</span></span><br><span class="line"><span class="comment">// &#123;ExcludeFromTravisCI&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParallelPrefix3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">10_000_000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span>[] nums = <span class="keyword">new</span> <span class="keyword">long</span>[SIZE];</span><br><span class="line">        Arrays.setAll(nums, n -&gt; n);</span><br><span class="line">        Arrays.parallelPrefix(nums, Long::sum);</span><br><span class="line">        System.out.println(<span class="string">"First 20: "</span> + nums[<span class="number">19</span>]);</span><br><span class="line">        System.out.println(<span class="string">"First 200: "</span> + nums[<span class="number">199</span>]);</span><br><span class="line">        System.out.println(<span class="string">"All: "</span> + nums[nums.length - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">First 20: 190</span></span><br><span class="line"><span class="comment">First 200: 19900</span></span><br><span class="line"><span class="comment">All: 49999995000000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>因为正确使用 <strong>parallelPrefix()</strong> 可能相当复杂，所以通常应该只在存在内存或速度问题(或两者都有)时使用。否则，<strong>Stream.reduce()</strong> 应该是您的首选。</p>
<!-- Summary -->
<h2 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h2><p>Java为固定大小的低级数组提供了合理的支持。这种数组强调的是性能而不是灵活性，就像C和c++数组模型一样。在Java的最初版本中，固定大小的低级数组是绝对必要的，这不仅是因为Java设计人员选择包含原生类型(也考虑到性能)，还因为那个版本对集合的支持非常少。因此，在早期的Java版本中，选择数组总是合理的。</p>
<p>在Java的后续版本中，集合支持得到了显著的改进，现在集合在除性能外的所有方面都优于数组，即使这样，集合的性能也得到了显著的改进。正如本书其他部分所述，无论如何，性能问题通常不会出现在您设想的地方。</p>
<p>使用自动装箱和泛型，在集合中保存原生类型是毫不费力的，这进一步鼓励您用集合替换低级数组。由于泛型产生类型安全的集合，数组在这方面也不再有优势。</p>
<p>如本章所述，当您尝试使用泛型时，您将看到泛型对数组是相当不友好的。通常，即使可以让泛型和数组以某种形式一起工作(在下一章中您将看到)，在编译期间仍然会出现“unchecked”警告。</p>
<p>有几次，当我们讨论特定的例子时，我直接从Java语言设计人员那里听到我应该使用集合而不是数组(我使用数组来演示特定的技术，所以我没有这个选项)。</p>
<p>所有这些问题都表明，在使用Java的最新版本进行编程时，应该“优先选择集合而不是数组”。只有当您证明性能是一个问题(并且切换到一个数组实际上会有很大的不同)时，才应该重构到数组。这是一个相当大胆的声明，但是有些语言根本没有固定大小的低级数组。它们只有可调整大小的集合，而且比C/C++/java风格的数组功能多得多。例如，Python有一个使用基本数组语法的列表类型，但是具有更大的功能—您甚至可以从它继承:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arrays/PythonLists.py</span></span><br><span class="line"></span><br><span class="line">aList=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]print(type(aList)) <span class="comment">#&lt;type 'list'&gt;</span></span><br><span class="line">print(aList) <span class="comment"># [1,2,3,4,5]</span></span><br><span class="line">        print(aList[<span class="number">4</span>]) <span class="comment"># 5Basic list indexing</span></span><br><span class="line">        aList.append(<span class="number">6</span>) <span class="comment"># lists can be resized</span></span><br><span class="line">        aList+=[<span class="number">7</span>,<span class="number">8</span>] <span class="comment"># Add a list to a list</span></span><br><span class="line">        print(aList) <span class="comment"># [1,2,3,4,5,6,7,8]</span></span><br><span class="line">        aSlice=aList[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">        print(aSlice) <span class="comment"># [3,4]</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyList</span><span class="params">(list)</span>:</span> <span class="comment"># Inherit from list</span></span><br><span class="line">        <span class="comment"># Define a method;'this'pointer is explicit:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">getReversed</span><span class="params">(self)</span>:</span></span><br><span class="line">            reversed=self[:] <span class="comment"># Copy list using slices</span></span><br><span class="line">            reversed.reverse() <span class="comment"># Built-in list method</span></span><br><span class="line">            <span class="keyword">return</span> reversed</span><br><span class="line">        <span class="comment"># No'new'necessary for object creation:</span></span><br><span class="line">        list2=MyList(aList)</span><br><span class="line">        print(type(list2)) <span class="comment">#&lt;class '__main__.MyList'&gt;</span></span><br><span class="line">        print(list2.getReversed()) <span class="comment"># [8,7,6,5,4,3,2,1]</span></span><br><span class="line">        output=<span class="string">"""</span></span><br><span class="line"><span class="string">        &lt;class 'list'&gt;</span></span><br><span class="line"><span class="string">        [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="string">        5</span></span><br><span class="line"><span class="string">        [1, 2, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line"><span class="string">        [3, 4]</span></span><br><span class="line"><span class="string">        &lt;class '__main__.MyList'&gt;</span></span><br><span class="line"><span class="string">        [8, 7, 6, 5, 4, 3, 2, 1]</span></span><br><span class="line"><span class="string">        """</span></span><br></pre></td></tr></table></figure>
<p>前一章介绍了基本的Python语法。在这里，通过用方括号包围以逗号分隔的对象序列来创建列表。结果是一个运行时类型为list的对象(print语句的输出显示为同一行中的注释)。打印列表的结果与在Java中使用Arrays.toString()的结果相同。<br>通过将 : 操作符放在索引操作中，通过切片来创建列表的子序列。list类型有更多的内置操作，通常只需要序列类型。<br>MyList是一个类定义;基类放在括号内。在类内部，def语句生成方法，该方法的第一个参数在Java中自动与之等价，除了在Python中它是显式的，而且标识符self是按约定使用的(它不是关键字)。注意构造函数是如何自动继承的。</p>
<p>虽然一切在Python中真的是一个对象(包括整数和浮点类型),你仍然有一个安全门,因为你可以优化性能关键型的部分代码编写扩展的C, c++或使用特殊的工具设计容易加速您的Python代码(有很多)。通过这种方式，可以在不影响性能改进的情况下保持对象的纯度。</p>
<p>PHP甚至更进一步，它只有一个数组类型，既充当int索引数组，又充当关联数组(Map)。</p>
<p>在经历了这么多年的Java发展之后，我们可以很有趣地推测，如果重新开始，设计人员是否会将原生类型和低级数组放在该语言中(同样在JVM上运行的Scala语言不包括这些)。如果不考虑这些，就有可能开发出一种真正纯粹的面向对象语言(尽管有这样的说法，Java并不是一种纯粹的面向对象语言，这正是因为它的底层缺陷)。关于效率的最初争论总是令人信服的，但是随着时间的推移，我们已经看到了从这个想法向更高层次的组件(如集合)的演进。此外，如果集合可以像在某些语言中一样构建到核心语言中，那么编译器就有更好的机会进行优化。</p>
<p>撇开““Green-fields”的推测不谈，我们肯定会被数组所困扰，当你阅读代码时就会看到它们。然而，集合几乎总是更好的选择。</p>
<!-- 分页 -->
<div style="page-break-after: always;"></div>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/01/3/3_book/OnJava8/22-Enumerations/" rel="next" title="第二十二章 枚举">
                <i class="fa fa-chevron-left"></i> 第二十二章 枚举
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/01/3/3_book/OnJava8/Appendix-Low-Level-Concurrency/" rel="prev" title="附录:并发底层原理">
                附录:并发底层原理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="kay wu">
          <p class="site-author-name" itemprop="name">kay wu</p>
           
              <p class="site-description motion-element" itemprop="description">给时间以生命，而不是给生命以时间</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">188</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Minato262" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      Github
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第二十一章-数组"><span class="nav-text">第二十一章 数组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数组特性"><span class="nav-text">数组特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用于显示数组的实用程序"><span class="nav-text">用于显示数组的实用程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一等对象"><span class="nav-text">一等对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#返回数组"><span class="nav-text">返回数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多维数组"><span class="nav-text">多维数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#泛型数组"><span class="nav-text">泛型数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Arrays的fill方法"><span class="nav-text">Arrays的fill方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Arrays的setAll方法"><span class="nav-text">Arrays的setAll方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增量生成"><span class="nav-text">增量生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随机生成"><span class="nav-text">随机生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#泛型和基本数组"><span class="nav-text">泛型和基本数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组元素修改"><span class="nav-text">数组元素修改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组并行"><span class="nav-text">数组并行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Arrays工具类"><span class="nav-text">Arrays工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组拷贝"><span class="nav-text">数组拷贝</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组比较"><span class="nav-text">数组比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#流和数组"><span class="nav-text">流和数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数组排序"><span class="nav-text">数组排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Arrays-sort-的使用"><span class="nav-text">Arrays.sort()的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#并行排序"><span class="nav-text">并行排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#binarySearch二分查找"><span class="nav-text">binarySearch二分查找</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parallelPrefix并行前缀"><span class="nav-text">parallelPrefix并行前缀</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本章小结"><span class="nav-text">本章小结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kay wu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
