<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="附录:集合主题 本附录是一些比第十二章 集合中介绍的更高级的内容。   示例数据这里创建一些样本数据用于集合示例。 以下数据将颜色名称与HTML颜色的RGB值相关联。请注意，每个键和值都是唯一的： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:type" content="article">
<meta property="og:title" content="附录:集合主题">
<meta property="og:url" content="http://yoursite.com/2019/07/01/3/3_book/OnJava8/Appendix-Collection-Topics/index.html">
<meta property="og:site_name" content="水门的博客">
<meta property="og:description" content="附录:集合主题 本附录是一些比第十二章 集合中介绍的更高级的内容。   示例数据这里创建一些样本数据用于集合示例。 以下数据将颜色名称与HTML颜色的RGB值相关联。请注意，每个键和值都是唯一的： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-03-21T10:11:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="附录:集合主题">
<meta name="twitter:description" content="附录:集合主题 本附录是一些比第十二章 集合中介绍的更高级的内容。   示例数据这里创建一些样本数据用于集合示例。 以下数据将颜色名称与HTML颜色的RGB值相关联。请注意，每个键和值都是唯一的： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/07/01/3/3_book/OnJava8/Appendix-Collection-Topics/">





  <title>附录:集合主题 | 水门的博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">水门的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/01/3/3_book/OnJava8/Appendix-Collection-Topics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kay wu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="水门的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">附录:集合主题</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-01T00:00:02+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  24.3k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <!-- Appendix: Collection Topics -->
<h1 id="附录-集合主题"><a href="#附录-集合主题" class="headerlink" title="附录:集合主题"></a>附录:集合主题</h1><blockquote>
<p>本附录是一些比<a href>第十二章 集合</a>中介绍的更高级的内容。</p>
</blockquote>
<!-- Sample Data -->
<h2 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h2><p>这里创建一些样本数据用于集合示例。 以下数据将颜色名称与HTML颜色的RGB值相关联。请注意，每个键和值都是唯一的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/HTMLColors.java</span></span><br><span class="line"><span class="comment">// Sample data for collection examples</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTMLColors</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[][] ARRAY = &#123;</span><br><span class="line">    &#123; <span class="number">0xF0F8FF</span>, <span class="string">"AliceBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFAEBD7</span>, <span class="string">"AntiqueWhite"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x7FFFD4</span>, <span class="string">"Aquamarine"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF0FFFF</span>, <span class="string">"Azure"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF5F5DC</span>, <span class="string">"Beige"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFE4C4</span>, <span class="string">"Bisque"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x000000</span>, <span class="string">"Black"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFEBCD</span>, <span class="string">"BlanchedAlmond"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x0000FF</span>, <span class="string">"Blue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x8A2BE2</span>, <span class="string">"BlueViolet"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xA52A2A</span>, <span class="string">"Brown"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDEB887</span>, <span class="string">"BurlyWood"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x5F9EA0</span>, <span class="string">"CadetBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x7FFF00</span>, <span class="string">"Chartreuse"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xD2691E</span>, <span class="string">"Chocolate"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF7F50</span>, <span class="string">"Coral"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x6495ED</span>, <span class="string">"CornflowerBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFF8DC</span>, <span class="string">"Cornsilk"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDC143C</span>, <span class="string">"Crimson"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00FFFF</span>, <span class="string">"Cyan"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00008B</span>, <span class="string">"DarkBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x008B8B</span>, <span class="string">"DarkCyan"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xB8860B</span>, <span class="string">"DarkGoldenRod"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xA9A9A9</span>, <span class="string">"DarkGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x006400</span>, <span class="string">"DarkGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xBDB76B</span>, <span class="string">"DarkKhaki"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x8B008B</span>, <span class="string">"DarkMagenta"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x556B2F</span>, <span class="string">"DarkOliveGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF8C00</span>, <span class="string">"DarkOrange"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x9932CC</span>, <span class="string">"DarkOrchid"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x8B0000</span>, <span class="string">"DarkRed"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xE9967A</span>, <span class="string">"DarkSalmon"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x8FBC8F</span>, <span class="string">"DarkSeaGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x483D8B</span>, <span class="string">"DarkSlateBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x2F4F4F</span>, <span class="string">"DarkSlateGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00CED1</span>, <span class="string">"DarkTurquoise"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x9400D3</span>, <span class="string">"DarkViolet"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF1493</span>, <span class="string">"DeepPink"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00BFFF</span>, <span class="string">"DeepSkyBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x696969</span>, <span class="string">"DimGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x1E90FF</span>, <span class="string">"DodgerBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xB22222</span>, <span class="string">"FireBrick"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFAF0</span>, <span class="string">"FloralWhite"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x228B22</span>, <span class="string">"ForestGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDCDCDC</span>, <span class="string">"Gainsboro"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF8F8FF</span>, <span class="string">"GhostWhite"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFD700</span>, <span class="string">"Gold"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDAA520</span>, <span class="string">"GoldenRod"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x808080</span>, <span class="string">"Gray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x008000</span>, <span class="string">"Green"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xADFF2F</span>, <span class="string">"GreenYellow"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF0FFF0</span>, <span class="string">"HoneyDew"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF69B4</span>, <span class="string">"HotPink"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xCD5C5C</span>, <span class="string">"IndianRed"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x4B0082</span>, <span class="string">"Indigo"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFFF0</span>, <span class="string">"Ivory"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF0E68C</span>, <span class="string">"Khaki"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xE6E6FA</span>, <span class="string">"Lavender"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFF0F5</span>, <span class="string">"LavenderBlush"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x7CFC00</span>, <span class="string">"LawnGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFACD</span>, <span class="string">"LemonChiffon"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xADD8E6</span>, <span class="string">"LightBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF08080</span>, <span class="string">"LightCoral"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xE0FFFF</span>, <span class="string">"LightCyan"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFAFAD2</span>, <span class="string">"LightGoldenRodYellow"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xD3D3D3</span>, <span class="string">"LightGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x90EE90</span>, <span class="string">"LightGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFB6C1</span>, <span class="string">"LightPink"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFA07A</span>, <span class="string">"LightSalmon"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x20B2AA</span>, <span class="string">"LightSeaGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x87CEFA</span>, <span class="string">"LightSkyBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x778899</span>, <span class="string">"LightSlateGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xB0C4DE</span>, <span class="string">"LightSteelBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFFE0</span>, <span class="string">"LightYellow"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00FF00</span>, <span class="string">"Lime"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x32CD32</span>, <span class="string">"LimeGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFAF0E6</span>, <span class="string">"Linen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF00FF</span>, <span class="string">"Magenta"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x800000</span>, <span class="string">"Maroon"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x66CDAA</span>, <span class="string">"MediumAquaMarine"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x0000CD</span>, <span class="string">"MediumBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xBA55D3</span>, <span class="string">"MediumOrchid"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x9370DB</span>, <span class="string">"MediumPurple"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x3CB371</span>, <span class="string">"MediumSeaGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x7B68EE</span>, <span class="string">"MediumSlateBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00FA9A</span>, <span class="string">"MediumSpringGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x48D1CC</span>, <span class="string">"MediumTurquoise"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xC71585</span>, <span class="string">"MediumVioletRed"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x191970</span>, <span class="string">"MidnightBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF5FFFA</span>, <span class="string">"MintCream"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFE4E1</span>, <span class="string">"MistyRose"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFE4B5</span>, <span class="string">"Moccasin"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFDEAD</span>, <span class="string">"NavajoWhite"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x000080</span>, <span class="string">"Navy"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFDF5E6</span>, <span class="string">"OldLace"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x808000</span>, <span class="string">"Olive"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x6B8E23</span>, <span class="string">"OliveDrab"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFA500</span>, <span class="string">"Orange"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF4500</span>, <span class="string">"OrangeRed"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDA70D6</span>, <span class="string">"Orchid"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xEEE8AA</span>, <span class="string">"PaleGoldenRod"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x98FB98</span>, <span class="string">"PaleGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xAFEEEE</span>, <span class="string">"PaleTurquoise"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDB7093</span>, <span class="string">"PaleVioletRed"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFEFD5</span>, <span class="string">"PapayaWhip"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFDAB9</span>, <span class="string">"PeachPuff"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xCD853F</span>, <span class="string">"Peru"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFC0CB</span>, <span class="string">"Pink"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xDDA0DD</span>, <span class="string">"Plum"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xB0E0E6</span>, <span class="string">"PowderBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x800080</span>, <span class="string">"Purple"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF0000</span>, <span class="string">"Red"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xBC8F8F</span>, <span class="string">"RosyBrown"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x4169E1</span>, <span class="string">"RoyalBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x8B4513</span>, <span class="string">"SaddleBrown"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFA8072</span>, <span class="string">"Salmon"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF4A460</span>, <span class="string">"SandyBrown"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x2E8B57</span>, <span class="string">"SeaGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFF5EE</span>, <span class="string">"SeaShell"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xA0522D</span>, <span class="string">"Sienna"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xC0C0C0</span>, <span class="string">"Silver"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x87CEEB</span>, <span class="string">"SkyBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x6A5ACD</span>, <span class="string">"SlateBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x708090</span>, <span class="string">"SlateGray"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFAFA</span>, <span class="string">"Snow"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x00FF7F</span>, <span class="string">"SpringGreen"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x4682B4</span>, <span class="string">"SteelBlue"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xD2B48C</span>, <span class="string">"Tan"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x008080</span>, <span class="string">"Teal"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xD8BFD8</span>, <span class="string">"Thistle"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFF6347</span>, <span class="string">"Tomato"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x40E0D0</span>, <span class="string">"Turquoise"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xEE82EE</span>, <span class="string">"Violet"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF5DEB3</span>, <span class="string">"Wheat"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFFFF</span>, <span class="string">"White"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xF5F5F5</span>, <span class="string">"WhiteSmoke"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0xFFFF00</span>, <span class="string">"Yellow"</span> &#125;,</span><br><span class="line">    &#123; <span class="number">0x9ACD32</span>, <span class="string">"YellowGreen"</span> &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer,String&gt; MAP =</span><br><span class="line">    Arrays.stream(ARRAY)</span><br><span class="line">      .collect(Collectors.toMap(</span><br><span class="line">        element -&gt; (Integer)element[<span class="number">0</span>],</span><br><span class="line">        element -&gt; (String)element[<span class="number">1</span>],</span><br><span class="line">        (v1, v2) -&gt; &#123; <span class="comment">// Merge function</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">        &#125;,</span><br><span class="line">        LinkedHashMap::<span class="keyword">new</span></span><br><span class="line">      ));</span><br><span class="line">  <span class="comment">// Inversion only works if values are unique:</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;V, K&gt; Map&lt;V, K&gt;</span><br><span class="line">  invert(Map&lt;K, V&gt; map) &#123;</span><br><span class="line">    <span class="keyword">return</span> map.entrySet().stream()</span><br><span class="line">      .collect(Collectors.toMap(</span><br><span class="line">        Map.Entry::getValue,</span><br><span class="line">        Map.Entry::getKey,</span><br><span class="line">        (v1, v2) -&gt; &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">        &#125;,</span><br><span class="line">        LinkedHashMap::<span class="keyword">new</span></span><br><span class="line">      ));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String,Integer&gt;</span><br><span class="line">    INVMAP = invert(MAP);</span><br><span class="line">  <span class="comment">// Look up RGB value given a name:</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">rgb</span><span class="params">(String colorName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> INVMAP.get(colorName);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; LIST =</span><br><span class="line">    Arrays.stream(ARRAY)</span><br><span class="line">      .map(item -&gt; (String)item[<span class="number">1</span>])</span><br><span class="line">      .collect(Collectors.toList());</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;Integer&gt; RGBLIST =</span><br><span class="line">    Arrays.stream(ARRAY)</span><br><span class="line">      .map(item -&gt; (Integer)item[<span class="number">0</span>])</span><br><span class="line">      .collect(Collectors.toList());</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(Map.Entry&lt;Integer,String&gt; e)</span> </span>&#123;</span><br><span class="line">    System.out.format(</span><br><span class="line">      <span class="string">"0x%06X: %s%n"</span>, e.getKey(), e.getValue());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">  show(Map&lt;Integer,String&gt; m, <span class="keyword">int</span> count) &#123;</span><br><span class="line">    m.entrySet().stream()</span><br><span class="line">      .limit(count)</span><br><span class="line">      .forEach(e -&gt; show(e));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(Map&lt;Integer,String&gt; m)</span> </span>&#123;</span><br><span class="line">    show(m, m.size());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(Collection&lt;String&gt; lst, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    lst.stream()</span><br><span class="line">      .limit(count)</span><br><span class="line">      .forEach(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(Collection&lt;String&gt; lst)</span> </span>&#123;</span><br><span class="line">    show(lst, lst.size());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">showrgb</span><span class="params">(Collection&lt;Integer&gt; lst, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    lst.stream()</span><br><span class="line">      .limit(count)</span><br><span class="line">      .forEach(n -&gt; System.out.format(<span class="string">"0x%06X%n"</span>, n));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showrgb</span><span class="params">(Collection&lt;Integer&gt; lst)</span> </span>&#123;</span><br><span class="line">    showrgb(lst, lst.size());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">showInv</span><span class="params">(Map&lt;String,Integer&gt; m, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    m.entrySet().stream()</span><br><span class="line">      .limit(count)</span><br><span class="line">      .forEach(e -&gt;</span><br><span class="line">        System.out.format(</span><br><span class="line">          <span class="string">"%-20s  0x%06X%n"</span>, e.getKey(), e.getValue()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showInv</span><span class="params">(Map&lt;String,Integer&gt; m)</span> </span>&#123;</span><br><span class="line">    showInv(m, m.size());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">border</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"******************************"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>MAP</strong> 是使用Streams（<a href>第十四章 流式编程</a>）创建的。 二维数组 <strong>ARRAY</strong> 作为流传输到 <strong>Map</strong> 中，但请注意我们不仅仅是使用简单版本的 <code>Collectors.toMap()</code> 。 那个版本生成一个 <strong>HashMap</strong> ，它使用散列函数来控制对键的排序。 为了保留原来的顺序，我们必须将键值对直接放入 <strong>TreeMap</strong> 中，这意味着我们需要使用更复杂的 <code>Collectors.toMap()</code> 版本。这需要两个函数从每个流元素中提取键和值，就像简单版本的<code>Collectors.toMap()</code> 一样。 然后它需要一个<em>合并函数</em>（merge function），它解决了与同一个键相关的两个值之间的冲突。这里的数据已经预先审查过，因此绝不会发生这种情况，如果有的话，这里会抛出异常。最后，传递生成所需类型的空map的函数，然后用流来填充它。</p>
<p><code>rgb()</code> 方法是一个便捷函数（convenience function），它接受颜色名称 <strong>String</strong> 参数并生成其数字RGB值。为此，我们需要一个反转版本的 <strong>COLORS</strong> ，它接受一个 <strong>String</strong>键并查找RGB的 <strong>Integer</strong> 值。 这是通过 <code>invert()</code> 方法实现的，如果任何 <strong>COLORS</strong> 值不唯一，则抛出异常。</p>
<p>我们还创建包含所有名称的 <strong>LIST</strong> ，以及包含十六进制表示法的RGB值的 <strong>RGBLIST</strong> 。</p>
<p>第一个 <code>show()</code> 方法接受一个 <strong>Map.Entry</strong> 并显示以十六进制表示的键，以便轻松地对原始 <strong>ARRAY</strong> 进行双重检查。 名称以 <strong>show</strong> 开头的每个方法都会重载两个版本，其中一个版本采用 <strong>count</strong> 参数来指示要显示的元素数量，第二个版本显示序列中的所有元素。</p>
<p>这里是一个基本的测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/HTMLColorTest.java</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.HTMLColors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTMLColorTest</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DISPLAY_SIZE = <span class="number">20</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    show(MAP, DISPLAY_SIZE);</span><br><span class="line">    border();</span><br><span class="line">    showInv(INVMAP, DISPLAY_SIZE);</span><br><span class="line">    border();</span><br><span class="line">    show(LIST, DISPLAY_SIZE);</span><br><span class="line">    border();</span><br><span class="line">    showrgb(RGBLIST, DISPLAY_SIZE);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">0xF0F8FF: AliceBlue</span></span><br><span class="line"><span class="comment">0xFAEBD7: AntiqueWhite</span></span><br><span class="line"><span class="comment">0x7FFFD4: Aquamarine</span></span><br><span class="line"><span class="comment">0xF0FFFF: Azure</span></span><br><span class="line"><span class="comment">0xF5F5DC: Beige</span></span><br><span class="line"><span class="comment">0xFFE4C4: Bisque</span></span><br><span class="line"><span class="comment">0x000000: Black</span></span><br><span class="line"><span class="comment">0xFFEBCD: BlanchedAlmond</span></span><br><span class="line"><span class="comment">0x0000FF: Blue</span></span><br><span class="line"><span class="comment">0x8A2BE2: BlueViolet</span></span><br><span class="line"><span class="comment">0xA52A2A: Brown</span></span><br><span class="line"><span class="comment">0xDEB887: BurlyWood</span></span><br><span class="line"><span class="comment">0x5F9EA0: CadetBlue</span></span><br><span class="line"><span class="comment">0x7FFF00: Chartreuse</span></span><br><span class="line"><span class="comment">0xD2691E: Chocolate</span></span><br><span class="line"><span class="comment">0xFF7F50: Coral</span></span><br><span class="line"><span class="comment">0x6495ED: CornflowerBlue</span></span><br><span class="line"><span class="comment">0xFFF8DC: Cornsilk</span></span><br><span class="line"><span class="comment">0xDC143C: Crimson</span></span><br><span class="line"><span class="comment">0x00FFFF: Cyan</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AliceBlue             0xF0F8FF</span></span><br><span class="line"><span class="comment">AntiqueWhite          0xFAEBD7</span></span><br><span class="line"><span class="comment">Aquamarine            0x7FFFD4</span></span><br><span class="line"><span class="comment">Azure                 0xF0FFFF</span></span><br><span class="line"><span class="comment">Beige                 0xF5F5DC</span></span><br><span class="line"><span class="comment">Bisque                0xFFE4C4</span></span><br><span class="line"><span class="comment">Black                 0x000000</span></span><br><span class="line"><span class="comment">BlanchedAlmond        0xFFEBCD</span></span><br><span class="line"><span class="comment">Blue                  0x0000FF</span></span><br><span class="line"><span class="comment">BlueViolet            0x8A2BE2</span></span><br><span class="line"><span class="comment">Brown                 0xA52A2A</span></span><br><span class="line"><span class="comment">BurlyWood             0xDEB887</span></span><br><span class="line"><span class="comment">CadetBlue             0x5F9EA0</span></span><br><span class="line"><span class="comment">Chartreuse            0x7FFF00</span></span><br><span class="line"><span class="comment">Chocolate             0xD2691E</span></span><br><span class="line"><span class="comment">Coral                 0xFF7F50</span></span><br><span class="line"><span class="comment">CornflowerBlue        0x6495ED</span></span><br><span class="line"><span class="comment">Cornsilk              0xFFF8DC</span></span><br><span class="line"><span class="comment">Crimson               0xDC143C</span></span><br><span class="line"><span class="comment">Cyan                  0x00FFFF</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">Beige</span></span><br><span class="line"><span class="comment">Bisque</span></span><br><span class="line"><span class="comment">Black</span></span><br><span class="line"><span class="comment">BlanchedAlmond</span></span><br><span class="line"><span class="comment">Blue</span></span><br><span class="line"><span class="comment">BlueViolet</span></span><br><span class="line"><span class="comment">Brown</span></span><br><span class="line"><span class="comment">BurlyWood</span></span><br><span class="line"><span class="comment">CadetBlue</span></span><br><span class="line"><span class="comment">Chartreuse</span></span><br><span class="line"><span class="comment">Chocolate</span></span><br><span class="line"><span class="comment">Coral</span></span><br><span class="line"><span class="comment">CornflowerBlue</span></span><br><span class="line"><span class="comment">Cornsilk</span></span><br><span class="line"><span class="comment">Crimson</span></span><br><span class="line"><span class="comment">Cyan</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0xF0F8FF</span></span><br><span class="line"><span class="comment">0xFAEBD7</span></span><br><span class="line"><span class="comment">0x7FFFD4</span></span><br><span class="line"><span class="comment">0xF0FFFF</span></span><br><span class="line"><span class="comment">0xF5F5DC</span></span><br><span class="line"><span class="comment">0xFFE4C4</span></span><br><span class="line"><span class="comment">0x000000</span></span><br><span class="line"><span class="comment">0xFFEBCD</span></span><br><span class="line"><span class="comment">0x0000FF</span></span><br><span class="line"><span class="comment">0x8A2BE2</span></span><br><span class="line"><span class="comment">0xA52A2A</span></span><br><span class="line"><span class="comment">0xDEB887</span></span><br><span class="line"><span class="comment">0x5F9EA0</span></span><br><span class="line"><span class="comment">0x7FFF00</span></span><br><span class="line"><span class="comment">0xD2691E</span></span><br><span class="line"><span class="comment">0xFF7F50</span></span><br><span class="line"><span class="comment">0x6495ED</span></span><br><span class="line"><span class="comment">0xFFF8DC</span></span><br><span class="line"><span class="comment">0xDC143C</span></span><br><span class="line"><span class="comment">0x00FFFF</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>可以看到，使用 <strong>LinkedHashMap</strong> 确实能够保留 <strong>HTMLColors.ARRAY</strong> 的顺序。</p>
<!-- List Behavior -->
<h2 id="List行为"><a href="#List行为" class="headerlink" title="List行为"></a>List行为</h2><p><strong>Lists</strong> 是存储和检索对象（次于数组）的最基本方法。基本列表操作包括：</p>
<ul>
<li><code>add()</code> 用于插入元素</li>
<li><code>get()</code> 用于随机访问元素</li>
<li><code>iterator()</code> 获取序列上的一个 <strong>Iterator</strong></li>
<li><code>stream()</code> 生成元素的一个 <strong>Stream</strong></li>
</ul>
<p>列表构造方法始终保留元素的添加顺序。</p>
<p>以下示例中的方法各自涵盖了一组不同的行为：每个 <strong>List</strong> 可以执行的操作（ <code>basicTest()</code> ），使用 <strong>Iterator</strong> （ <code>iterMotion()</code> ）遍历序列，使用 <strong>Iterator</strong> （ <code>iterManipulation()</code> ）更改内容，查看 <strong>List</strong> 操作（ <code>testVisual()</code> ）的效果，以及仅可用于 <strong>LinkedLists</strong> 的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/ListOps.java</span></span><br><span class="line"><span class="comment">// Things you can do with Lists</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.HTMLColors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListOps</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Create a short list for testing:</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; LIST =</span><br><span class="line">    HTMLColors.LIST.subList(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> b;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String s;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Iterator&lt;String&gt; it;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ListIterator&lt;String&gt; lit;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">basicTest</span><span class="params">(List&lt;String&gt; a)</span> </span>&#123;</span><br><span class="line">    a.add(<span class="number">1</span>, <span class="string">"x"</span>); <span class="comment">// Add at location 1</span></span><br><span class="line">    a.add(<span class="string">"x"</span>); <span class="comment">// Add at end</span></span><br><span class="line">    <span class="comment">// Add a collection:</span></span><br><span class="line">    a.addAll(LIST);</span><br><span class="line">    <span class="comment">// Add a collection starting at location 3:</span></span><br><span class="line">    a.addAll(<span class="number">3</span>, LIST);</span><br><span class="line">    b = a.contains(<span class="string">"1"</span>); <span class="comment">// Is it in there?</span></span><br><span class="line">    <span class="comment">// Is the entire collection in there?</span></span><br><span class="line">    b = a.containsAll(LIST);</span><br><span class="line">    <span class="comment">// Lists allow random access, which is cheap</span></span><br><span class="line">    <span class="comment">// for ArrayList, expensive for LinkedList:</span></span><br><span class="line">    s = a.get(<span class="number">1</span>); <span class="comment">// Get (typed) object at location 1</span></span><br><span class="line">    i = a.indexOf(<span class="string">"1"</span>); <span class="comment">// Tell index of object</span></span><br><span class="line">    b = a.isEmpty(); <span class="comment">// Any elements inside?</span></span><br><span class="line">    it = a.iterator(); <span class="comment">// Ordinary Iterator</span></span><br><span class="line">    lit = a.listIterator(); <span class="comment">// ListIterator</span></span><br><span class="line">    lit = a.listIterator(<span class="number">3</span>); <span class="comment">// Start at location 3</span></span><br><span class="line">    i = a.lastIndexOf(<span class="string">"1"</span>); <span class="comment">// Last match</span></span><br><span class="line">    a.remove(<span class="number">1</span>); <span class="comment">// Remove location 1</span></span><br><span class="line">    a.remove(<span class="string">"3"</span>); <span class="comment">// Remove this object</span></span><br><span class="line">    a.set(<span class="number">1</span>, <span class="string">"y"</span>); <span class="comment">// Set location 1 to "y"</span></span><br><span class="line">    <span class="comment">// Keep everything that's in the argument</span></span><br><span class="line">    <span class="comment">// (the intersection of the two sets):</span></span><br><span class="line">    a.retainAll(LIST);</span><br><span class="line">    <span class="comment">// Remove everything that's in the argument:</span></span><br><span class="line">    a.removeAll(LIST);</span><br><span class="line">    i = a.size(); <span class="comment">// How big is it?</span></span><br><span class="line">    a.clear(); <span class="comment">// Remove all elements</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">iterMotion</span><span class="params">(List&lt;String&gt; a)</span> </span>&#123;</span><br><span class="line">    ListIterator&lt;String&gt; it = a.listIterator();</span><br><span class="line">    b = it.hasNext();</span><br><span class="line">    b = it.hasPrevious();</span><br><span class="line">    s = it.next();</span><br><span class="line">    i = it.nextIndex();</span><br><span class="line">    s = it.previous();</span><br><span class="line">    i = it.previousIndex();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">iterManipulation</span><span class="params">(List&lt;String&gt; a)</span> </span>&#123;</span><br><span class="line">    ListIterator&lt;String&gt; it = a.listIterator();</span><br><span class="line">    it.add(<span class="string">"47"</span>);</span><br><span class="line">    <span class="comment">// Must move to an element after add():</span></span><br><span class="line">    it.next();</span><br><span class="line">    <span class="comment">// Remove the element after the new one:</span></span><br><span class="line">    it.remove();</span><br><span class="line">    <span class="comment">// Must move to an element after remove():</span></span><br><span class="line">    it.next();</span><br><span class="line">    <span class="comment">// Change the element after the deleted one:</span></span><br><span class="line">    it.set(<span class="string">"47"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testVisual</span><span class="params">(List&lt;String&gt; a)</span> </span>&#123;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">    List&lt;String&gt; b = LIST;</span><br><span class="line">    System.out.println(<span class="string">"b = "</span> + b);</span><br><span class="line">    a.addAll(b);</span><br><span class="line">    a.addAll(b);</span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="comment">// Insert, remove, and replace elements</span></span><br><span class="line">    <span class="comment">// using a ListIterator:</span></span><br><span class="line">    ListIterator&lt;String&gt; x =</span><br><span class="line">      a.listIterator(a.size()/<span class="number">2</span>);</span><br><span class="line">    x.add(<span class="string">"one"</span>);</span><br><span class="line">    System.out.println(a);</span><br><span class="line">    System.out.println(x.next());</span><br><span class="line">    x.remove();</span><br><span class="line">    System.out.println(x.next());</span><br><span class="line">    x.set(<span class="string">"47"</span>);</span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="comment">// Traverse the list backwards:</span></span><br><span class="line">    x = a.listIterator(a.size());</span><br><span class="line">    <span class="keyword">while</span>(x.hasPrevious())</span><br><span class="line">      System.out.print(x.previous() + <span class="string">" "</span>);</span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println(<span class="string">"testVisual finished"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// There are some things that only LinkedLists can do:</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testLinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinkedList&lt;String&gt; ll = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    ll.addAll(LIST);</span><br><span class="line">    System.out.println(ll);</span><br><span class="line">    <span class="comment">// Treat it like a stack, pushing:</span></span><br><span class="line">    ll.addFirst(<span class="string">"one"</span>);</span><br><span class="line">    ll.addFirst(<span class="string">"two"</span>);</span><br><span class="line">    System.out.println(ll);</span><br><span class="line">    <span class="comment">// Like "peeking" at the top of a stack:</span></span><br><span class="line">    System.out.println(ll.getFirst());</span><br><span class="line">    <span class="comment">// Like popping a stack:</span></span><br><span class="line">    System.out.println(ll.removeFirst());</span><br><span class="line">    System.out.println(ll.removeFirst());</span><br><span class="line">    <span class="comment">// Treat it like a queue, pulling elements</span></span><br><span class="line">    <span class="comment">// off the tail end:</span></span><br><span class="line">    System.out.println(ll.removeLast());</span><br><span class="line">    System.out.println(ll);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Make and fill a new list each time:</span></span><br><span class="line">    basicTest(<span class="keyword">new</span> LinkedList&lt;&gt;(LIST));</span><br><span class="line">    basicTest(<span class="keyword">new</span> ArrayList&lt;&gt;(LIST));</span><br><span class="line">    iterMotion(<span class="keyword">new</span> LinkedList&lt;&gt;(LIST));</span><br><span class="line">    iterMotion(<span class="keyword">new</span> ArrayList&lt;&gt;(LIST));</span><br><span class="line">    iterManipulation(<span class="keyword">new</span> LinkedList&lt;&gt;(LIST));</span><br><span class="line">    iterManipulation(<span class="keyword">new</span> ArrayList&lt;&gt;(LIST));</span><br><span class="line">    testVisual(<span class="keyword">new</span> LinkedList&lt;&gt;(LIST));</span><br><span class="line">    testLinkedList();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">b = [AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet,</span></span><br><span class="line"><span class="comment">AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet,</span></span><br><span class="line"><span class="comment">AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet,</span></span><br><span class="line"><span class="comment">AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige, one,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet,</span></span><br><span class="line"><span class="comment">AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">Bisque</span></span><br><span class="line"><span class="comment">Black</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet,</span></span><br><span class="line"><span class="comment">AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige, one,</span></span><br><span class="line"><span class="comment">47, BlanchedAlmond, Blue, BlueViolet, AliceBlue,</span></span><br><span class="line"><span class="comment">AntiqueWhite, Aquamarine, Azure, Beige, Bisque, Black,</span></span><br><span class="line"><span class="comment">BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">BlueViolet Blue BlanchedAlmond Black Bisque Beige Azure</span></span><br><span class="line"><span class="comment">Aquamarine AntiqueWhite AliceBlue BlueViolet Blue</span></span><br><span class="line"><span class="comment">BlanchedAlmond 47 one Beige Azure Aquamarine</span></span><br><span class="line"><span class="comment">AntiqueWhite AliceBlue BlueViolet Blue BlanchedAlmond</span></span><br><span class="line"><span class="comment">Black Bisque Beige Azure Aquamarine AntiqueWhite</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">testVisual finished</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">[two, one, AliceBlue, AntiqueWhite, Aquamarine, Azure,</span></span><br><span class="line"><span class="comment">Beige, Bisque, Black, BlanchedAlmond, Blue, BlueViolet]</span></span><br><span class="line"><span class="comment">two</span></span><br><span class="line"><span class="comment">two</span></span><br><span class="line"><span class="comment">one</span></span><br><span class="line"><span class="comment">BlueViolet</span></span><br><span class="line"><span class="comment">[AliceBlue, AntiqueWhite, Aquamarine, Azure, Beige,</span></span><br><span class="line"><span class="comment">Bisque, Black, BlanchedAlmond, Blue]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>在 <code>basicTest()</code> 和 <code>iterMotion()</code> 中，方法调用是为了展示正确的语法，尽管获取了返回值，但不会使用它。在某些情况下，根本不会去获取返回值。在使用这些方法之前，请查看JDK文档中这些方法的完整用法。</p>
<!-- Set Behavior -->
<h2 id="Set行为"><a href="#Set行为" class="headerlink" title="Set行为"></a>Set行为</h2><p><strong>Set</strong> 的主要用处是测试成员身份，不过也可以将其用作删除重复元素的工具。如果不关心元素顺序或并发性， <strong>HashSet</strong> 总是最好的选择，因为它是专门为了快速查找而设计的（这里使用了在<a href>附录：理解equals和hashCode方法</a>章节中探讨的散列函数）。</p>
<p>其它的 <strong>Set</strong> 实现产生不同的排序行为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/SetOrder.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.HTMLColors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetOrder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> String[] sets = &#123;</span><br><span class="line">    <span class="string">"java.util.HashSet"</span>,</span><br><span class="line">    <span class="string">"java.util.TreeSet"</span>,</span><br><span class="line">    <span class="string">"java.util.concurrent.ConcurrentSkipListSet"</span>,</span><br><span class="line">    <span class="string">"java.util.LinkedHashSet"</span>,</span><br><span class="line">    <span class="string">"java.util.concurrent.CopyOnWriteArraySet"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; RLIST =</span><br><span class="line">    <span class="keyword">new</span> ArrayList&lt;&gt;(HTMLColors.LIST);</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    Collections.reverse(RLIST);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">  main(String[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">for</span>(String type: sets) &#123;</span><br><span class="line">      System.out.format(<span class="string">"[-&gt; %s &lt;-]%n"</span>,</span><br><span class="line">        type.substring(type.lastIndexOf(<span class="string">'.'</span>) + <span class="number">1</span>));</span><br><span class="line">      <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">      Set&lt;String&gt; set = (Set&lt;String&gt;)</span><br><span class="line">        Class.forName(type).newInstance();</span><br><span class="line">      set.addAll(RLIST);</span><br><span class="line">      set.stream()</span><br><span class="line">        .limit(<span class="number">10</span>)</span><br><span class="line">        .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[-&gt; HashSet &lt;-]</span></span><br><span class="line"><span class="comment">MediumOrchid</span></span><br><span class="line"><span class="comment">PaleGoldenRod</span></span><br><span class="line"><span class="comment">Sienna</span></span><br><span class="line"><span class="comment">LightSlateGray</span></span><br><span class="line"><span class="comment">DarkSeaGreen</span></span><br><span class="line"><span class="comment">Black</span></span><br><span class="line"><span class="comment">Gainsboro</span></span><br><span class="line"><span class="comment">Orange</span></span><br><span class="line"><span class="comment">LightCoral</span></span><br><span class="line"><span class="comment">DodgerBlue</span></span><br><span class="line"><span class="comment">[-&gt; TreeSet &lt;-]</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">Beige</span></span><br><span class="line"><span class="comment">Bisque</span></span><br><span class="line"><span class="comment">Black</span></span><br><span class="line"><span class="comment">BlanchedAlmond</span></span><br><span class="line"><span class="comment">Blue</span></span><br><span class="line"><span class="comment">BlueViolet</span></span><br><span class="line"><span class="comment">[-&gt; ConcurrentSkipListSet &lt;-]</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">Beige</span></span><br><span class="line"><span class="comment">Bisque</span></span><br><span class="line"><span class="comment">Black</span></span><br><span class="line"><span class="comment">BlanchedAlmond</span></span><br><span class="line"><span class="comment">Blue</span></span><br><span class="line"><span class="comment">BlueViolet</span></span><br><span class="line"><span class="comment">[-&gt; LinkedHashSet &lt;-]</span></span><br><span class="line"><span class="comment">YellowGreen</span></span><br><span class="line"><span class="comment">Yellow</span></span><br><span class="line"><span class="comment">WhiteSmoke</span></span><br><span class="line"><span class="comment">White</span></span><br><span class="line"><span class="comment">Wheat</span></span><br><span class="line"><span class="comment">Violet</span></span><br><span class="line"><span class="comment">Turquoise</span></span><br><span class="line"><span class="comment">Tomato</span></span><br><span class="line"><span class="comment">Thistle</span></span><br><span class="line"><span class="comment">Teal</span></span><br><span class="line"><span class="comment">[-&gt; CopyOnWriteArraySet &lt;-]</span></span><br><span class="line"><span class="comment">YellowGreen</span></span><br><span class="line"><span class="comment">Yellow</span></span><br><span class="line"><span class="comment">WhiteSmoke</span></span><br><span class="line"><span class="comment">White</span></span><br><span class="line"><span class="comment">Wheat</span></span><br><span class="line"><span class="comment">Violet</span></span><br><span class="line"><span class="comment">Turquoise</span></span><br><span class="line"><span class="comment">Tomato</span></span><br><span class="line"><span class="comment">Thistle</span></span><br><span class="line"><span class="comment">Teal</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这里需要使用 <strong>@SuppressWarnings(“unchecked”)</strong> ，因为这里将一个 <strong>String</strong> （可能是任何东西）传递给了 <code>Class.forName(type).newInstance()</code> 。编译器并不能保证这是一次成功的操作。</p>
<p><strong>RLIST</strong> 是 <strong>HTMLColors.LIST</strong> 的反转版本。因为 <code>Collections.reverse()</code> 是通过修改参数来执行反向操作，而不是返回包含反向元素的新 <strong>List</strong> ，所以该调用在 <strong>static</strong> 块内执行。  <strong>RLIST</strong> 可以防止我们意外地认为 <strong>Set</strong> 对其结果进行了排序。</p>
<p><strong>HashSet</strong> 的输出结果似乎没有可辨别的顺序，因为它是基于散列函数的。 <strong>TreeSet</strong> 和 <strong>ConcurrentSkipListSet</strong> 都对它们的元素进行了排序，它们都实现了 <strong>SortedSet</strong> 接口来标识这个特点。因为实现该接口的 <strong>Set</strong> 按顺序排列，所以该接口还有一些其他的可用操作。 <strong>LinkedHashSet</strong> 和 <strong>CopyOnWriteArraySet</strong> 尽管没有用于标识的接口，但它们还是保留了元素的插入顺序。</p>
<p><strong>ConcurrentSkipListSet</strong> 和 <strong>CopyOnWriteArraySet</strong> 是线程安全的。</p>
<p>在附录的最后，我们将了解在非 <strong>HashSet</strong> 实现的 <strong>Set</strong> 上添加额外排序的性能成本，以及不同实现中的任何其他功能的成本。</p>
<!-- Using Functional Operations with any Map -->
<h2 id="在Map中使用函数式操作"><a href="#在Map中使用函数式操作" class="headerlink" title="在Map中使用函数式操作"></a>在Map中使用函数式操作</h2><p>与 <strong>Collection</strong> 接口一样，<code>forEach()</code> 也内置在 <strong>Map</strong> 接口中。但是如果想要执行任何其他的基本功能操作，比如 <code>map()</code> ，<code>flatMap()</code> ，<code>reduce()</code> 或 <code>filter()</code> 时，该怎么办？ 查看 <strong>Map</strong> 接口发现并没有这些。</p>
<p>可以通过 <code>entrySet()</code> 连接到这些方法，该方法会生成一个由 <strong>Map.Entry</strong> 对象组成的 <strong>Set</strong> 。这个 <strong>Set</strong> 包含 <code>stream()</code> 和 <code>parallelStream()</code> 方法。只需要记住一件事，这里正在使用的是 <strong>Map.Entry</strong> 对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/FunctionalMap.java</span></span><br><span class="line"><span class="comment">// Functional operations on a Map</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.HTMLColors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FunctionalMap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    MAP.entrySet().stream()</span><br><span class="line">      .map(Map.Entry::getValue)</span><br><span class="line">      .filter(v -&gt; v.startsWith(<span class="string">"Dark"</span>))</span><br><span class="line">      .map(v -&gt; v.replaceFirst(<span class="string">"Dark"</span>, <span class="string">"Hot"</span>))</span><br><span class="line">      .forEach(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">HotBlue</span></span><br><span class="line"><span class="comment">HotCyan</span></span><br><span class="line"><span class="comment">HotGoldenRod</span></span><br><span class="line"><span class="comment">HotGray</span></span><br><span class="line"><span class="comment">HotGreen</span></span><br><span class="line"><span class="comment">HotKhaki</span></span><br><span class="line"><span class="comment">HotMagenta</span></span><br><span class="line"><span class="comment">HotOliveGreen</span></span><br><span class="line"><span class="comment">HotOrange</span></span><br><span class="line"><span class="comment">HotOrchid</span></span><br><span class="line"><span class="comment">HotRed</span></span><br><span class="line"><span class="comment">HotSalmon</span></span><br><span class="line"><span class="comment">HotSeaGreen</span></span><br><span class="line"><span class="comment">HotSlateBlue</span></span><br><span class="line"><span class="comment">HotSlateGray</span></span><br><span class="line"><span class="comment">HotTurquoise</span></span><br><span class="line"><span class="comment">HotViolet</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>生成 <strong>Stream</strong> 后，所有的基本功能方法，甚至更多就都可以使用了。</p>
<!-- Selecting Parts of a Map -->
<h2 id="选择Map片段"><a href="#选择Map片段" class="headerlink" title="选择Map片段"></a>选择Map片段</h2><p>由 <strong>TreeMap</strong> 和 <strong>ConcurrentSkipListMap</strong> 实现的 <strong>NavigableMap</strong> 接口解决了需要选择Map片段的问题。下面是一个示例，使用了 <strong>HTMLColors</strong> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/NavMap.java</span></span><br><span class="line"><span class="comment">// NavigableMap produces pieces of a Map</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.HTMLColors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NavMap</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span></span><br><span class="line">  NavigableMap&lt;Integer,String&gt; COLORS =</span><br><span class="line">    <span class="keyword">new</span> ConcurrentSkipListMap&lt;&gt;(MAP);</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    show(COLORS.firstEntry());</span><br><span class="line">    border();</span><br><span class="line">    show(COLORS.lastEntry());</span><br><span class="line">    border();</span><br><span class="line">    NavigableMap&lt;Integer, String&gt; toLime =</span><br><span class="line">      COLORS.headMap(rgb(<span class="string">"Lime"</span>), <span class="keyword">true</span>);</span><br><span class="line">    show(toLime);</span><br><span class="line">    border();</span><br><span class="line">    show(COLORS.ceilingEntry(rgb(<span class="string">"DeepSkyBlue"</span>) - <span class="number">1</span>));</span><br><span class="line">    border();</span><br><span class="line">    show(COLORS.floorEntry(rgb(<span class="string">"DeepSkyBlue"</span>) - <span class="number">1</span>));</span><br><span class="line">    border();</span><br><span class="line">    show(toLime.descendingMap());</span><br><span class="line">    border();</span><br><span class="line">    show(COLORS.tailMap(rgb(<span class="string">"MistyRose"</span>), <span class="keyword">true</span>));</span><br><span class="line">    border();</span><br><span class="line">    show(COLORS.subMap(</span><br><span class="line">      rgb(<span class="string">"Orchid"</span>), <span class="keyword">true</span>,</span><br><span class="line">      rgb(<span class="string">"DarkSalmon"</span>), <span class="keyword">false</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">0x000000: Black</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0xFFFFFF: White</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0x000000: Black</span></span><br><span class="line"><span class="comment">0x000080: Navy</span></span><br><span class="line"><span class="comment">0x00008B: DarkBlue</span></span><br><span class="line"><span class="comment">0x0000CD: MediumBlue</span></span><br><span class="line"><span class="comment">0x0000FF: Blue</span></span><br><span class="line"><span class="comment">0x006400: DarkGreen</span></span><br><span class="line"><span class="comment">0x008000: Green</span></span><br><span class="line"><span class="comment">0x008080: Teal</span></span><br><span class="line"><span class="comment">0x008B8B: DarkCyan</span></span><br><span class="line"><span class="comment">0x00BFFF: DeepSkyBlue</span></span><br><span class="line"><span class="comment">0x00CED1: DarkTurquoise</span></span><br><span class="line"><span class="comment">0x00FA9A: MediumSpringGreen</span></span><br><span class="line"><span class="comment">0x00FF00: Lime</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0x00BFFF: DeepSkyBlue</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0x008B8B: DarkCyan</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0x00FF00: Lime</span></span><br><span class="line"><span class="comment">0x00FA9A: MediumSpringGreen</span></span><br><span class="line"><span class="comment">0x00CED1: DarkTurquoise</span></span><br><span class="line"><span class="comment">0x00BFFF: DeepSkyBlue</span></span><br><span class="line"><span class="comment">0x008B8B: DarkCyan</span></span><br><span class="line"><span class="comment">0x008080: Teal</span></span><br><span class="line"><span class="comment">0x008000: Green</span></span><br><span class="line"><span class="comment">0x006400: DarkGreen</span></span><br><span class="line"><span class="comment">0x0000FF: Blue</span></span><br><span class="line"><span class="comment">0x0000CD: MediumBlue</span></span><br><span class="line"><span class="comment">0x00008B: DarkBlue</span></span><br><span class="line"><span class="comment">0x000080: Navy</span></span><br><span class="line"><span class="comment">0x000000: Black</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0xFFE4E1: MistyRose</span></span><br><span class="line"><span class="comment">0xFFEBCD: BlanchedAlmond</span></span><br><span class="line"><span class="comment">0xFFEFD5: PapayaWhip</span></span><br><span class="line"><span class="comment">0xFFF0F5: LavenderBlush</span></span><br><span class="line"><span class="comment">0xFFF5EE: SeaShell</span></span><br><span class="line"><span class="comment">0xFFF8DC: Cornsilk</span></span><br><span class="line"><span class="comment">0xFFFACD: LemonChiffon</span></span><br><span class="line"><span class="comment">0xFFFAF0: FloralWhite</span></span><br><span class="line"><span class="comment">0xFFFAFA: Snow</span></span><br><span class="line"><span class="comment">0xFFFF00: Yellow</span></span><br><span class="line"><span class="comment">0xFFFFE0: LightYellow</span></span><br><span class="line"><span class="comment">0xFFFFF0: Ivory</span></span><br><span class="line"><span class="comment">0xFFFFFF: White</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">0xDA70D6: Orchid</span></span><br><span class="line"><span class="comment">0xDAA520: GoldenRod</span></span><br><span class="line"><span class="comment">0xDB7093: PaleVioletRed</span></span><br><span class="line"><span class="comment">0xDC143C: Crimson</span></span><br><span class="line"><span class="comment">0xDCDCDC: Gainsboro</span></span><br><span class="line"><span class="comment">0xDDA0DD: Plum</span></span><br><span class="line"><span class="comment">0xDEB887: BurlyWood</span></span><br><span class="line"><span class="comment">0xE0FFFF: LightCyan</span></span><br><span class="line"><span class="comment">0xE6E6FA: Lavender</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>在主方法中可以看到 <strong>NavigableMap</strong> 的各种功能。 因为 <strong>NavigableMap</strong> 具有键顺序，所以它使用了 <code>firstEntry()</code> 和 <code>lastEntry()</code> 的概念。调用 <code>headMap()</code> 会生成一个 <strong>NavigableMap</strong> ，其中包含了从 <strong>Map</strong> 的开头到 <code>headMap()</code> 参数中所指向的一组元素，其中 <strong>boolean</strong> 值指示结果中是否包含该参数。调用 <code>tailMap()</code> 执行了类似的操作，只不过是从参数开始到 <strong>Map</strong> 的末尾。 <code>subMap()</code> 则允许生成 <strong>Map</strong> 中间的一部分。</p>
<p><code>ceilingEntry()</code> 从当前键值对向上搜索下一个键值对，<code>floorEntry()</code> 则是向下搜索。 <code>descendingMap()</code> 反转了 <strong>NavigableMap</strong> 的顺序。</p>
<p>如果需要通过分割 <strong>Map</strong> 来简化所正在解决的问题，则 <strong>NavigableMap</strong> 可以做到。具有类似的功能的其它集合实现也可以用来帮助解决问题。</p>
<!-- Filling Collections -->
<h2 id="填充集合"><a href="#填充集合" class="headerlink" title="填充集合"></a>填充集合</h2><p>与 <strong>Arrays</strong> 一样，这里有一个名为 <strong>Collections</strong> 的伴随类（companion class），包含了一些 <strong>static</strong> 的实用方法，其中包括一个名为 <code>fill()</code> 的方法。 <code>fill()</code> 只复制整个集合中的单个对象引用。此外，它仅适用于 <strong>List</strong> 对象，但结果列表可以传递给构造方法或 <code>addAll()</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/FillingLists.java</span></span><br><span class="line"><span class="comment">// Collections.fill() &amp; Collections.nCopies()</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringAddress</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String s;</span><br><span class="line">  StringAddress(String s) &#123; <span class="keyword">this</span>.s = s; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.toString() + <span class="string">" "</span> + s;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FillingLists</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;StringAddress&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">      Collections.nCopies(<span class="number">4</span>,</span><br><span class="line">        <span class="keyword">new</span> StringAddress(<span class="string">"Hello"</span>)));</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    Collections.fill(list,</span><br><span class="line">      <span class="keyword">new</span> StringAddress(<span class="string">"World!"</span>));</span><br><span class="line">    System.out.println(list);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[StringAddress@15db9742 Hello, StringAddress@15db9742</span></span><br><span class="line"><span class="comment">Hello, StringAddress@15db9742 Hello,</span></span><br><span class="line"><span class="comment">StringAddress@15db9742 Hello]</span></span><br><span class="line"><span class="comment">[StringAddress@6d06d69c World!, StringAddress@6d06d69c</span></span><br><span class="line"><span class="comment">World!, StringAddress@6d06d69c World!,</span></span><br><span class="line"><span class="comment">StringAddress@6d06d69c World!]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这个示例展示了两种使用对单个对象的引用来填充 <strong>Collection</strong> 的方法。 第一个： <code>Collections.nCopies()</code> ，创建一个 <strong>List</strong>，并传递给 <strong>ArrayList</strong> 的构造方法，进而填充了 <strong>ArrayList</strong> 。</p>
<p><strong>StringAddress</strong> 中的 <code>toString()</code> 方法调用了 <code>Object.toString()</code> ，它先生成类名，后跟着对象的哈希码的无符号十六进制表示（哈希吗由 <code>hashCode()</code> 方法生成）。 输出显示所有的引用都指向同一个对象。调用第二个方法 <code>Collections.fill()</code> 后也是如此。 <code>fill()</code> 方法的用处非常有限，它只能替换 <strong>List</strong> 中已有的元素,而且不会添加新元素，</p>
<h3 id="使用-Suppliers-填充集合"><a href="#使用-Suppliers-填充集合" class="headerlink" title="使用 Suppliers 填充集合"></a>使用 Suppliers 填充集合</h3><p><a href>第二十章 泛型</a>章节中介绍的 <strong>onjava.Suppliers</strong> 类为填充集合提供了通用解决方案。 这是一个使用 <strong>Suppliers</strong> 初始化几种不同类型的 <strong>Collection</strong> 的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/SuppliersCollectionTest.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Government</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> String[] foundation = (</span><br><span class="line">    <span class="string">"strange women lying in ponds "</span> +</span><br><span class="line">    <span class="string">"distributing swords is no basis "</span> +</span><br><span class="line">    <span class="string">"for a system of government"</span>).split(<span class="string">" "</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> foundation[index++];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuppliersCollectionTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Suppliers class from the Generics chapter:</span></span><br><span class="line">    Set&lt;String&gt; set = Suppliers.create(</span><br><span class="line">      LinkedHashSet::<span class="keyword">new</span>, <span class="keyword">new</span> Government(), <span class="number">15</span>);</span><br><span class="line">    System.out.println(set);</span><br><span class="line">    List&lt;String&gt; list = Suppliers.create(</span><br><span class="line">      LinkedList::<span class="keyword">new</span>, <span class="keyword">new</span> Government(), <span class="number">15</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Suppliers.fill(list, <span class="keyword">new</span> Government(), <span class="number">15</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Or we can use Streams:</span></span><br><span class="line">    set = Arrays.stream(Government.foundation)</span><br><span class="line">      .collect(Collectors.toSet());</span><br><span class="line">    System.out.println(set);</span><br><span class="line">    list = Arrays.stream(Government.foundation)</span><br><span class="line">      .collect(Collectors.toList());</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    list = Arrays.stream(Government.foundation)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toCollection(LinkedList::<span class="keyword">new</span>));</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    set = Arrays.stream(Government.foundation)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toCollection(LinkedHashSet::<span class="keyword">new</span>));</span><br><span class="line">    System.out.println(set);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">[ponds, no, a, in, swords, for, is, basis, strange,</span></span><br><span class="line"><span class="comment">system, government, distributing, of, women, lying]</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">[strange, women, lying, in, ponds, distributing,</span></span><br><span class="line"><span class="comment">swords, is, no, basis, for, a, system, of, government]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>LinkedHashSet</strong> 中的的元素按插入顺序排列，因为它维护一个链表来保存该顺序。</p>
<p>但是请注意示例的第二部分：大多数情况下都可以使用 <strong>Stream</strong> 来创建和填充 <strong>Collection</strong> 。在本例中的 <strong>Stream</strong> 版本不需要声明 <strong>Supplier</strong> 所想要创建的元素数量;，它直接吸收了 <strong>Stream</strong> 中的所有元素。</p>
<p>尽可能优先选择 <strong>Stream</strong> 来解决问题。</p>
<h3 id="Map-Suppliers"><a href="#Map-Suppliers" class="headerlink" title="Map Suppliers"></a>Map Suppliers</h3><p>使用 <strong>Supplier</strong> 来填充 <strong>Map</strong> 时需要一个 <strong>Pair</strong> 类，因为每次调用一个 <strong>Supplier</strong> 的 <code>get()</code> 方法时，都必须生成一对对象（一个键和一个值）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Pair.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> K key;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> V value;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(K k, V v)</span> </span>&#123;</span><br><span class="line">    key = k;</span><br><span class="line">    value = v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> K <span class="title">key</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> V <span class="title">value</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">Pair&lt;K, V&gt; <span class="title">make</span><span class="params">(K k, V v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;K,V&gt;(k, v);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Pair</strong> 是一个只读的 <em>数据传输对象</em> （Data Transfer Object）或 <em>信使</em> （Messenger）。 这与<a href>第二十章 泛型</a>章节中的 <strong>Tuple2</strong> 基本相同，但名字更适合 <strong>Map</strong> 初始化。我还添加了静态的 <code>make()</code> 方法，以便为创建 <strong>Pair</strong> 对象提供一个更简洁的名字。</p>
<p>Java 8 的 <strong>Stream</strong> 提供了填充 <strong>Map</strong> 的便捷方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/StreamFillMaps.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Letters</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">Pair</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">char</span> letter = <span class="string">'A'</span>;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pair&lt;Integer,String&gt; <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;&gt;(number++, <span class="string">""</span> + letter++);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamFillMaps</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;Integer,String&gt; m =</span><br><span class="line">      Stream.generate(<span class="keyword">new</span> Letters())</span><br><span class="line">      .limit(<span class="number">11</span>)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toMap(Pair::key, Pair::value));</span><br><span class="line">    System.out.println(m);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Two separate Suppliers:</span></span><br><span class="line">    Rand.String rs = <span class="keyword">new</span> Rand.String(<span class="number">3</span>);</span><br><span class="line">    Count.Character cc = <span class="keyword">new</span> Count.Character();</span><br><span class="line">    Map&lt;Character,String&gt; mcs = Stream.generate(</span><br><span class="line">      () -&gt; Pair.make(cc.get(), rs.get()))</span><br><span class="line">      .limit(<span class="number">8</span>)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toMap(Pair::key, Pair::value));</span><br><span class="line">    System.out.println(mcs);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A key Supplier and a single value:</span></span><br><span class="line">    Map&lt;Character,String&gt; mcs2 = Stream.generate(</span><br><span class="line">      () -&gt; Pair.make(cc.get(), <span class="string">"Val"</span>))</span><br><span class="line">      .limit(<span class="number">8</span>)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toMap(Pair::key, Pair::value));</span><br><span class="line">    System.out.println(mcs2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;1=A, 2=B, 3=C, 4=D, 5=E, 6=F, 7=G, 8=H, 9=I, 10=J,</span></span><br><span class="line"><span class="comment">11=K&#125;</span></span><br><span class="line"><span class="comment">&#123;b=btp, c=enp, d=ccu, e=xsz, f=gvg, g=mei, h=nne,</span></span><br><span class="line"><span class="comment">i=elo&#125;</span></span><br><span class="line"><span class="comment">&#123;p=Val, q=Val, j=Val, k=Val, l=Val, m=Val, n=Val,</span></span><br><span class="line"><span class="comment">o=Val&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>上面的示例中出现了一个模式，可以使用它来创建一个自动创建和填充 <strong>Map</strong> 的工具：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/FillMap.java</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FillMap</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Map&lt;K,V&gt;</span><br><span class="line">  basic(Supplier&lt;Pair&lt;K,V&gt;&gt; pairGen, <span class="keyword">int</span> size) &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.generate(pairGen)</span><br><span class="line">      .limit(size)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toMap(Pair::key, Pair::value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Map&lt;K,V&gt;</span><br><span class="line">  basic(Supplier&lt;K&gt; keyGen,</span><br><span class="line">        Supplier&lt;V&gt; valueGen, <span class="keyword">int</span> size) &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.generate(</span><br><span class="line">      () -&gt; Pair.make(keyGen.get(), valueGen.get()))</span><br><span class="line">      .limit(size)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toMap(Pair::key, Pair::value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V, M extends Map&lt;K,V&gt;&gt;</span><br><span class="line">  <span class="function">M <span class="title">create</span><span class="params">(Supplier&lt;K&gt; keyGen,</span></span></span><br><span class="line"><span class="function"><span class="params">           Supplier&lt;V&gt; valueGen,</span></span></span><br><span class="line"><span class="function"><span class="params">           Supplier&lt;M&gt; mapSupplier, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.generate( () -&gt;</span><br><span class="line">      Pair.make(keyGen.get(), valueGen.get()))</span><br><span class="line">        .limit(size)</span><br><span class="line">        .collect(Collectors</span><br><span class="line">          .toMap(Pair::key, Pair::value,</span><br><span class="line">                 (k, v) -&gt; k, mapSupplier));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>basic() 方法生成一个默认的 <strong>Map</strong> ，而 <code>create()</code> 方法允许指定一个确切的 <strong>Map</strong> 类型，并返回那个确切的类型。</p>
<p>下面是一个测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/FillMapTest.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FillMapTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,Integer&gt; mcs = FillMap.basic(</span><br><span class="line">      <span class="keyword">new</span> Rand.String(<span class="number">4</span>), <span class="keyword">new</span> Count.Integer(), <span class="number">7</span>);</span><br><span class="line">    System.out.println(mcs);</span><br><span class="line">    HashMap&lt;String,Integer&gt; hashm =</span><br><span class="line">      FillMap.create(<span class="keyword">new</span> Rand.String(<span class="number">4</span>),</span><br><span class="line">        <span class="keyword">new</span> Count.Integer(), HashMap::<span class="keyword">new</span>, <span class="number">7</span>);</span><br><span class="line">    System.out.println(hashm);</span><br><span class="line">    LinkedHashMap&lt;String,Integer&gt; linkm =</span><br><span class="line">      FillMap.create(<span class="keyword">new</span> Rand.String(<span class="number">4</span>),</span><br><span class="line">        <span class="keyword">new</span> Count.Integer(), LinkedHashMap::<span class="keyword">new</span>, <span class="number">7</span>);</span><br><span class="line">    System.out.println(linkm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;npcc=1, ztdv=6, gvgm=3, btpe=0, einn=4, eelo=5,</span></span><br><span class="line"><span class="comment">uxsz=2&#125;</span></span><br><span class="line"><span class="comment">&#123;npcc=1, ztdv=6, gvgm=3, btpe=0, einn=4, eelo=5,</span></span><br><span class="line"><span class="comment">uxsz=2&#125;</span></span><br><span class="line"><span class="comment">&#123;btpe=0, npcc=1, uxsz=2, gvgm=3, einn=4, eelo=5,</span></span><br><span class="line"><span class="comment">ztdv=6&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<!-- Custom Collection and Map using Flyweight -->
<h2 id="使用享元（Flyweight）自定义Collection和Map"><a href="#使用享元（Flyweight）自定义Collection和Map" class="headerlink" title="使用享元（Flyweight）自定义Collection和Map"></a>使用享元（Flyweight）自定义Collection和Map</h2><p>本节介绍如何创建自定义 <strong>Collection</strong> 和 <strong>Map</strong> 实现。每个 <strong>java.util</strong> 中的集合都有自己的 <strong>Abstract</strong> 类，它提供了该集合的部分实现，因此只需要实现必要的方法来生成所需的集合。你将看到通过继承 <strong>java.util.Abstract</strong> 类来创建自定义 <strong>Map</strong> 和 <strong>Collection</strong> 是多么简单。例如，要创建一个只读的 <strong>Set</strong> ，则可以从 <strong>AbstractSet</strong> 继承并实现 <code>iterator()</code> 和 <code>size()</code> 。最后一个示例是生成测试数据的另一种方法。生成的集合通常是只读的，并且所提供的方法最少。</p>
<p>该解决方案还演示了 <em>享元</em> （Flyweight）设计模式。当普通解决方案需要太多对象时，或者当生成普通对象占用太多空间时，可以使用享元。享元设计模式将对象的一部分外部化（externalizes）。相比于把对象的所有内容都包含在对象中，这样做使得对象的部分或者全部可以在更有效的外部表中查找，或通过一些节省空间的其他计算生成。</p>
<p>下面是一个可以是任何大小的 <strong>List</strong> ，并且（有效地）使用 <strong>Integer</strong> 数据进行预初始化。要从 <strong>AbstractList</strong> 创建只读 <strong>List</strong> ，必须实现 <code>get()</code> 和 <code>size()</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/CountingIntegerList.java</span></span><br><span class="line"><span class="comment">// List of any length, containing sample data</span></span><br><span class="line"><span class="comment">// &#123;java onjava.CountingIntegerList&#125;</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingIntegerList</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CountingIntegerList</span><span class="params">()</span> </span>&#123; size = <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CountingIntegerList</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.size = size &lt; <span class="number">0</span> ? <span class="number">0</span> : size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; cil =</span><br><span class="line">      <span class="keyword">new</span> CountingIntegerList(<span class="number">30</span>);</span><br><span class="line">    System.out.println(cil);</span><br><span class="line">    System.out.println(cil.get(<span class="number">500</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,</span></span><br><span class="line"><span class="comment">16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]</span></span><br><span class="line"><span class="comment">500</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>只有当想要限制 <strong>List</strong> 的长度时， <strong>size</strong> 值才是重要的，就像在主方法中那样。即使在这种情况下， <code>get()</code> 也会产生任何值。</p>
<p>这个类是享元模式的一个简洁的例子。当需要的时候， <code>get()</code> “计算”所需的值，因此没必要存储和初始化实际的底层 <strong>List</strong> 结构。</p>
<p>在大多数程序中，这里所保存的存储结构永远都不会改变。但是，它允许用非常大的 <strong>index</strong> 来调用 <code>List.get()</code> ，而 <strong>List</strong> 并不需要填充到这么大。此外，还可以在程序中大量使用 <strong>CountingIntegerLists</strong> 而无需担心存储问题。实际上，享元的一个好处是它允许使用更好的抽象而不用担心资源。</p>
<p>可以使用享元设计模式来实现具有任何大小数据集的其他“初始化”自定义集合。下面是一个 <strong>Map</strong> ，它为每一个 <strong>Integer</strong> 键产生唯一的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/CountMap.java</span></span><br><span class="line"><span class="comment">// Unlimited-length Map containing sample data</span></span><br><span class="line"><span class="comment">// &#123;java onjava.CountMap&#125;</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountMap</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">char</span>[] chars =</span><br><span class="line">    <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>.toCharArray();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">value</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">      chars[key % chars.length] +</span><br><span class="line">      Integer.toString(key / chars.length);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CountMap</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.size = size &lt; <span class="number">0</span> ? <span class="number">0</span> : size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value((Integer)key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    Entry(<span class="keyword">int</span> index) &#123; <span class="keyword">this</span>.index = index; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> o <span class="keyword">instanceof</span> Entry &amp;&amp;</span><br><span class="line">        Objects.equals(index, ((Entry)o).index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> index; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> value(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Objects.hashCode(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Set&lt;Map.Entry&lt;Integer,String&gt;&gt; entrySet() &#123;</span><br><span class="line">    <span class="comment">// LinkedHashSet retains initialization order:</span></span><br><span class="line">    <span class="keyword">return</span> IntStream.range(<span class="number">0</span>, size)</span><br><span class="line">      .mapToObj(Entry::<span class="keyword">new</span>)</span><br><span class="line">      .collect(Collectors</span><br><span class="line">        .toCollection(LinkedHashSet::<span class="keyword">new</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">6</span>;</span><br><span class="line">    CountMap cm = <span class="keyword">new</span> CountMap(<span class="number">60</span>);</span><br><span class="line">    System.out.println(cm);</span><br><span class="line">    System.out.println(cm.get(<span class="number">500</span>));</span><br><span class="line">    cm.values().stream()</span><br><span class="line">      .limit(size)</span><br><span class="line">      .forEach(System.out::println);</span><br><span class="line">    System.out.println();</span><br><span class="line">    <span class="keyword">new</span> Random(<span class="number">47</span>).ints(size, <span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">      .mapToObj(cm::get)</span><br><span class="line">      .forEach(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0,</span></span><br><span class="line"><span class="comment">9=J0, 10=K0, 11=L0, 12=M0, 13=N0, 14=O0, 15=P0, 16=Q0,</span></span><br><span class="line"><span class="comment">17=R0, 18=S0, 19=T0, 20=U0, 21=V0, 22=W0, 23=X0, 24=Y0,</span></span><br><span class="line"><span class="comment">25=Z0, 26=A1, 27=B1, 28=C1, 29=D1, 30=E1, 31=F1, 32=G1,</span></span><br><span class="line"><span class="comment">33=H1, 34=I1, 35=J1, 36=K1, 37=L1, 38=M1, 39=N1, 40=O1,</span></span><br><span class="line"><span class="comment">41=P1, 42=Q1, 43=R1, 44=S1, 45=T1, 46=U1, 47=V1, 48=W1,</span></span><br><span class="line"><span class="comment">49=X1, 50=Y1, 51=Z1, 52=A2, 53=B2, 54=C2, 55=D2, 56=E2,</span></span><br><span class="line"><span class="comment">57=F2, 58=G2, 59=H2&#125;</span></span><br><span class="line"><span class="comment">G19</span></span><br><span class="line"><span class="comment">A0</span></span><br><span class="line"><span class="comment">B0</span></span><br><span class="line"><span class="comment">C0</span></span><br><span class="line"><span class="comment">D0</span></span><br><span class="line"><span class="comment">E0</span></span><br><span class="line"><span class="comment">F0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Y9</span></span><br><span class="line"><span class="comment">J21</span></span><br><span class="line"><span class="comment">R26</span></span><br><span class="line"><span class="comment">D33</span></span><br><span class="line"><span class="comment">Z36</span></span><br><span class="line"><span class="comment">N16</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>要创建一个只读的 <strong>Map</strong> ，则从 <strong>AbstractMap</strong> 继承并实现 <code>entrySet()</code> 。私有的 <code>value()</code> 方法计算任何键的值，并在 <code>get()</code> 和 <code>Entry.getValue()</code> 中使用。可以忽略 <strong>CountMap</strong> 的大小。</p>
<p>这里是使用了 <strong>LinkedHashSet</strong> 而不是创建自定义 <strong>Set</strong> 类，因此并未完全实现享元。只有在调用 <code>entrySet()</code> 时才会生成此对象。</p>
<p>现在创建一个更复杂的享元。这个示例中的数据集是世界各国及其首都的 <strong>Map</strong> 。 <code>capitals()</code> 方法生成一个国家和首都的 <strong>Map</strong> 。 <code>names()</code> 方法生成一个由国家名字组成的 <strong>List</strong> 。 当给定了表示所需大小的 <strong>int</strong> 参数时，两种方法都生成对应大小的列表片段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onjava/Countries.java</span></span><br><span class="line"><span class="comment">// "Flyweight" Maps and Lists of sample data</span></span><br><span class="line"><span class="comment">// &#123;java onjava.Countries&#125;</span></span><br><span class="line"><span class="keyword">package</span> onjava;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Countries</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[][] DATA = &#123;</span><br><span class="line">    <span class="comment">// Africa</span></span><br><span class="line">    &#123;<span class="string">"ALGERIA"</span>,<span class="string">"Algiers"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ANGOLA"</span>,<span class="string">"Luanda"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BENIN"</span>,<span class="string">"Porto-Novo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BOTSWANA"</span>,<span class="string">"Gaberone"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BURKINA FASO"</span>,<span class="string">"Ouagadougou"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BURUNDI"</span>,<span class="string">"Bujumbura"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CAMEROON"</span>,<span class="string">"Yaounde"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CAPE VERDE"</span>,<span class="string">"Praia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CENTRAL AFRICAN REPUBLIC"</span>,<span class="string">"Bangui"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CHAD"</span>,<span class="string">"N'djamena"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COMOROS"</span>,<span class="string">"Moroni"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CONGO"</span>,<span class="string">"Brazzaville"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DJIBOUTI"</span>,<span class="string">"Dijibouti"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"EGYPT"</span>,<span class="string">"Cairo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"EQUATORIAL GUINEA"</span>,<span class="string">"Malabo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ERITREA"</span>,<span class="string">"Asmara"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ETHIOPIA"</span>,<span class="string">"Addis Ababa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GABON"</span>,<span class="string">"Libreville"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THE GAMBIA"</span>,<span class="string">"Banjul"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GHANA"</span>,<span class="string">"Accra"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GUINEA"</span>,<span class="string">"Conakry"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BISSAU"</span>,<span class="string">"Bissau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COTE D'IVOIR (IVORY COAST)"</span>,<span class="string">"Yamoussoukro"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KENYA"</span>,<span class="string">"Nairobi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LESOTHO"</span>,<span class="string">"Maseru"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LIBERIA"</span>,<span class="string">"Monrovia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LIBYA"</span>,<span class="string">"Tripoli"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MADAGASCAR"</span>,<span class="string">"Antananarivo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALAWI"</span>,<span class="string">"Lilongwe"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALI"</span>,<span class="string">"Bamako"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MAURITANIA"</span>,<span class="string">"Nouakchott"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MAURITIUS"</span>,<span class="string">"Port Louis"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MOROCCO"</span>,<span class="string">"Rabat"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MOZAMBIQUE"</span>,<span class="string">"Maputo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NAMIBIA"</span>,<span class="string">"Windhoek"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NIGER"</span>,<span class="string">"Niamey"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NIGERIA"</span>,<span class="string">"Abuja"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"RWANDA"</span>,<span class="string">"Kigali"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SAO TOME E PRINCIPE"</span>,<span class="string">"Sao Tome"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SENEGAL"</span>,<span class="string">"Dakar"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SEYCHELLES"</span>,<span class="string">"Victoria"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SIERRA LEONE"</span>,<span class="string">"Freetown"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOMALIA"</span>,<span class="string">"Mogadishu"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOUTH AFRICA"</span>,<span class="string">"Pretoria/Cape Town"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SUDAN"</span>,<span class="string">"Khartoum"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SWAZILAND"</span>,<span class="string">"Mbabane"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TANZANIA"</span>,<span class="string">"Dodoma"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TOGO"</span>,<span class="string">"Lome"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TUNISIA"</span>,<span class="string">"Tunis"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UGANDA"</span>,<span class="string">"Kampala"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DEMOCRATIC REPUBLIC OF THE CONGO (ZAIRE)"</span>,</span><br><span class="line">     <span class="string">"Kinshasa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ZAMBIA"</span>,<span class="string">"Lusaka"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ZIMBABWE"</span>,<span class="string">"Harare"</span>&#125;,</span><br><span class="line">    <span class="comment">// Asia</span></span><br><span class="line">    &#123;<span class="string">"AFGHANISTAN"</span>,<span class="string">"Kabul"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BAHRAIN"</span>,<span class="string">"Manama"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BANGLADESH"</span>,<span class="string">"Dhaka"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BHUTAN"</span>,<span class="string">"Thimphu"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BRUNEI"</span>,<span class="string">"Bandar Seri Begawan"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CAMBODIA"</span>,<span class="string">"Phnom Penh"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CHINA"</span>,<span class="string">"Beijing"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CYPRUS"</span>,<span class="string">"Nicosia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"INDIA"</span>,<span class="string">"New Delhi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"INDONESIA"</span>,<span class="string">"Jakarta"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"IRAN"</span>,<span class="string">"Tehran"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"IRAQ"</span>,<span class="string">"Baghdad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ISRAEL"</span>,<span class="string">"Jerusalem"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"JAPAN"</span>,<span class="string">"Tokyo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"JORDAN"</span>,<span class="string">"Amman"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KUWAIT"</span>,<span class="string">"Kuwait City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LAOS"</span>,<span class="string">"Vientiane"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LEBANON"</span>,<span class="string">"Beirut"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALAYSIA"</span>,<span class="string">"Kuala Lumpur"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THE MALDIVES"</span>,<span class="string">"Male"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MONGOLIA"</span>,<span class="string">"Ulan Bator"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MYANMAR (BURMA)"</span>,<span class="string">"Rangoon"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NEPAL"</span>,<span class="string">"Katmandu"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NORTH KOREA"</span>,<span class="string">"P'yongyang"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"OMAN"</span>,<span class="string">"Muscat"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PAKISTAN"</span>,<span class="string">"Islamabad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PHILIPPINES"</span>,<span class="string">"Manila"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"QATAR"</span>,<span class="string">"Doha"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SAUDI ARABIA"</span>,<span class="string">"Riyadh"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SINGAPORE"</span>,<span class="string">"Singapore"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOUTH KOREA"</span>,<span class="string">"Seoul"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SRI LANKA"</span>,<span class="string">"Colombo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SYRIA"</span>,<span class="string">"Damascus"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TAIWAN (REPUBLIC OF CHINA)"</span>,<span class="string">"Taipei"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THAILAND"</span>,<span class="string">"Bangkok"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TURKEY"</span>,<span class="string">"Ankara"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED ARAB EMIRATES"</span>,<span class="string">"Abu Dhabi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"VIETNAM"</span>,<span class="string">"Hanoi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"YEMEN"</span>,<span class="string">"Sana'a"</span>&#125;,</span><br><span class="line">    <span class="comment">// Australia and Oceania</span></span><br><span class="line">    &#123;<span class="string">"AUSTRALIA"</span>,<span class="string">"Canberra"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"FIJI"</span>,<span class="string">"Suva"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KIRIBATI"</span>,<span class="string">"Bairiki"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MARSHALL ISLANDS"</span>,<span class="string">"Dalap-Uliga-Darrit"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MICRONESIA"</span>,<span class="string">"Palikir"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NAURU"</span>,<span class="string">"Yaren"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NEW ZEALAND"</span>,<span class="string">"Wellington"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PALAU"</span>,<span class="string">"Koror"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PAPUA NEW GUINEA"</span>,<span class="string">"Port Moresby"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOLOMON ISLANDS"</span>,<span class="string">"Honaira"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TONGA"</span>,<span class="string">"Nuku'alofa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TUVALU"</span>,<span class="string">"Fongafale"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"VANUATU"</span>,<span class="string">"Port Vila"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"WESTERN SAMOA"</span>,<span class="string">"Apia"</span>&#125;,</span><br><span class="line">    <span class="comment">// Eastern Europe and former USSR</span></span><br><span class="line">    &#123;<span class="string">"ARMENIA"</span>,<span class="string">"Yerevan"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"AZERBAIJAN"</span>,<span class="string">"Baku"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BELARUS (BYELORUSSIA)"</span>,<span class="string">"Minsk"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BULGARIA"</span>,<span class="string">"Sofia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GEORGIA"</span>,<span class="string">"Tbilisi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KAZAKSTAN"</span>,<span class="string">"Almaty"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KYRGYZSTAN"</span>,<span class="string">"Alma-Ata"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MOLDOVA"</span>,<span class="string">"Chisinau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"RUSSIA"</span>,<span class="string">"Moscow"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TAJIKISTAN"</span>,<span class="string">"Dushanbe"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TURKMENISTAN"</span>,<span class="string">"Ashkabad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UKRAINE"</span>,<span class="string">"Kyiv"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UZBEKISTAN"</span>,<span class="string">"Tashkent"</span>&#125;,</span><br><span class="line">    <span class="comment">// Europe</span></span><br><span class="line">    &#123;<span class="string">"ALBANIA"</span>,<span class="string">"Tirana"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ANDORRA"</span>,<span class="string">"Andorra la Vella"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"AUSTRIA"</span>,<span class="string">"Vienna"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BELGIUM"</span>,<span class="string">"Brussels"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BOSNIA-HERZEGOVINA"</span>,<span class="string">"Sarajevo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CROATIA"</span>,<span class="string">"Zagreb"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CZECH REPUBLIC"</span>,<span class="string">"Prague"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DENMARK"</span>,<span class="string">"Copenhagen"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ESTONIA"</span>,<span class="string">"Tallinn"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"FINLAND"</span>,<span class="string">"Helsinki"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"FRANCE"</span>,<span class="string">"Paris"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GERMANY"</span>,<span class="string">"Berlin"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GREECE"</span>,<span class="string">"Athens"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HUNGARY"</span>,<span class="string">"Budapest"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ICELAND"</span>,<span class="string">"Reykjavik"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"IRELAND"</span>,<span class="string">"Dublin"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ITALY"</span>,<span class="string">"Rome"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LATVIA"</span>,<span class="string">"Riga"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LIECHTENSTEIN"</span>,<span class="string">"Vaduz"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LITHUANIA"</span>,<span class="string">"Vilnius"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LUXEMBOURG"</span>,<span class="string">"Luxembourg"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MACEDONIA"</span>,<span class="string">"Skopje"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALTA"</span>,<span class="string">"Valletta"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MONACO"</span>,<span class="string">"Monaco"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MONTENEGRO"</span>,<span class="string">"Podgorica"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THE NETHERLANDS"</span>,<span class="string">"Amsterdam"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NORWAY"</span>,<span class="string">"Oslo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"POLAND"</span>,<span class="string">"Warsaw"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PORTUGAL"</span>,<span class="string">"Lisbon"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ROMANIA"</span>,<span class="string">"Bucharest"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SAN MARINO"</span>,<span class="string">"San Marino"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SERBIA"</span>,<span class="string">"Belgrade"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SLOVAKIA"</span>,<span class="string">"Bratislava"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SLOVENIA"</span>,<span class="string">"Ljuijana"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SPAIN"</span>,<span class="string">"Madrid"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SWEDEN"</span>,<span class="string">"Stockholm"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SWITZERLAND"</span>,<span class="string">"Berne"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED KINGDOM"</span>,<span class="string">"London"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"VATICAN CITY"</span>,<span class="string">"Vatican City"</span>&#125;,</span><br><span class="line">    <span class="comment">// North and Central America</span></span><br><span class="line">    &#123;<span class="string">"ANTIGUA AND BARBUDA"</span>,<span class="string">"Saint John's"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BAHAMAS"</span>,<span class="string">"Nassau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BARBADOS"</span>,<span class="string">"Bridgetown"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BELIZE"</span>,<span class="string">"Belmopan"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CANADA"</span>,<span class="string">"Ottawa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COSTA RICA"</span>,<span class="string">"San Jose"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CUBA"</span>,<span class="string">"Havana"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DOMINICA"</span>,<span class="string">"Roseau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DOMINICAN REPUBLIC"</span>,<span class="string">"Santo Domingo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"EL SALVADOR"</span>,<span class="string">"San Salvador"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GRENADA"</span>,<span class="string">"Saint George's"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GUATEMALA"</span>,<span class="string">"Guatemala City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HAITI"</span>,<span class="string">"Port-au-Prince"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HONDURAS"</span>,<span class="string">"Tegucigalpa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"JAMAICA"</span>,<span class="string">"Kingston"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MEXICO"</span>,<span class="string">"Mexico City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NICARAGUA"</span>,<span class="string">"Managua"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PANAMA"</span>,<span class="string">"Panama City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ST. KITTS AND NEVIS"</span>,<span class="string">"Basseterre"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ST. LUCIA"</span>,<span class="string">"Castries"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ST. VINCENT AND THE GRENADINES"</span>,<span class="string">"Kingstown"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED STATES OF AMERICA"</span>,<span class="string">"Washington, D.C."</span>&#125;,</span><br><span class="line">    <span class="comment">// South America</span></span><br><span class="line">    &#123;<span class="string">"ARGENTINA"</span>,<span class="string">"Buenos Aires"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BOLIVIA"</span>,<span class="string">"Sucre (legal)/La Paz(administrative)"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BRAZIL"</span>,<span class="string">"Brasilia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CHILE"</span>,<span class="string">"Santiago"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COLOMBIA"</span>,<span class="string">"Bogota"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ECUADOR"</span>,<span class="string">"Quito"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GUYANA"</span>,<span class="string">"Georgetown"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PARAGUAY"</span>,<span class="string">"Asuncion"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PERU"</span>,<span class="string">"Lima"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SURINAME"</span>,<span class="string">"Paramaribo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TRINIDAD AND TOBAGO"</span>,<span class="string">"Port of Spain"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"URUGUAY"</span>,<span class="string">"Montevideo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"VENEZUELA"</span>,<span class="string">"Caracas"</span>&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Use AbstractMap by implementing entrySet()</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightMap</span></span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> index;</span><br><span class="line">      Entry(<span class="keyword">int</span> index) &#123; <span class="keyword">this</span>.index = index; &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o <span class="keyword">instanceof</span> FlyweightMap &amp;&amp;</span><br><span class="line">          Objects.equals(DATA[index][<span class="number">0</span>], o);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(DATA[index][<span class="number">0</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> DATA[index][<span class="number">0</span>]; &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DATA[index][<span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Implement size() &amp; iterator() for AbstractSet:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">      EntrySet(<span class="keyword">int</span> size) &#123;</span><br><span class="line">        <span class="keyword">if</span>(size &lt; <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// Can't be any bigger than the array:</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(size &gt; DATA.length)</span><br><span class="line">          <span class="keyword">this</span>.size = DATA.length;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">this</span>.size = size;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">      <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Iter</span></span></span><br><span class="line"><span class="class">      <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="comment">// Only one Entry object per Iterator:</span></span><br><span class="line">        <span class="keyword">private</span> Entry entry = <span class="keyword">new</span> Entry(-<span class="number">1</span>);</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> entry.index &lt; size - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Map.<span class="function">Entry&lt;String,String&gt; <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          entry.index++;</span><br><span class="line">          <span class="keyword">return</span> entry;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span></span><br><span class="line">      Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iter();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span></span><br><span class="line">    Set&lt;Map.Entry&lt;String,String&gt;&gt; entries =</span><br><span class="line">      <span class="keyword">new</span> EntrySet(DATA.length);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet() &#123;</span><br><span class="line">      <span class="keyword">return</span> entries;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Create a partial map of 'size' countries:</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> Map&lt;String,String&gt; <span class="title">select</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FlyweightMap() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> Map&lt;String,String&gt; map = <span class="keyword">new</span> FlyweightMap();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; <span class="title">capitals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map; <span class="comment">// The entire map</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; <span class="title">capitals</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> select(size); <span class="comment">// A partial map</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> List&lt;String&gt; names =</span><br><span class="line">    <span class="keyword">new</span> ArrayList&lt;&gt;(map.keySet());</span><br><span class="line">  <span class="comment">// All the names:</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> names; &#125;</span><br><span class="line">  <span class="comment">// A partial list:</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;(select(size).keySet());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(capitals(<span class="number">10</span>));</span><br><span class="line">    System.out.println(names(<span class="number">10</span>));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> HashMap&lt;&gt;(capitals(<span class="number">3</span>)));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="keyword">new</span> LinkedHashMap&lt;&gt;(capitals(<span class="number">3</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> TreeMap&lt;&gt;(capitals(<span class="number">3</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> Hashtable&lt;&gt;(capitals(<span class="number">3</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> HashSet&lt;&gt;(names(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> LinkedHashSet&lt;&gt;(names(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> TreeSet&lt;&gt;(names(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> ArrayList&lt;&gt;(names(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(<span class="keyword">new</span> LinkedList&lt;&gt;(names(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(capitals().get(<span class="string">"BRAZIL"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo,</span></span><br><span class="line"><span class="comment">BOTSWANA=Gaberone, BURKINA FASO=Ouagadougou,</span></span><br><span class="line"><span class="comment">BURUNDI=Bujumbura, CAMEROON=Yaounde, CAPE VERDE=Praia,</span></span><br><span class="line"><span class="comment">CENTRAL AFRICAN REPUBLIC=Bangui, CHAD=N'djamena&#125;</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI, CAMEROON, CAPE VERDE, CENTRAL AFRICAN</span></span><br><span class="line"><span class="comment">REPUBLIC, CHAD]</span></span><br><span class="line"><span class="comment">&#123;BENIN=Porto-Novo, ANGOLA=Luanda, ALGERIA=Algiers&#125;</span></span><br><span class="line"><span class="comment">&#123;ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo&#125;</span></span><br><span class="line"><span class="comment">&#123;ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo&#125;</span></span><br><span class="line"><span class="comment">&#123;ALGERIA=Algiers, ANGOLA=Luanda, BENIN=Porto-Novo&#125;</span></span><br><span class="line"><span class="comment">[BENIN, BOTSWANA, ANGOLA, BURKINA FASO, ALGERIA,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">Brasilia</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>二维数组 <strong>String DATA</strong> 是 <strong>public</strong> 的，因此可以在别处使用。 <strong>FlyweightMap</strong> 必须实现 <code>entrySet()</code> 方法，该方法需要一个自定义 <strong>Set</strong> 实现和一个自定义 <strong>Map.Entry</strong> 类。这是实现享元的另一种方法：每个 <strong>Map.Entry</strong> 对象存储它自身的索引，而不是实际的键和值。当调用 <code>getKey()</code> 或 <code>getValue()</code> 时，它使用索引返回相应的 <strong>DATA</strong> 元素。 <strong>EntrySet</strong> 确保它的 <strong>size</strong> 不大于 <strong>DATA</strong> 。</p>
<p>享元的另一部分在 <strong>EntrySet.Iterator</strong> 中实现。相比于为 <strong>DATA</strong> 中的每个数据对创建一个 <strong>Map.Entry</strong> 对象，这里每个迭代器只有一个 <strong>Map.Entry</strong> 对象。 <strong>Entry</strong> 对象作为数据的窗口，它只包含 <strong>String</strong> 静态数组的索引。每次为迭代器调用 <code>next()</code> 时，<strong>Entry</strong> 中的索引都会递增，因此它会指向下一个数据对，然后从 <code>next()</code> 返回 <strong>Iterators</strong> 的单个 <strong>Entry</strong> 对象。[^1]</p>
<p><code>select()</code> 方法生成一个包含所需大小的 <strong>EntrySet</strong> 的 <strong>FlyweightMap</strong> ，这用于在主方法中演示的重载的 <code>capitals()</code> 和 <code>names()</code> 方法。</p>
<!-- Collection Functionality -->
<h2 id="集合功能"><a href="#集合功能" class="headerlink" title="集合功能"></a>集合功能</h2><p>下面这个表格展示了可以对 <strong>Collection</strong> 执行的所有操作（不包括自动继承自 <strong>Object</strong> 的方法），因此，可以用 <strong>List</strong> ， <strong>Set</strong> ， <strong>Queue</strong> 或 <strong>Deque</strong> 执行这里的所有操作（这些接口可能也提供了一些其他的功能）。<strong>Map</strong> 不是从 <strong>Collection</strong> 继承的，所以要单独处理它。</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>boolean add(T)</strong></td>
<td style="text-align:left">确保集合包含该泛型类型 <strong>T</strong> 的参数。如果不添加参数，则返回 <strong>false</strong> 。 （这是一种“可选”方法，将在下一节中介绍。）</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean addAll(Collection\&lt;? extends T>)</strong></td>
<td style="text-align:left">添加参数集合中的所有元素。只要有元素被成功添加则返回 <strong>true</strong>。（“可选的”）</td>
</tr>
<tr>
<td style="text-align:center"><strong>void clear()</strong></td>
<td style="text-align:left">删除集合中的所有元素。（“可选的”）</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean contains(T)</strong></td>
<td style="text-align:left">如果目标集合包含该泛型类型 <strong>T</strong> 的参数，则返回 <strong>true</strong> 。</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean containsAll(Collection\&lt;?>)</strong></td>
<td style="text-align:left">如果目标集合包含参数集合中的所有元素，则返回 <strong>true</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean isEmpty()</strong></td>
<td style="text-align:left">如果集合为空，则返回 <strong>true</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>Iterator\&lt;T> iterator() Spliterator\&lt;T> spliterator()</strong></td>
<td style="text-align:left">返回一个迭代器来遍历集合中的元素。 <strong>Spliterators</strong> 更复杂一些，它用在并发场景</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean remove(Object)</strong></td>
<td style="text-align:left">如果目标集合包含该参数，则在集合中删除该参数，如果成功删除则返回 <strong>true</strong> 。（“可选的”）</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean removeAll(Collection\&lt;?>)</strong></td>
<td style="text-align:left">删除目标集合中，参数集合所包含的全部元素。如果有元素被成功删除则返回 <strong>true</strong> 。 （“可选的”）</td>
</tr>
<tr>
<td style="text-align:center"><strong>boolean removeIf(Predicate\&lt;? super E>)</strong></td>
<td style="text-align:left">删除此集合中，满足给定断言（predicate）的所有元素</td>
</tr>
<tr>
<td style="text-align:center"><strong>Stream\&lt;E> stream() Stream\&lt;E> parallelStream()</strong></td>
<td style="text-align:left">返回由该 <strong>Collection</strong> 中元素所组成的一个 <strong>Stream</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>int size()</strong></td>
<td style="text-align:left">返回集合中所包含元素的个数</td>
</tr>
<tr>
<td style="text-align:center"><strong>Object[] toArrat()</strong></td>
<td style="text-align:left">返回包含该集合所有元素的一个数组</td>
</tr>
<tr>
<td style="text-align:center"><strong>\&lt;T> T[] toArray(T[] a)</strong></td>
<td style="text-align:left">返回包含该集合所有元素的一个数组。结果的运行时类型是参数数组而不是普通的 <strong>Object</strong> 数组。</td>
</tr>
</tbody>
</table>
<p>这里没有提供用于随机访问元素的 <strong>get()</strong> 方法，因为 <strong>Collection</strong> 还包含 <strong>Set</strong> ，它维护自己的内部排序，所以随机访问查找就没有意义了。因此，要查找 <strong>Collection</strong> 中的元素必须使用迭代器。</p>
<p>下面这个示例演示了 <strong>Collection</strong> 的所有方法。这里以 <strong>ArrayList</strong> 为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/CollectionMethods.java</span></span><br><span class="line"><span class="comment">// Things you can do with all Collections</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> onjava.HTMLColors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionMethods</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection&lt;String&gt; c =</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;(LIST.subList(<span class="number">0</span>, <span class="number">4</span>));</span><br><span class="line">    c.add(<span class="string">"ten"</span>);</span><br><span class="line">    c.add(<span class="string">"eleven"</span>);</span><br><span class="line">    show(c);</span><br><span class="line">    border();</span><br><span class="line">    <span class="comment">// Make an array from the List:</span></span><br><span class="line">    Object[] array = c.toArray();</span><br><span class="line">    <span class="comment">// Make a String array from the List:</span></span><br><span class="line">    String[] str = c.toArray(<span class="keyword">new</span> String[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// Find max and min elements; this means</span></span><br><span class="line">    <span class="comment">// different things depending on the way</span></span><br><span class="line">    <span class="comment">// the Comparable interface is implemented:</span></span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"Collections.max(c) = "</span> + Collections.max(c));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"Collections.min(c) = "</span> + Collections.min(c));</span><br><span class="line">    border();</span><br><span class="line">    <span class="comment">// Add a Collection to another Collection</span></span><br><span class="line">    Collection&lt;String&gt; c2 =</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;(LIST.subList(<span class="number">10</span>, <span class="number">14</span>));</span><br><span class="line">    c.addAll(c2);</span><br><span class="line">    show(c);</span><br><span class="line">    border();</span><br><span class="line">    c.remove(LIST.get(<span class="number">0</span>));</span><br><span class="line">    show(c);</span><br><span class="line">    border();</span><br><span class="line">    <span class="comment">// Remove all components that are</span></span><br><span class="line">    <span class="comment">// in the argument collection:</span></span><br><span class="line">    c.removeAll(c2);</span><br><span class="line">    show(c);</span><br><span class="line">    border();</span><br><span class="line">    c.addAll(c2);</span><br><span class="line">    show(c);</span><br><span class="line">    border();</span><br><span class="line">    <span class="comment">// Is an element in this Collection?</span></span><br><span class="line">    String val = LIST.get(<span class="number">3</span>);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"c.contains("</span> + val  + <span class="string">") = "</span> + c.contains(val));</span><br><span class="line">    <span class="comment">// Is a Collection in this Collection?</span></span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"c.containsAll(c2) = "</span> + c.containsAll(c2));</span><br><span class="line">    Collection&lt;String&gt; c3 =</span><br><span class="line">      ((List&lt;String&gt;)c).subList(<span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="comment">// Keep all the elements that are in both</span></span><br><span class="line">    <span class="comment">// c2 and c3 (an intersection of sets):</span></span><br><span class="line">    c2.retainAll(c3);</span><br><span class="line">    show(c2);</span><br><span class="line">    <span class="comment">// Throw away all the elements</span></span><br><span class="line">    <span class="comment">// in c2 that also appear in c3:</span></span><br><span class="line">    c2.removeAll(c3);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"c2.isEmpty() = "</span> +  c2.isEmpty());</span><br><span class="line">    border();</span><br><span class="line">    <span class="comment">// Functional operation:</span></span><br><span class="line">    c = <span class="keyword">new</span> ArrayList&lt;&gt;(LIST);</span><br><span class="line">    c.removeIf(s -&gt; !s.startsWith(<span class="string">"P"</span>));</span><br><span class="line">    c.removeIf(s -&gt; s.startsWith(<span class="string">"Pale"</span>));</span><br><span class="line">    <span class="comment">// Stream operation:</span></span><br><span class="line">    c.stream().forEach(System.out::println);</span><br><span class="line">    c.clear(); <span class="comment">// Remove all elements</span></span><br><span class="line">    System.out.println(<span class="string">"after c.clear():"</span> + c);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">ten</span></span><br><span class="line"><span class="comment">eleven</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">Collections.max(c) = ten</span></span><br><span class="line"><span class="comment">Collections.min(c) = AliceBlue</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AliceBlue</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">ten</span></span><br><span class="line"><span class="comment">eleven</span></span><br><span class="line"><span class="comment">Brown</span></span><br><span class="line"><span class="comment">BurlyWood</span></span><br><span class="line"><span class="comment">CadetBlue</span></span><br><span class="line"><span class="comment">Chartreuse</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">ten</span></span><br><span class="line"><span class="comment">eleven</span></span><br><span class="line"><span class="comment">Brown</span></span><br><span class="line"><span class="comment">BurlyWood</span></span><br><span class="line"><span class="comment">CadetBlue</span></span><br><span class="line"><span class="comment">Chartreuse</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">ten</span></span><br><span class="line"><span class="comment">eleven</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">AntiqueWhite</span></span><br><span class="line"><span class="comment">Aquamarine</span></span><br><span class="line"><span class="comment">Azure</span></span><br><span class="line"><span class="comment">ten</span></span><br><span class="line"><span class="comment">eleven</span></span><br><span class="line"><span class="comment">Brown</span></span><br><span class="line"><span class="comment">BurlyWood</span></span><br><span class="line"><span class="comment">CadetBlue</span></span><br><span class="line"><span class="comment">Chartreuse</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">c.contains(Azure) = true</span></span><br><span class="line"><span class="comment">c.containsAll(c2) = true</span></span><br><span class="line"><span class="comment">c2.isEmpty() = true</span></span><br><span class="line"><span class="comment">******************************</span></span><br><span class="line"><span class="comment">PapayaWhip</span></span><br><span class="line"><span class="comment">PeachPuff</span></span><br><span class="line"><span class="comment">Peru</span></span><br><span class="line"><span class="comment">Pink</span></span><br><span class="line"><span class="comment">Plum</span></span><br><span class="line"><span class="comment">PowderBlue</span></span><br><span class="line"><span class="comment">Purple</span></span><br><span class="line"><span class="comment">after c.clear():[]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>为了只演示 <strong>Collection</strong> 接口的方法，而没有其它额外的内容，所以这里创建包含不同数据集的 <strong>ArrayList</strong> ，并向上转型为 <strong>Collection</strong> 对象。</p>
<!-- Optional Operations -->
<h2 id="可选操作"><a href="#可选操作" class="headerlink" title="可选操作"></a>可选操作</h2><p>在 <strong>Collection</strong> 接口中执行各种添加和删除操作的方法是 <em>可选操作</em> （optional operations）。这意味着实现类不需要为这些方法提供功能定义。</p>
<p>这是一种非常不寻常的定义接口的方式。正如我们所知，接口是一种合约（contract）。它表达的意思是，“无论你如何选择实现这个接口，我保证你可以将这些消息发送到这个对象”（我在这里使用术语“接口”来描述正式的 <strong>interface</strong> 关键字和“任何类或子类都支持的方法”的更一般含义）。但“可选”操作违反了这一基本原则，它表示调用某些方法不会执行有意义的行为。相反，它们会抛出异常！这看起来似乎丢失了编译时的类型安全性。</p>
<p>其实没那么糟糕。如果操作是可选的，编译器仍然能够限制你仅调用该接口中的方法。它不像动态语言那样，可以为任何对象调用任何方法，并在运行时查找特定的调用是否可行。[^2]此外，大多数将 <strong>Collection</strong> 作为参数的方法仅从该 <strong>Collection</strong> 中读取，并且 <strong>Collection</strong> 的所有“读取”方法都不是可选的。</p>
<p>为什么要将方法定义为“可选”的？因为这样做可以防止设计中的接口爆炸。集合库的其他设计往往会产生令人困惑的过多接口来描述主题的每个变体。这甚至使得不可能捕获到接口中的所有特殊情况，因为总有人能发明一个新的接口。“不支持的操作（unsupported operation）”这种方式实现了Java集合库的一个重要目标：集合要易于学习和使用。不支持的操作是一种特殊情况，可以推迟到必要的时候。但是，要使用此方法：</p>
<ol>
<li><p><strong>UnsupportedOperationException</strong> 必须是一个罕见的事件。也就是说，对于大多数类，所有操作都应该起作用，并且只有在特殊情况下才应该不支持某项操作。这在Java集合库中是正确的，因为99%的时间使用到的类 —— <strong>ArrayList</strong> ， <strong>LinkedList</strong> ， <strong>HashSet</strong> 和 <strong>HashMap</strong> ，以及其他具体实现，都支持所有操作。该设计确实为创建一个新的 <strong>Collection</strong> 提供了一个“后门”，可以不为 <strong>Collection</strong> 接口中的所有方法都提供有意义的定义，这些定义仍然适合现有的类库。</p>
</li>
<li><p>当不支持某个操作时， <strong>UnsupportedOperationException</strong> 应该出现在实现阶段，而不是在将产品发送给客户之后。毕竟，这个异常表示编程错误：错误地使用了一个具体实现。</p>
</li>
</ol>
<p>值得注意的是，不支持的操作只能在运行时检测到，因此这代表动态类型检查。如果你来自像 C++ 这样的静态类型语言，Java 可能看起来只是另一种静态类型语言。当然， Java 肯定有静态类型检查，但它也有大量的动态类型，因此很难说它只是静态语言或动态语言。一旦你开始注意到这一点，你就会开始看到 Java 中动态类型检查的其他示例。</p>
<!-- Unsupported Operations -->
<h3 id="不支持的操作"><a href="#不支持的操作" class="headerlink" title="不支持的操作"></a>不支持的操作</h3><p>不支持的操作的常见来源是由固定大小的数据结构所支持的集合。使用 <code>Arrays.asList()</code> 方法将数组转换为 <strong>List</strong> 时，就会得到这样的集合。此外，还可以选择使用 <strong>Collections</strong> 类中的“不可修改（unmodifiable）”方法使任何集合（包括 <strong>Map</strong> ）抛出 <strong>UnsupportedOperationException</strong> 异常。此示例展示了这两种情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Unsupported.java</span></span><br><span class="line"><span class="comment">// Unsupported operations in Java collections</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Unsupported</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">  check(String description, Runnable tst) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      tst.run();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      System.out.println(description + <span class="string">"(): "</span> + e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(String msg, List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"--- "</span> + msg + <span class="string">" ---"</span>);</span><br><span class="line">    Collection&lt;String&gt; c = list;</span><br><span class="line">    Collection&lt;String&gt; subList = list.subList(<span class="number">1</span>,<span class="number">8</span>);</span><br><span class="line">    <span class="comment">// Copy of the sublist:</span></span><br><span class="line">    Collection&lt;String&gt; c2 = <span class="keyword">new</span> ArrayList&lt;&gt;(subList);</span><br><span class="line">    check(<span class="string">"retainAll"</span>, () -&gt; c.retainAll(c2));</span><br><span class="line">    check(<span class="string">"removeAll"</span>, () -&gt; c.removeAll(c2));</span><br><span class="line">    check(<span class="string">"clear"</span>, () -&gt; c.clear());</span><br><span class="line">    check(<span class="string">"add"</span>, () -&gt; c.add(<span class="string">"X"</span>));</span><br><span class="line">    check(<span class="string">"addAll"</span>, () -&gt; c.addAll(c2));</span><br><span class="line">    check(<span class="string">"remove"</span>, () -&gt; c.remove(<span class="string">"C"</span>));</span><br><span class="line">    <span class="comment">// The List.set() method modifies the value but</span></span><br><span class="line">    <span class="comment">// doesn't change the size of the data structure:</span></span><br><span class="line">    check(<span class="string">"List.set"</span>, () -&gt; list.set(<span class="number">0</span>, <span class="string">"X"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(</span><br><span class="line">      <span class="string">"A B C D E F G H I J K L"</span>.split(<span class="string">" "</span>));</span><br><span class="line">    test(<span class="string">"Modifiable Copy"</span>, <span class="keyword">new</span> ArrayList&lt;&gt;(list));</span><br><span class="line">    test(<span class="string">"Arrays.asList()"</span>, list);</span><br><span class="line">    test(<span class="string">"unmodifiableList()"</span>,</span><br><span class="line">      Collections.unmodifiableList(</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;(list)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">--- Modifiable Copy ---</span></span><br><span class="line"><span class="comment">--- Arrays.asList() ---</span></span><br><span class="line"><span class="comment">retainAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">removeAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">clear(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">add(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">addAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">remove(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">--- unmodifiableList() ---</span></span><br><span class="line"><span class="comment">retainAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">removeAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">clear(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">add(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">addAll(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">remove(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">List.set(): java.lang.UnsupportedOperationException</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>因为 <code>Arrays.asList()</code> 生成的 <strong>List</strong> 由一个固定大小的数组所支持，所以唯一支持的操作是那些不改变数组大小的操作。任何会导致更改基础数据结构大小的方法都会产生 <strong>UnsupportedOperationException</strong> 异常，来说明这是对不支持的方法的调用（编程错误）。</p>
<p>请注意，始终可以将 <code>Arrays.asList()</code> 的结果作为一个参数传递给任何 <strong>Collection</strong> 的构造方法（或使用 <code>addAll()</code> 方法或静态的 <code>Collections.addAll()</code> 方法）来创建一个允许使用所有方法的常规集合，在主方法中第一次调用 <code>test()</code> 时显示了这种情况。这种调用产生了一个新的可调整大小的底层数据结构。</p>
<p><strong>Collections</strong> 类中的“unmodifiable”方法会将集合包装一个代理中，如果执行任何想要修改集合的操作，则该代理会生成 <strong>UnsupportedOperationException</strong> 异常。使用这些方法的目的是生成一个“常量”集合对象。稍后将描述“unmodifiable“集合方法的完整列表。</p>
<p><code>test()</code> 中的最后一个 <code>check()</code> 用于测试<strong>List</strong> 的 <code>set()</code> 方法。这里，“不支持的操作”技术的粒度（granularity）就派上用场了，得到的“接口”可以通过一种方法在 <code>Arrays.asList()</code> 返回的对象和 <code>Collections.unmodifiableList()</code> 返回的对象之间变换。 <code>Arrays.asList()</code> 返回固定大小的 <strong>List</strong> ，而 <code>Collections.unmodifiableList()</code> 生成无法更改的 <strong>List</strong> 。如输出中所示， <code>Arrays.asList()</code> 返回的 <strong>List</strong> 中的元素是可以修改的，因为这不会违反该 <strong>List</strong> 的“固定大小”特性。但很明显， <code>unmodifiableList()</code> 的结果不应该以任何方式修改。如果使用接口来描述，则需要两个额外的接口，一个具有可用的 <code>set()</code> 方法，而另一个没有。 <strong>Collection</strong> 的各种不可修改的子类型都将需要额外的接口。</p>
<p>如果一个方法将一个集合作为它的参数，那么它的文档应该说明必须实现哪些可选方法。</p>
<!-- Sets and Storage Order -->
<h2 id="Set和存储顺序"><a href="#Set和存储顺序" class="headerlink" title="Set和存储顺序"></a>Set和存储顺序</h2><p><a href>第十二章 集合</a>章节中的 <strong>Set</strong> 有关示例对 <strong>Set</strong> 的基本操作做了很好的介绍。 但是，这些示例可以方便地使用预定义的 Java 类型，例如 <strong>Integer</strong> 和 <strong>String</strong> ，它们可以在集合中使用。在创建自己的类型时请注意， <strong>Set</strong> （以及稍后会看到的 <strong>Map</strong> ）需要一种维护存储顺序的方法，该顺序因 <strong>Set</strong> 的不同实现而异。因此，不同的 <strong>Set</strong> 实现不仅具有不同的行为，而且它们对可以放入特定 <strong>Set</strong> 中的对象类型也有不同的要求：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Set</strong> 类型</th>
<th style="text-align:left">约束</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Set(interface)</strong></td>
<td style="text-align:left">添加到 <strong>Set</strong> 中的每个元素必须是唯一的，否则，<strong>Set</strong> 不会添加重复元素。添加到 <strong>Set</strong> 的元素必须至少定义 <code>equals()</code> 方法以建立对象唯一性。 <strong>Set</strong> 与 <strong>Collection</strong> 具有完全相同的接口。 <strong>Set</strong> 接口不保证它将以任何特定顺序维护其元素。</td>
</tr>
<tr>
<td style="text-align:center"><strong>HashSet*</strong></td>
<td style="text-align:left">注重快速查找元素的集合，其中元素必须定义 <code>hashCode()</code> 和 <code>equals()</code> 方法。</td>
</tr>
<tr>
<td style="text-align:center"><strong>TreeSet</strong></td>
<td style="text-align:left">由树支持的有序 <strong>Set</strong>。这样，就可以从 <strong>Set</strong> 中获取有序序列，其中元素必须实现 <strong>Comparable</strong> 接口。</td>
</tr>
<tr>
<td style="text-align:center"><strong>LinkedHashSet</strong></td>
<td style="text-align:left">具有 <strong>HashSet</strong> 的查找速度，但在内部使用链表维护元素的插入顺序。因此，当在遍历 <strong>Set</strong> 时，结果将按元素的插入顺序显示。元素必须定义 <code>hashCode()</code> 和 <code>equals()</code> 方法。</td>
</tr>
</tbody>
</table>
<p><strong>HashSet</strong> 上的星号表示，在没有其他约束的情况下，这应该是你的默认选择，因为它针对速度进行了优化。</p>
<p>定义 <code>hashCode()</code> 方法在<a href>附录:理解equals和hashCode方法</a>中进行了描述。必须为散列和树存储结构创建 <code>equals()</code> 方法，但只有当把类放在 <strong>HashSet</strong> 中时才需要 <code>hashCode()</code> （当然这很有可能，因为 <strong>HashSet</strong> 通常应该是作为 <strong>Set</strong> 实现的首选）或 <strong>LinkedHashSet</strong> 。 但是，作为一种良好的编程风格，在覆盖 <code>equals()</code> 时应始终覆盖 <code>hashCode()</code> 。</p>
<p>下面的示例演示了成功使用具有特定 <strong>Set</strong> 实现的类型所需的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/TypesForSets.java</span></span><br><span class="line"><span class="comment">// Methods necessary to put your own type in a Set</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">int</span> i;</span><br><span class="line">  SetType(<span class="keyword">int</span> n) &#123; i = n; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> o <span class="keyword">instanceof</span> SetType &amp;&amp;</span><br><span class="line">      Objects.equals(i, ((SetType)o).i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer.toString(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashType</span> <span class="keyword">extends</span> <span class="title">SetType</span> </span>&#123;</span><br><span class="line">  HashType(<span class="keyword">int</span> n) &#123; <span class="keyword">super</span>(n); &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hashCode(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeType</span> <span class="keyword">extends</span> <span class="title">SetType</span></span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">TreeType</span>&gt; </span>&#123;</span><br><span class="line">  TreeType(<span class="keyword">int</span> n) &#123; <span class="keyword">super</span>(n); &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(TreeType arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer.compare(arg.i, i);</span><br><span class="line">    <span class="comment">// Equivalent to:</span></span><br><span class="line">    <span class="comment">// return arg.i &lt; i ? -1 : (arg.i == i ? 0 : 1);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TypesForSets</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span></span><br><span class="line">  fill(Set&lt;T&gt; set, Function&lt;Integer, T&gt; type) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">10</span>; i &gt;= <span class="number">5</span>; i--) <span class="comment">// Descending</span></span><br><span class="line">      set.add(type.apply(i));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) <span class="comment">// Ascending</span></span><br><span class="line">      set.add(type.apply(i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span></span><br><span class="line">  test(Set&lt;T&gt; set, Function&lt;Integer, T&gt; type) &#123;</span><br><span class="line">    fill(set, type);</span><br><span class="line">    fill(set, type); <span class="comment">// Try to add duplicates</span></span><br><span class="line">    fill(set, type);</span><br><span class="line">    System.out.println(set);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    test(<span class="keyword">new</span> HashSet&lt;&gt;(), HashType::<span class="keyword">new</span>);</span><br><span class="line">    test(<span class="keyword">new</span> LinkedHashSet&lt;&gt;(), HashType::<span class="keyword">new</span>);</span><br><span class="line">    test(<span class="keyword">new</span> TreeSet&lt;&gt;(), TreeType::<span class="keyword">new</span>);</span><br><span class="line">    <span class="comment">// Things that don't work:</span></span><br><span class="line">    test(<span class="keyword">new</span> HashSet&lt;&gt;(), SetType::<span class="keyword">new</span>);</span><br><span class="line">    test(<span class="keyword">new</span> HashSet&lt;&gt;(), TreeType::<span class="keyword">new</span>);</span><br><span class="line">    test(<span class="keyword">new</span> LinkedHashSet&lt;&gt;(), SetType::<span class="keyword">new</span>);</span><br><span class="line">    test(<span class="keyword">new</span> LinkedHashSet&lt;&gt;(), TreeType::<span class="keyword">new</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      test(<span class="keyword">new</span> TreeSet&lt;&gt;(), SetType::<span class="keyword">new</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      System.out.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      test(<span class="keyword">new</span> TreeSet&lt;&gt;(), HashType::<span class="keyword">new</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">      System.out.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line"><span class="comment">[10, 9, 8, 7, 6, 5, 0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]</span></span><br><span class="line"><span class="comment">[1, 6, 8, 6, 2, 7, 8, 9, 4, 10, 7, 5, 1, 3, 4, 9, 9,</span></span><br><span class="line"><span class="comment">10, 5, 3, 2, 0, 4, 1, 2, 0, 8, 3, 0, 10, 6, 5, 7]</span></span><br><span class="line"><span class="comment">[3, 1, 4, 8, 7, 6, 9, 5, 3, 0, 10, 5, 5, 10, 7, 8, 8,</span></span><br><span class="line"><span class="comment">9, 1, 4, 10, 2, 6, 9, 1, 6, 0, 3, 2, 0, 7, 2, 4]</span></span><br><span class="line"><span class="comment">[10, 9, 8, 7, 6, 5, 0, 1, 2, 3, 4, 10, 9, 8, 7, 6, 5,</span></span><br><span class="line"><span class="comment">0, 1, 2, 3, 4, 10, 9, 8, 7, 6, 5, 0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">[10, 9, 8, 7, 6, 5, 0, 1, 2, 3, 4, 10, 9, 8, 7, 6, 5,</span></span><br><span class="line"><span class="comment">0, 1, 2, 3, 4, 10, 9, 8, 7, 6, 5, 0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">SetType cannot be cast to java.lang.Comparable</span></span><br><span class="line"><span class="comment">HashType cannot be cast to java.lang.Comparable</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>为了证明特定 <strong>Set</strong> 需要哪些方法，同时避免代码重复，这里创建了三个类。基类 <strong>SetType</strong> 存储一个 <strong>int</strong> 值，并通过 <code>toString()</code> 方法打印它。由于存储在 <strong>Set</strong> 中的所有类都必须具有 <code>equals()</code> ，因此该方法也放在基类中。基于 <code>int i</code> 来判断元素是否相等。</p>
<p><strong>HashType</strong> 继承自 <strong>SetType</strong> ，并添加了 <code>hashCode()</code> 方法，该方法对于 <strong>Set</strong> 的散列实现是必需的。</p>
<p>要在任何类型的有序集合中使用对象，由 <strong>TreeType</strong> 实现的 <strong>Comparable</strong> 接口都是必需的，例如 <strong>SortedSet</strong> （ <strong>TreeSet</strong> 是其唯一实现）。在 <code>compareTo()</code> 中，请注意我没有使用“简单明了”的形式： <code>return i-i2</code> 。虽然这是一个常见的编程错误，但只有当 <strong>i</strong> 和 <strong>i2</strong> 是“无符号（unsigned）”整型时才能正常工作（如果 Java 有一个“unsigned”关键字的话，不过它没有）。它破坏了 Java 的有符号 <strong>int</strong> ，它不足以代表两个有符号整数的差异。如果 <strong>i</strong> 是一个大的正整数而 <strong>j</strong> 是一个大的负整数， <code>i-j</code> 将溢出并返回一个负值，这不是我们所需要的。</p>
<p>通常希望 <code>compareTo()</code> 方法生成与 <code>equals()</code> 方法一致的自然顺序。如果 <code>equals()</code> 对于特定比较产生 <strong>true</strong>，则 <code>compareTo()</code> 应该为该比较返回结果 零，并且如果 <code>equals()</code> 为比较产生 <strong>false</strong> ，则 <code>compareTo()</code> 应该为该比较产生非零结果。</p>
<p>在 <strong>TypesForSets</strong> 中， <code>fill()</code> 和 <code>test()</code> 都是使用泛型定义的，以防止代码重复。为了验证 <strong>Set</strong> 的行为， <code>test()</code> 在测试集上调用 <code>fill()</code> 三次，尝试引入重复的对象。 <code>fill()</code> 方法的参数可以接收任意一个 <strong>Set</strong> 类型，以及生成该类型的 <strong>Function</strong> 对象。因为此示例中使用的所有对象都有一个带有单个 <strong>int</strong> 参数的构造方法，所以可以将构造方法作为此 <strong>Function</strong> 传递，它将提供用于填充 <strong>Set</strong> 的对象。</p>
<p>请注意， <code>fill()</code> 方法按降序添加前五个元素，按升序添加后五个元素，以此来指出生成的存储顺序。输出显示 <strong>HashSet</strong> 按升序保留元素，但是，在<a href>附录:理解equals和hashCode方法</a>中，你会发现这只是偶然的，因为散列会创建自己的存储顺序。这里只是因为元素是一个简单的 <strong>int</strong> ，在这种情况下它是升序的。 <strong>LinkedHashSet</strong> 按照插入顺序保存元素，<strong>TreeSet</strong> 按排序顺序维护元素（在此示例中因为 <code>compareTo()</code> 的实现方式，所以元素按降序排列。）</p>
<p>特定的 <strong>Set</strong> 类型一般都有所必需的操作，如果尝试使用没能正确支持这些操作的类型，那么事情就会出错。将没有重新定义 <code>hashCode()</code> 方法的 <strong>SetType</strong> 或 <strong>TreeType</strong> 对象放入任何散列实现会导致重复值，因此违反了 <strong>Set</strong> 的主要契约。 这是相当令人不安的，因为这甚至不产生运行时错误。但是，默认的 <code>hashCode()</code> 是合法的，所以即使它是不正确的，这也是合法的行为。确保此类程序正确性的唯一可靠方法是将单元测试合并到构建系统中。</p>
<p>如果尝试在 <strong>TreeSet</strong> 中使用没有实现 <strong>Comparable</strong> 接口的类型，则会得到更明确的结果：当 <strong>TreeSet</strong> 尝试将对象用作一个 <strong>Comparable</strong> 时，将会抛出异常。</p>
<!-- SortedSet -->
<h3 id="SortedSet"><a href="#SortedSet" class="headerlink" title="SortedSet"></a>SortedSet</h3><p><strong>SortedSet</strong> 中的元素保证按排序规则顺序， <strong>SortedSet</strong> 接口中的以下方法可以产生其他功能：</p>
<ul>
<li><code>Comparator comparator()</code> ：生成用于此 <strong>Set</strong> 的<strong>Comparator</strong> 或 <strong>null</strong> 来用于自然排序。</li>
<li><code>Object first()</code> ：返回第一个元素。</li>
<li><code>Object last()</code> ：返回最后一个元素。</li>
<li><code>SortedSet subSet(fromElement，toElement)</code> ：使用 <strong>fromElement</strong> （包含）和 <strong>toElement</strong> （不包括）中的元素生成此 <strong>Set</strong> 的一个视图。</li>
<li><code>SortedSet headSet(toElement)</code> ：使用顺序在 <strong>toElement</strong> 之前的元素生成此 <strong>Set</strong> 的一个视图。</li>
<li><code>SortedSet tailSet(fromElement)</code> ：使用顺序在 <strong>fromElement</strong> 之后（包含 <strong>fromElement</strong> ）的元素生成此 <strong>Set</strong> 的一个视图。</li>
</ul>
<p>下面是一个简单的演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/SortedSetDemo.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.stream.Collectors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortedSetDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SortedSet&lt;String&gt; sortedSet =</span><br><span class="line">      Arrays.stream(</span><br><span class="line">        <span class="string">"one two three four five six seven eight"</span></span><br><span class="line">        .split(<span class="string">" "</span>))</span><br><span class="line">        .collect(toCollection(TreeSet::<span class="keyword">new</span>));</span><br><span class="line">    System.out.println(sortedSet);</span><br><span class="line">    String low = sortedSet.first();</span><br><span class="line">    String high = sortedSet.last();</span><br><span class="line">    System.out.println(low);</span><br><span class="line">    System.out.println(high);</span><br><span class="line">    Iterator&lt;String&gt; it = sortedSet.iterator();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span>(i == <span class="number">3</span>) low = it.next();</span><br><span class="line">      <span class="keyword">if</span>(i == <span class="number">6</span>) high = it.next();</span><br><span class="line">      <span class="keyword">else</span> it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(low);</span><br><span class="line">    System.out.println(high);</span><br><span class="line">    System.out.println(sortedSet.subSet(low, high));</span><br><span class="line">    System.out.println(sortedSet.headSet(high));</span><br><span class="line">    System.out.println(sortedSet.tailSet(low));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[eight, five, four, one, seven, six, three, two]</span></span><br><span class="line"><span class="comment">eight</span></span><br><span class="line"><span class="comment">two</span></span><br><span class="line"><span class="comment">one</span></span><br><span class="line"><span class="comment">two</span></span><br><span class="line"><span class="comment">[one, seven, six, three]</span></span><br><span class="line"><span class="comment">[eight, five, four, one, seven, six, three]</span></span><br><span class="line"><span class="comment">[one, seven, six, three, two]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>注意， <strong>SortedSet</strong> 表示“根据对象的比较函数进行排序”，而不是“根据插入顺序”。可以使用 <strong>LinkedHashSet</strong> 保留元素的插入顺序。</p>
<!-- Queues -->
<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>有许多 <strong>Queue</strong> 实现，其中大多数是为并发应用程序设计的。许多实现都是通过排序行为而不是性能来区分的。这是一个涉及大多数 <strong>Queue</strong> 实现的基本示例，包括基于并发的队列。队列将元素从一端放入并从另一端取出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/QueueBehavior.java</span></span><br><span class="line"><span class="comment">// Compares basic behavior</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueBehavior</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> Stream&lt;String&gt; <span class="title">strings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(</span><br><span class="line">      (<span class="string">"one two three four five six seven "</span> +</span><br><span class="line">       <span class="string">"eight nine ten"</span>).split(<span class="string">" "</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> id, Queue&lt;String&gt; queue)</span> </span>&#123;</span><br><span class="line">    System.out.print(id + <span class="string">": "</span>);</span><br><span class="line">    strings().map(queue::offer).count();</span><br><span class="line">    <span class="keyword">while</span>(queue.peek() != <span class="keyword">null</span>)</span><br><span class="line">      System.out.print(queue.remove() + <span class="string">" "</span>);</span><br><span class="line">    System.out.println();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">    test(<span class="number">1</span>, <span class="keyword">new</span> LinkedList&lt;&gt;());</span><br><span class="line">    test(<span class="number">2</span>, <span class="keyword">new</span> PriorityQueue&lt;&gt;());</span><br><span class="line">    test(<span class="number">3</span>, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(count));</span><br><span class="line">    test(<span class="number">4</span>, <span class="keyword">new</span> ConcurrentLinkedQueue&lt;&gt;());</span><br><span class="line">    test(<span class="number">5</span>, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">    test(<span class="number">6</span>, <span class="keyword">new</span> PriorityBlockingQueue&lt;&gt;());</span><br><span class="line">    test(<span class="number">7</span>, <span class="keyword">new</span> ArrayDeque&lt;&gt;());</span><br><span class="line">    test(<span class="number">8</span>, <span class="keyword">new</span> ConcurrentLinkedDeque&lt;&gt;());</span><br><span class="line">    test(<span class="number">9</span>, <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;());</span><br><span class="line">    test(<span class="number">10</span>, <span class="keyword">new</span> LinkedTransferQueue&lt;&gt;());</span><br><span class="line">    test(<span class="number">11</span>, <span class="keyword">new</span> SynchronousQueue&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">1: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">2: eight five four nine one seven six ten three two</span></span><br><span class="line"><span class="comment">3: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">4: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">5: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">6: eight five four nine one seven six ten three two</span></span><br><span class="line"><span class="comment">7: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">8: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">9: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">10: one two three four five six seven eight nine ten</span></span><br><span class="line"><span class="comment">11:</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Deque</strong> 接口也继承自 <strong>Queue</strong> 。 除优先级队列外，<strong>Queue</strong> 按照元素的插入顺序生成元素。 在此示例中，<strong>SynchronousQueue</strong> 不会产生任何结果，因为它是一个阻塞队列，其中每个插入操作必须等待另一个线程执行相应的删除操作，反之亦然。</p>
<!-- Priority Queues -->
<h3 id="优先级队列"><a href="#优先级队列" class="headerlink" title="优先级队列"></a>优先级队列</h3><p>考虑一个待办事项列表，其中每个对象包含一个 <strong>String</strong> 以及主要和次要优先级值。通过实现 <strong>Comparable</strong> 接口来控制此待办事项列表的顺序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/ToDoList.java</span></span><br><span class="line"><span class="comment">// A more complex use of PriorityQueue</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToDoItem</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">ToDoItem</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">char</span> primary;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> secondary;</span><br><span class="line">  <span class="keyword">private</span> String item;</span><br><span class="line">  ToDoItem(String td, <span class="keyword">char</span> pri, <span class="keyword">int</span> sec) &#123;</span><br><span class="line">    primary = pri;</span><br><span class="line">    secondary = sec;</span><br><span class="line">    item = td;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(ToDoItem arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(primary &gt; arg.primary)</span><br><span class="line">      <span class="keyword">return</span> +<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(primary == arg.primary)</span><br><span class="line">      <span class="keyword">if</span>(secondary &gt; arg.secondary)</span><br><span class="line">        <span class="keyword">return</span> +<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(secondary == arg.secondary)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Character.toString(primary) +</span><br><span class="line">      secondary + <span class="string">": "</span> + item;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToDoList</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    PriorityQueue&lt;ToDoItem&gt; toDo =</span><br><span class="line">      <span class="keyword">new</span> PriorityQueue&lt;&gt;();</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Empty trash"</span>, <span class="string">'C'</span>, <span class="number">4</span>));</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Feed dog"</span>, <span class="string">'A'</span>, <span class="number">2</span>));</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Feed bird"</span>, <span class="string">'B'</span>, <span class="number">7</span>));</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Mow lawn"</span>, <span class="string">'C'</span>, <span class="number">3</span>));</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Water lawn"</span>, <span class="string">'A'</span>, <span class="number">1</span>));</span><br><span class="line">    toDo.add(<span class="keyword">new</span> ToDoItem(<span class="string">"Feed cat"</span>, <span class="string">'B'</span>, <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">while</span>(!toDo.isEmpty())</span><br><span class="line">      System.out.println(toDo.remove());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">A1: Water lawn</span></span><br><span class="line"><span class="comment">A2: Feed dog</span></span><br><span class="line"><span class="comment">B1: Feed cat</span></span><br><span class="line"><span class="comment">B7: Feed bird</span></span><br><span class="line"><span class="comment">C3: Mow lawn</span></span><br><span class="line"><span class="comment">C4: Empty trash</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这展示了通过优先级队列自动排序待办事项。</p>
<!-- Deque -->
<h3 id="双端队列"><a href="#双端队列" class="headerlink" title="双端队列"></a>双端队列</h3><p><strong>Deque</strong> （双端队列）就像一个队列，但是可以从任一端添加和删除元素。 Java 6为 <strong>Deque</strong> 添加了一个显式接口。以下是对实现了 <strong>Deque</strong> 的类的最基本的 <strong>Deque</strong> 方法的测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/SimpleDeques.java</span></span><br><span class="line"><span class="comment">// Very basic test of Deques</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountString</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">  CountString() &#123;&#125;</span><br><span class="line">  CountString(<span class="keyword">int</span> start) &#123; n = start; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Integer.toString(n++);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDeques</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Deque&lt;String&gt; deque)</span> </span>&#123;</span><br><span class="line">    CountString s1 = <span class="keyword">new</span> CountString(),</span><br><span class="line">                s2 = <span class="keyword">new</span> CountString(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">8</span>; n++) &#123;</span><br><span class="line">        deque.offerFirst(s1.get());</span><br><span class="line">        deque.offerLast(s2.get()); <span class="comment">// Same as offer()</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(deque);</span><br><span class="line">    String result = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">while</span>(deque.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      System.out.print(deque.peekFirst() + <span class="string">" "</span>);</span><br><span class="line">      result += deque.pollFirst() + <span class="string">" "</span>;</span><br><span class="line">      System.out.print(deque.peekLast() + <span class="string">" "</span>);</span><br><span class="line">      result += deque.pollLast() + <span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"\n"</span> + result);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">    System.out.println(<span class="string">"LinkedList"</span>);</span><br><span class="line">    test(<span class="keyword">new</span> LinkedList&lt;&gt;());</span><br><span class="line">    System.out.println(<span class="string">"ArrayDeque"</span>);</span><br><span class="line">    test(<span class="keyword">new</span> ArrayDeque&lt;&gt;());</span><br><span class="line">    System.out.println(<span class="string">"LinkedBlockingDeque"</span>);</span><br><span class="line">    test(<span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;(count));</span><br><span class="line">    System.out.println(<span class="string">"ConcurrentLinkedDeque"</span>);</span><br><span class="line">    test(<span class="keyword">new</span> ConcurrentLinkedDeque&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">LinkedList</span></span><br><span class="line"><span class="comment">[7, 6, 5, 4, 3, 2, 1, 0, 20, 21, 22, 23, 24, 25, 26,</span></span><br><span class="line"><span class="comment">27]</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">ArrayDeque</span></span><br><span class="line"><span class="comment">[7, 6, 5, 4, 3, 2, 1, 0, 20, 21, 22, 23, 24, 25, 26,</span></span><br><span class="line"><span class="comment">27]</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">LinkedBlockingDeque</span></span><br><span class="line"><span class="comment">[4, 3, 2, 1, 0, 20, 21, 22, 23, 24]</span></span><br><span class="line"><span class="comment">4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">ConcurrentLinkedDeque</span></span><br><span class="line"><span class="comment">[7, 6, 5, 4, 3, 2, 1, 0, 20, 21, 22, 23, 24, 25, 26,</span></span><br><span class="line"><span class="comment">27]</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">7 27 6 26 5 25 4 24 3 23 2 22 1 21 0 20</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>我只使用了 <strong>Deque</strong> 方法的“offer”和“poll”版本，因为当 <strong>LinkedBlockingDeque</strong> 的大小有限时，这些方法不会抛出异常。请注意， <strong>LinkedBlockingDeque</strong> 仅填充到它的限制大小为止，然后忽略额外的添加。</p>
<!-- Understanding Maps -->
<h2 id="理解Map"><a href="#理解Map" class="headerlink" title="理解Map"></a>理解Map</h2><p>正如在<a href>第十二章 集合</a>章节中所了解到的，<strong>Map</strong>（也称为 <em>关联数组</em> ）维护键值关联（对），因此可以使用键来查找值。标准 Java 库包含不同的 <strong>Map</strong> 基本实现，例如 <strong>HashMap</strong> ， <strong>TreeMap</strong> ， <strong>LinkedHashMap</strong> ， <strong>WeakHashMap</strong> ， <strong>ConcurrentHashMap</strong> 和 <strong>IdentityHashMap</strong> 。 它们都具有相同的基本 <strong>Map</strong> 接口，但它们的行为不同，包括效率，键值对的保存顺序和呈现顺序，保存对象的时间，如何在多线程程序中工作，以及如何确定键的相等性。 <strong>Map</strong> 接口的实现数量应该告诉你一些关于此工具重要性的信息。</p>
<p>为了更深入地了解 <strong>Map</strong> ，学习如何构造关联数组会很有帮助。下面是一个非常简单的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/AssociativeArray.java</span></span><br><span class="line"><span class="comment">// Associates keys with values</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssociativeArray</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Object[][] pairs;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AssociativeArray</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    pairs = <span class="keyword">new</span> Object[length][<span class="number">2</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(index &gt;= pairs.length)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException();</span><br><span class="line">    pairs[index++] = <span class="keyword">new</span> Object[]&#123; key, value &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">      <span class="keyword">if</span>(key.equals(pairs[i][<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> (V)pairs[i][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// Did not find key</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">      result.append(pairs[i][<span class="number">0</span>].toString());</span><br><span class="line">      result.append(<span class="string">" : "</span>);</span><br><span class="line">      result.append(pairs[i][<span class="number">1</span>].toString());</span><br><span class="line">      <span class="keyword">if</span>(i &lt; index - <span class="number">1</span>)</span><br><span class="line">        result.append(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result.toString();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    AssociativeArray&lt;String,String&gt; map =</span><br><span class="line">      <span class="keyword">new</span> AssociativeArray&lt;&gt;(<span class="number">6</span>);</span><br><span class="line">    map.put(<span class="string">"sky"</span>, <span class="string">"blue"</span>);</span><br><span class="line">    map.put(<span class="string">"grass"</span>, <span class="string">"green"</span>);</span><br><span class="line">    map.put(<span class="string">"ocean"</span>, <span class="string">"dancing"</span>);</span><br><span class="line">    map.put(<span class="string">"tree"</span>, <span class="string">"tall"</span>);</span><br><span class="line">    map.put(<span class="string">"earth"</span>, <span class="string">"brown"</span>);</span><br><span class="line">    map.put(<span class="string">"sun"</span>, <span class="string">"warm"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      map.put(<span class="string">"extra"</span>, <span class="string">"object"</span>); <span class="comment">// Past the end</span></span><br><span class="line">    &#125; <span class="keyword">catch</span>(ArrayIndexOutOfBoundsException e) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Too many objects!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(map);</span><br><span class="line">    System.out.println(map.get(<span class="string">"ocean"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">Too many objects!</span></span><br><span class="line"><span class="comment">sky : blue</span></span><br><span class="line"><span class="comment">grass : green</span></span><br><span class="line"><span class="comment">ocean : dancing</span></span><br><span class="line"><span class="comment">tree : tall</span></span><br><span class="line"><span class="comment">earth : brown</span></span><br><span class="line"><span class="comment">sun : warm</span></span><br><span class="line"><span class="comment">dancing</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>关联数组中的基本方法是 <code>put()</code> 和 <code>get()</code> ，但为了便于显示，重写了 <code>toString()</code> 方法以打印键值对。为了显示它的工作原理，主方法加载一个带有字符串对的 <strong>AssociativeArray</strong> 并打印生成的映射，然后调用其中一个值的 <code>get()</code> 方法。</p>
<p>要使用 <code>get()</code> 方法，可以传入要查找的 <strong>key</strong> ，它将生成相关联的值作为结果，如果找不到则返回 <strong>null</strong> 。 <code>get()</code> 方法使用可能是效率最低的方法来定位值：从数组的头部开始并使用 <code>equals()</code> 来比较键。但这里是侧重于简单，而不是效率。</p>
<p>这个版本很有启发性，但它不是很有效，而且它只有一个固定的大小，这是不灵活的。幸运的是， <strong>java.util</strong> 中的那些 <strong>Map</strong> 没有这些问题。</p>
<!-- Performance -->
<h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><p>性能是 <strong>Map</strong> 的基本问题，在 <code>get()</code> 中使用线性方法搜索一个键时会非常慢。这就是 <strong>HashMap</strong> 要加速的地方。它使用一个称为 <em>哈希码</em> 的特殊值来替代慢速搜索一个键。哈希码是一种从相关对象中获取一些信息并将其转换为该对象的“相对唯一” <strong>int</strong> 的方法。 <code>hashCode()</code> 是根类 <strong>Object</strong> 中的一个方法，因此所有 Java 对象都可以生成哈希码。 <strong>HashMap</strong> 获取对象的 <code>hashCode()</code> 并使用它来快速搜索键。这就使得性能有了显著的提升。[^3]</p>
<p>以下是基本的 <strong>Map</strong> 实现。 <strong>HashMap</strong>上的星号表示，在没有其他约束的情况下，这应该是你的默认选择，因为它针对速度进行了优化。其他实现强调其他特性，因此不如 <strong>HashMap</strong> 快。</p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>Map</strong> 实现</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>HashMap*</strong></td>
<td style="text-align:left">基于哈希表的实现。（使用此类来代替 <strong>Hashtable</strong> 。）为插入和定位键值对提供了常数时间性能。可以通过构造方法调整性能，这些构造方法允许你设置哈希表的容量和装填因子。</td>
</tr>
<tr>
<td style="text-align:center"><strong>LinkedHashMap</strong></td>
<td style="text-align:left">与 <strong>HashMap</strong> 类似，但是当遍历时，可以按插入顺序或最近最少使用（LRU）顺序获取键值对。只比 <strong>HashMap</strong> 略慢，一个例外是在迭代时，由于其使用链表维护内部顺序，所以会更快些。</td>
</tr>
<tr>
<td style="text-align:center"><strong>TreeMap</strong></td>
<td style="text-align:left">基于红黑树的实现。当查看键或键值对时，它们按排序顺序（由 <strong>Comparable</strong> 或 <strong>Comparator</strong> 确定）。 <strong>TreeMap</strong> 的侧重点是按排序顺序获得结果。 <strong>TreeMap</strong> 是唯一使用 <code>subMap()</code> 方法的 <strong>Map</strong> ，它返回红黑树的一部分。</td>
</tr>
<tr>
<td style="text-align:center"><strong>WeakHashMap</strong></td>
<td style="text-align:left">一种具有 <em>弱键</em>（weak keys） 的 <strong>Map</strong> ，为了解决某些类型的问题，它允许释放 <strong>Map</strong> 所引用的对象。如果在 <strong>Map</strong> 外没有对特定键的引用，则可以对该键进行垃圾回收。</td>
</tr>
<tr>
<td style="text-align:center"><strong>ConcurrentHashMap</strong></td>
<td style="text-align:left">不使用同步锁定的线程安全 <strong>Mao</strong> 。这在<a href>第二十四章 并发编程</a> 一章中讨论。</td>
</tr>
<tr>
<td style="text-align:center"><strong>IdentityHashMap</strong></td>
<td style="text-align:left">使用 <code>==</code> 而不是 <code>equals()</code> 来比较键。仅用于解决特殊问题，不适用于一般用途。</td>
</tr>
</tbody>
</table>
<p>散列是在 <strong>Map</strong> 中存储元素的最常用方法。</p>
<p><strong>Map</strong> 中使用的键的要求与 <strong>Set</strong> 中的元素的要求相同。可以在 <strong>TypesForSets.java</strong> 中看到这些。任何键必须具有 <code>equals()</code> 方法。如果键用于散列映射，则它还必须具有正确的 <code>hashCode()</code> 方法。如果键在 <strong>TreeMap</strong> 中使用，则必须实现 <strong>Comparable</strong> 接口。</p>
<p>以下示例使用先前定义的 <strong>CountMap</strong> 测试数据集显示通过 <strong>Map</strong> 接口可用的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/MapOps.java</span></span><br><span class="line"><span class="comment">// Things you can do with Maps</span></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapOps</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">printKeys</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"Size = "</span> + map.size() + <span class="string">", "</span>);</span><br><span class="line">    System.out.print(<span class="string">"Keys: "</span>);</span><br><span class="line">    <span class="comment">// Produce a Set of the keys:</span></span><br><span class="line">    System.out.println(map.keySet());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">    System.out.println(</span><br><span class="line">      map.getClass().getSimpleName());</span><br><span class="line">    map.putAll(<span class="keyword">new</span> CountMap(<span class="number">25</span>));</span><br><span class="line">    <span class="comment">// Map has 'Set' behavior for keys:</span></span><br><span class="line">    map.putAll(<span class="keyword">new</span> CountMap(<span class="number">25</span>));</span><br><span class="line">    printKeys(map);</span><br><span class="line">    <span class="comment">// Producing a Collection of the values:</span></span><br><span class="line">    System.out.print(<span class="string">"Values: "</span>);</span><br><span class="line">    System.out.println(map.values());</span><br><span class="line">    System.out.println(map);</span><br><span class="line">    System.out.println(<span class="string">"map.containsKey(11): "</span> +</span><br><span class="line">      map.containsKey(<span class="number">11</span>));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"map.get(11): "</span> + map.get(<span class="number">11</span>));</span><br><span class="line">    System.out.println(<span class="string">"map.containsValue(\"F0\"): "</span></span><br><span class="line">      + map.containsValue(<span class="string">"F0"</span>));</span><br><span class="line">    Integer key = map.keySet().iterator().next();</span><br><span class="line">    System.out.println(<span class="string">"First key in map: "</span> + key);</span><br><span class="line">    map.remove(key);</span><br><span class="line">    printKeys(map);</span><br><span class="line">    map.clear();</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">    map.putAll(<span class="keyword">new</span> CountMap(<span class="number">25</span>));</span><br><span class="line">    <span class="comment">// Operations on the Set change the Map:</span></span><br><span class="line">    map.keySet().removeAll(map.keySet());</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    test(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">    test(<span class="keyword">new</span> TreeMap&lt;&gt;());</span><br><span class="line">    test(<span class="keyword">new</span> LinkedHashMap&lt;&gt;());</span><br><span class="line">    test(<span class="keyword">new</span> IdentityHashMap&lt;&gt;());</span><br><span class="line">    test(<span class="keyword">new</span> ConcurrentHashMap&lt;&gt;());</span><br><span class="line">    test(<span class="keyword">new</span> WeakHashMap&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output: (First 11 Lines)</span></span><br><span class="line"><span class="comment">HashMap</span></span><br><span class="line"><span class="comment">Size = 25, Keys: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,</span></span><br><span class="line"><span class="comment">12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]</span></span><br><span class="line"><span class="comment">Values: [A0, B0, C0, D0, E0, F0, G0, H0, I0, J0, K0,</span></span><br><span class="line"><span class="comment">L0, M0, N0, O0, P0, Q0, R0, S0, T0, U0, V0, W0, X0, Y0]</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0,</span></span><br><span class="line"><span class="comment">9=J0, 10=K0, 11=L0, 12=M0, 13=N0, 14=O0, 15=P0, 16=Q0,</span></span><br><span class="line"><span class="comment">17=R0, 18=S0, 19=T0, 20=U0, 21=V0, 22=W0, 23=X0, 24=Y0&#125;</span></span><br><span class="line"><span class="comment">map.containsKey(11): true</span></span><br><span class="line"><span class="comment">map.get(11): L0</span></span><br><span class="line"><span class="comment">map.containsValue("F0"): true</span></span><br><span class="line"><span class="comment">First key in map: 0</span></span><br><span class="line"><span class="comment">Size = 24, Keys: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,</span></span><br><span class="line"><span class="comment">12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]</span></span><br><span class="line"><span class="comment">map.isEmpty(): true</span></span><br><span class="line"><span class="comment">map.isEmpty(): true</span></span><br><span class="line"><span class="comment">                  ...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><code>printKeys()</code> 方法演示了如何生成 <strong>Map</strong> 的 <strong>Collection</strong> 视图。 <code>keySet()</code> 方法生成一个由 <strong>Map</strong> 中的键组成的 <strong>Set</strong> 。 打印 <code>values()</code> 方法的结果会生成一个包含 <strong>Map</strong> 中所有值的 <strong>Collection</strong> 。（请注意，键必须是唯一的，但值可以包含重复项。）由于这些 <strong>Collection</strong> 由 <strong>Map</strong> 支持，因此 <strong>Collection</strong> 中的任何更改都会反映在所关联的 <strong>Map</strong> 中。</p>
<p>程序的其余部分提供了每个 <strong>Map</strong> 操作的简单示例，并测试了每种基本类型的 <strong>Map</strong> 。</p>
<!-- SortedMap -->
<h3 id="SortedMap"><a href="#SortedMap" class="headerlink" title="SortedMap"></a>SortedMap</h3><p>使用 <strong>SortedMap</strong> （由 <strong>TreeMap</strong> 或 <strong>ConcurrentSkipListMap</strong> 实现），键保证按排序顺序，这允许在 <strong>SortedMap</strong> 接口中使用这些方法来提供其他功能：</p>
<ul>
<li><code>Comparator comparator()</code> ：生成用于此 <strong>Map</strong> 的比较器， <strong>null</strong> 表示自然排序。</li>
<li><code>T firstKey()</code> ：返回第一个键。</li>
<li><code>T lastKey()</code> ：返回最后一个键。</li>
<li><code>SortedMap subMap(fromKey，toKey)</code> ：生成此 <strong>Map</strong> 的视图，其中键从 <strong>fromKey</strong>（包括），到 <strong>toKey</strong> （不包括）。</li>
<li><code>SortedMap headMap(toKey)</code> ：使用小于 <strong>toKey</strong> 的键生成此 <strong>Map</strong> 的视图。</li>
<li><code>SortedMap tailMap(fromKey)</code> ：使用大于或等于 <strong>fromKey</strong> 的键生成此 <strong>Map</strong> 的视图。</li>
</ul>
<p>这是一个类似于 <strong>SortedSetDemo.java</strong> 的示例，显示了 <strong>TreeMap</strong> 的这种额外行为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/SortedMapDemo.java</span></span><br><span class="line"><span class="comment">// What you can do with a TreeMap</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortedMapDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    TreeMap&lt;Integer,String&gt; sortedMap =</span><br><span class="line">      <span class="keyword">new</span> TreeMap&lt;&gt;(<span class="keyword">new</span> CountMap(<span class="number">10</span>));</span><br><span class="line">    System.out.println(sortedMap);</span><br><span class="line">    Integer low = sortedMap.firstKey();</span><br><span class="line">    Integer high = sortedMap.lastKey();</span><br><span class="line">    System.out.println(low);</span><br><span class="line">    System.out.println(high);</span><br><span class="line">    Iterator&lt;Integer&gt; it =</span><br><span class="line">      sortedMap.keySet().iterator();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span>(i == <span class="number">3</span>) low = it.next();</span><br><span class="line">      <span class="keyword">if</span>(i == <span class="number">6</span>) high = it.next();</span><br><span class="line">      <span class="keyword">else</span> it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(low);</span><br><span class="line">    System.out.println(high);</span><br><span class="line">    System.out.println(sortedMap.subMap(low, high));</span><br><span class="line">    System.out.println(sortedMap.headMap(high));</span><br><span class="line">    System.out.println(sortedMap.tailMap(low));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0,</span></span><br><span class="line"><span class="comment">9=J0&#125;</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">9</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">&#123;3=D0, 4=E0, 5=F0, 6=G0&#125;</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0&#125;</span></span><br><span class="line"><span class="comment">&#123;3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0, 9=J0&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这里，键值对按照键的排序顺序进行排序。因为 <strong>TreeMap</strong> 中存在顺序感，所以“位置”的概念很有意义，因此可以拥有第一个、最后一个元素或子图。</p>
<!-- LinkedHashMap -->
<h3 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h3><p><strong>LinkedHashMap</strong> 针对速度进行哈希处理，但在遍历期间也会按插入顺序生成键值对（ <code>System.out.println()</code> 可以遍历它，因此可以看到遍历的结果）。 此外，可以在构造方法中配置 <strong>LinkedHashMap</strong> 以使用基于访问的 <em>最近最少使用</em>（LRU） 算法，因此未访问的元素（因此是删除的候选者）会出现在列表的前面。 这样可以轻松创建一个能够定期清理以节省空间的程序。下面是一个显示这两个功能的简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/LinkedHashMapDemo.java</span></span><br><span class="line"><span class="comment">// What you can do with a LinkedHashMap</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMapDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LinkedHashMap&lt;Integer,String&gt; linkedMap =</span><br><span class="line">      <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="keyword">new</span> CountMap(<span class="number">9</span>));</span><br><span class="line">    System.out.println(linkedMap);</span><br><span class="line">    <span class="comment">// Least-recently-used order:</span></span><br><span class="line">    linkedMap =</span><br><span class="line">      <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">16</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    linkedMap.putAll(<span class="keyword">new</span> CountMap(<span class="number">9</span>));</span><br><span class="line">    System.out.println(linkedMap);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">      linkedMap.get(i);</span><br><span class="line">    System.out.println(linkedMap);</span><br><span class="line">    linkedMap.get(<span class="number">0</span>);</span><br><span class="line">    System.out.println(linkedMap);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0&#125;</span></span><br><span class="line"><span class="comment">&#123;0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 6=G0, 7=H0, 8=I0&#125;</span></span><br><span class="line"><span class="comment">&#123;6=G0, 7=H0, 8=I0, 0=A0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0&#125;</span></span><br><span class="line"><span class="comment">&#123;6=G0, 7=H0, 8=I0, 1=B0, 2=C0, 3=D0, 4=E0, 5=F0, 0=A0&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>这些键值对确实是按照插入顺序进行遍历，即使对于LRU版本也是如此。 但是，在LRU版本中访问前六项（仅限）后，最后三项将移至列表的前面。然后，当再次访问“ <strong>0</strong> ”后，它移动到了列表的后面。</p>
<!-- Utilities -->
<h2 id="集合工具类"><a href="#集合工具类" class="headerlink" title="集合工具类"></a>集合工具类</h2><p>集合有许多独立的实用工具程序，在 <strong>java.util.Collections</strong> 中表示为静态方法。之前已经见过其中一些，例如 <code>addAll()</code> ， <code>reverseOrder()</code> 和 <code>binarySearch()</code> 。以下是其他内容（同步和不可修改的实用工具程序将在后面的章节中介绍）。在此表中，在需要的时候使用了泛型：</p>
<table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>checkedCollection(Collection\<t> c, Class\<t> type)</t></t></strong> <br><br> <strong>checkedList(List\<t> list, Class\<t> type)</t></t></strong> <br><br> <strong>checkedMap(Map\&lt;K, V&gt; m, Class\<k> keyType, Class\<v> valueType)</v></k></strong> <br><br> <strong>checkedSet(Set\<t> s, Class\<t> type)</t></t></strong> <br><br> <strong>checkedSortedMap(SortedMap\&lt;K, V&gt; m, Class\<k> keyType, Class\<v> valueType)</v></k></strong> <br><br> <strong>checkedSortedSet(SortedSet\<t> s, Class\<t> type)</t></t></strong></td>
<td style="text-align:left">生成 <strong>Collection</strong> 的动态类型安全视图或 <strong>Collection</strong> 的特定子类型。 当无法使用静态检查版本时使用这个版本。 <br><br> 这些方法的使用在<a href>第九章 多态</a>章节的“动态类型安全”标题下进行了展示。</td>
</tr>
<tr>
<td style="text-align:left"><strong>max(Collection)</strong> <br><br> <strong>min(Collection)</strong></td>
<td style="text-align:left">使用 <strong>Collection</strong> 中对象的自然比较方法生成参数集合中的最大或最小元素。</td>
</tr>
<tr>
<td style="text-align:left"><strong>max(Collection, Comparator)</strong> <br><br> <strong>min(Collection, Comparator)</strong></td>
<td style="text-align:left">使用 <strong>Comparator</strong> 指定的比较方法生成参数集合中的最大或最小元素。</td>
</tr>
<tr>
<td style="text-align:left"><strong>indexOfSubList(List source, List target)</strong></td>
<td style="text-align:left">返回 <strong>target</strong> 在 <strong>source</strong> 内第一次出现的起始索引，如果不存在则返回 -1。</td>
</tr>
<tr>
<td style="text-align:left"><strong>lastIndexOfSubList(List source, List target)</strong></td>
<td style="text-align:left">返回 <strong>target</strong> 在 <strong>source</strong> 内最后一次出现的起始索引，如果不存在则返回 -1。</td>
</tr>
<tr>
<td style="text-align:left"><strong>replaceAll(List\<t> list, T oldVal, T newVal)</t></strong></td>
<td style="text-align:left">用 <strong>newVal</strong> 替换列表中所有的 <strong>oldVal</strong> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>reverse(List)</strong></td>
<td style="text-align:left">反转列表</td>
</tr>
<tr>
<td style="text-align:left"><strong>reverseOrder()</strong> <br><br> <strong>reverseOrder(Comparator\<t>)</t></strong></td>
<td style="text-align:left">返回一个 <strong>Comparator</strong> ，它与集合中实现了 <strong>comparable\<t></t></strong> 接口的对象的自然顺序相反。第二个版本颠倒了所提供的 <strong>Comparator</strong> 的顺序。</td>
</tr>
<tr>
<td style="text-align:left"><strong>rotate(List, int distance)</strong></td>
<td style="text-align:left">将所有元素向前移动 <strong>distance</strong> ，将尾部的元素移到开头。（译者注：即循环移动）</td>
</tr>
<tr>
<td style="text-align:left"><strong>shuffle(List)</strong> <br><br> <strong>shuffle(List, Random)</strong></td>
<td style="text-align:left">随机置换指定列表（即打乱顺序）。第一个版本使用了默认的随机化源，或者也可以使用第二个版本，提供自己的随机化源。</td>
</tr>
<tr>
<td style="text-align:left"><strong>sort(List\<t>)</t></strong> <br><br> <strong>sort(List\<t>, Comparator\&lt;? super T&gt; c)</t></strong></td>
<td style="text-align:left">第一个版本使用元素的自然顺序排序该 <strong>List\<t></t></strong> 。第二个版本根据提供的 <strong>Comparator</strong> 排序。</td>
</tr>
<tr>
<td style="text-align:left"><strong>copy(List\&lt;? super T&gt; dest, List\&lt;? extends T&gt; src)</strong></td>
<td style="text-align:left">将 <strong>src</strong> 中的元素复制到 <strong>dest</strong> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>swap(List, int i, int j)</strong></td>
<td style="text-align:left">交换 <strong>List</strong> 中位置 <strong>i</strong> 和 位置 <strong>j</strong> 的元素。可能比你手工编写的速度快。</td>
</tr>
<tr>
<td style="text-align:left"><strong>fill(List\&lt;? super T&gt;, T x)</strong></td>
<td style="text-align:left">用 <strong>x</strong> 替换 <strong>List</strong> 中的所有元素。</td>
</tr>
<tr>
<td style="text-align:left"><strong>nCopies(int n, T x)</strong></td>
<td style="text-align:left">返回大小为 <strong>n</strong> 的不可变 <strong>List\<t></t></strong> ，其引用都指向 <strong>x</strong> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>disjoint(Collection, Collection)</strong></td>
<td style="text-align:left">如果两个集合没有共同元素，则返回 <strong>true</strong> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>frequency(Collection, Object x)</strong></td>
<td style="text-align:left">返回 <strong>Collection</strong> 中，等于 <strong>x</strong> 的元素个数。</td>
</tr>
<tr>
<td style="text-align:left"><strong>emptyList()</strong> <br><br> <strong>emptyMap()</strong> <br><br> <strong>emptySet()</strong></td>
<td style="text-align:left">返回不可变的空 <strong>List</strong> ， <strong>Map</strong> 或 <strong>Set</strong> 。这些是泛型的，因此生成的 <strong>Collection</strong> 可以被参数化为所需的类型。</td>
</tr>
<tr>
<td style="text-align:left"><strong>singleton(T x)</strong> <br><br> <strong>singletonList(T x)</strong> <br><br> <strong>singletonMap(K key, V value)</strong></td>
<td style="text-align:left">生成一个不可变的 <strong>List</strong> ， <strong>Set</strong> 或 <strong>Map</strong> ，其中只包含基于给定参数的单个元素。</td>
</tr>
<tr>
<td style="text-align:left"><strong>list(Enumeration\<t> e)</t></strong></td>
<td style="text-align:left">生成一个 <strong>ArrayList\<t></t></strong> ，其中元素为（旧式） <strong>Enumeration</strong> （ <strong>Iterator</strong> 的前身）中的元素。用于从遗留代码向新式转换。</td>
</tr>
<tr>
<td style="text-align:left"><strong>enumeration(Collection\<t>)</t></strong></td>
<td style="text-align:left">为参数集合生成一个旧式的 <strong>Enumeration\<t></t></strong> 。</td>
</tr>
</tbody>
</table>
<p>请注意， <code>min（)</code> 和 <code>max()</code> 使用 <strong>Collection</strong> 对象，而不使用 <strong>List</strong> ，因此不必担心是否应对 <strong>Collection</strong> 进行排序。（如前所述，在执行 <code>binarySearch()</code> 之前，将会对 <strong>List</strong> 或数组进行<code>sort()</code> 排序。）</p>
<p>下面是一个示例，展示了上表中大多数实用工具程序的基本用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Utilities.java</span></span><br><span class="line"><span class="comment">// Simple demonstrations of the Collections utilities</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utilities</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> List&lt;String&gt; list = Arrays.asList(</span><br><span class="line">    <span class="string">"one Two three Four five six one"</span>.split(<span class="string">" "</span>));</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    System.out.println(<span class="string">"'list' disjoint (Four)?: "</span> +</span><br><span class="line">      Collections.disjoint(list,</span><br><span class="line">        Collections.singletonList(<span class="string">"Four"</span>)));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"max: "</span> + Collections.max(list));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"min: "</span> + Collections.min(list));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"max w/ comparator: "</span> + Collections.max(list,</span><br><span class="line">      String.CASE_INSENSITIVE_ORDER));</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"min w/ comparator: "</span> + Collections.min(list,</span><br><span class="line">      String.CASE_INSENSITIVE_ORDER));</span><br><span class="line">    List&lt;String&gt; sublist =</span><br><span class="line">      Arrays.asList(<span class="string">"Four five six"</span>.split(<span class="string">" "</span>));</span><br><span class="line">    System.out.println(<span class="string">"indexOfSubList: "</span> +</span><br><span class="line">      Collections.indexOfSubList(list, sublist));</span><br><span class="line">    System.out.println(<span class="string">"lastIndexOfSubList: "</span> +</span><br><span class="line">      Collections.lastIndexOfSubList(list, sublist));</span><br><span class="line">    Collections.replaceAll(list, <span class="string">"one"</span>, <span class="string">"Yo"</span>);</span><br><span class="line">    System.out.println(<span class="string">"replaceAll: "</span> + list);</span><br><span class="line">    Collections.reverse(list);</span><br><span class="line">    System.out.println(<span class="string">"reverse: "</span> + list);</span><br><span class="line">    Collections.rotate(list, <span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">"rotate: "</span> + list);</span><br><span class="line">    List&lt;String&gt; source =</span><br><span class="line">      Arrays.asList(<span class="string">"in the matrix"</span>.split(<span class="string">" "</span>));</span><br><span class="line">    Collections.copy(list, source);</span><br><span class="line">    System.out.println(<span class="string">"copy: "</span> + list);</span><br><span class="line">    Collections.swap(list, <span class="number">0</span>, list.size() - <span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">"swap: "</span> + list);</span><br><span class="line">    Collections.shuffle(list, <span class="keyword">new</span> Random(<span class="number">47</span>));</span><br><span class="line">    System.out.println(<span class="string">"shuffled: "</span> + list);</span><br><span class="line">    Collections.fill(list, <span class="string">"pop"</span>);</span><br><span class="line">    System.out.println(<span class="string">"fill: "</span> + list);</span><br><span class="line">    System.out.println(<span class="string">"frequency of 'pop': "</span> +</span><br><span class="line">      Collections.frequency(list, <span class="string">"pop"</span>));</span><br><span class="line">    List&lt;String&gt; dups =</span><br><span class="line">      Collections.nCopies(<span class="number">3</span>, <span class="string">"snap"</span>);</span><br><span class="line">    System.out.println(<span class="string">"dups: "</span> + dups);</span><br><span class="line">    System.out.println(<span class="string">"'list' disjoint 'dups'?: "</span> +</span><br><span class="line">      Collections.disjoint(list, dups));</span><br><span class="line">    <span class="comment">// Getting an old-style Enumeration:</span></span><br><span class="line">    Enumeration&lt;String&gt; e =</span><br><span class="line">      Collections.enumeration(dups);</span><br><span class="line">    Vector&lt;String&gt; v = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(e.hasMoreElements())</span><br><span class="line">      v.addElement(e.nextElement());</span><br><span class="line">    <span class="comment">// Converting an old-style Vector</span></span><br><span class="line">    <span class="comment">// to a List via an Enumeration:</span></span><br><span class="line">    ArrayList&lt;String&gt; arrayList =</span><br><span class="line">      Collections.list(v.elements());</span><br><span class="line">    System.out.println(<span class="string">"arrayList: "</span> + arrayList);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[one, Two, three, Four, five, six, one]</span></span><br><span class="line"><span class="comment">'list' disjoint (Four)?: false</span></span><br><span class="line"><span class="comment">max: three</span></span><br><span class="line"><span class="comment">min: Four</span></span><br><span class="line"><span class="comment">max w/ comparator: Two</span></span><br><span class="line"><span class="comment">min w/ comparator: five</span></span><br><span class="line"><span class="comment">indexOfSubList: 3</span></span><br><span class="line"><span class="comment">lastIndexOfSubList: 3</span></span><br><span class="line"><span class="comment">replaceAll: [Yo, Two, three, Four, five, six, Yo]</span></span><br><span class="line"><span class="comment">reverse: [Yo, six, five, Four, three, Two, Yo]</span></span><br><span class="line"><span class="comment">rotate: [three, Two, Yo, Yo, six, five, Four]</span></span><br><span class="line"><span class="comment">copy: [in, the, matrix, Yo, six, five, Four]</span></span><br><span class="line"><span class="comment">swap: [Four, the, matrix, Yo, six, five, in]</span></span><br><span class="line"><span class="comment">shuffled: [six, matrix, the, Four, Yo, five, in]</span></span><br><span class="line"><span class="comment">fill: [pop, pop, pop, pop, pop, pop, pop]</span></span><br><span class="line"><span class="comment">frequency of 'pop': 7</span></span><br><span class="line"><span class="comment">dups: [snap, snap, snap]</span></span><br><span class="line"><span class="comment">'list' disjoint 'dups'?: true</span></span><br><span class="line"><span class="comment">arrayList: [snap, snap, snap]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>输出解释了每种实用方法的行为。请注意由于大小写的缘故，普通版本的 <code>min()</code> 和 <code>max()</code> 与带有 <strong>String.CASE_INSENSITIVE_ORDER</strong> 比较器参数的版本的区别。</p>
<!-- Sorting and Searching Lists -->
<h3 id="排序和搜索列表"><a href="#排序和搜索列表" class="headerlink" title="排序和搜索列表"></a>排序和搜索列表</h3><p>用于执行排序和搜索 <strong>List</strong> 的实用工具程序与用于排序对象数组的程序具有相同的名字和方法签名，只不过是 <strong>Collections</strong> 的静态方法而不是 <strong>Arrays</strong> 。 这是一个使用 <strong>Utilities.java</strong> 中的 <strong>list</strong> 数据的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/ListSortSearch.java</span></span><br><span class="line"><span class="comment">// Sorting/searching Lists with Collections utilities</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListSortSearch</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list =</span><br><span class="line">      <span class="keyword">new</span> ArrayList&lt;&gt;(Utilities.list);</span><br><span class="line">    list.addAll(Utilities.list);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    Collections.shuffle(list, <span class="keyword">new</span> Random(<span class="number">47</span>));</span><br><span class="line">    System.out.println(<span class="string">"Shuffled: "</span> + list);</span><br><span class="line">    <span class="comment">// Use ListIterator to trim off last elements:</span></span><br><span class="line">    ListIterator&lt;String&gt; it = list.listIterator(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">      it.next();</span><br><span class="line">      it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"Trimmed: "</span> + list);</span><br><span class="line">    Collections.sort(list);</span><br><span class="line">    System.out.println(<span class="string">"Sorted: "</span> + list);</span><br><span class="line">    String key = list.get(<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">int</span> index = Collections.binarySearch(list, key);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"Location of "</span> + key + <span class="string">" is "</span> + index +</span><br><span class="line">      <span class="string">", list.get("</span> + index + <span class="string">") = "</span> +</span><br><span class="line">      list.get(index));</span><br><span class="line">    Collections.sort(list,</span><br><span class="line">      String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"Case-insensitive sorted: "</span> + list);</span><br><span class="line">    key = list.get(<span class="number">7</span>);</span><br><span class="line">    index = Collections.binarySearch(list, key,</span><br><span class="line">      String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"Location of "</span> + key + <span class="string">" is "</span> + index +</span><br><span class="line">      <span class="string">", list.get("</span> + index + <span class="string">") = "</span> +</span><br><span class="line">      list.get(index));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[one, Two, three, Four, five, six, one, one, Two,</span></span><br><span class="line"><span class="comment">three, Four, five, six, one]</span></span><br><span class="line"><span class="comment">Shuffled: [Four, five, one, one, Two, six, six, three,</span></span><br><span class="line"><span class="comment">three, five, Four, Two, one, one]</span></span><br><span class="line"><span class="comment">Trimmed: [Four, five, one, one, Two, six, six, three,</span></span><br><span class="line"><span class="comment">three, five]</span></span><br><span class="line"><span class="comment">Sorted: [Four, Two, five, five, one, one, six, six,</span></span><br><span class="line"><span class="comment">three, three]</span></span><br><span class="line"><span class="comment">Location of six is 7, list.get(7) = six</span></span><br><span class="line"><span class="comment">Case-insensitive sorted: [five, five, Four, one, one,</span></span><br><span class="line"><span class="comment">six, six, three, three, Two]</span></span><br><span class="line"><span class="comment">Location of three is 7, list.get(7) = three</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>就像使用数组进行搜索和排序一样，如果使用 <strong>Comparator</strong> 进行排序，则必须使用相同的 <strong>Comparator</strong> 执行 <code>binarySearch()</code> 。</p>
<p>该程序还演示了 <strong>Collections</strong> 中的 <code>shuffle()</code> 方法，该方法随机打乱了 <strong>List</strong> 的顺序。 <strong>ListIterator</strong> 是在打乱后的列表中的特定位置创建的，用于从该位置删除元素，直到列表末尾。</p>
<!-- Making a Collection or Map Unmodifiable -->
<h3 id="创建不可修改的-Collection-或-Map"><a href="#创建不可修改的-Collection-或-Map" class="headerlink" title="创建不可修改的 Collection 或 Map"></a>创建不可修改的 Collection 或 Map</h3><p>通常，创建 <strong>Collection</strong> 或 <strong>Map</strong> 的只读版本会很方便。 <strong>Collections</strong> 类通过将原始集合传递给一个方法然后返回一个只读版本的集合。 对于 <strong>Collection</strong> （如果不能将 <strong>Collection</strong> 视为更具体的类型）， <strong>List</strong> ， <strong>Set</strong> 和 <strong>Map</strong> ，这类方法有许多变体。这个示例展示了针对每种类型，正确构建只读版本集合的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/ReadOnly.java</span></span><br><span class="line"><span class="comment">// Using the Collections.unmodifiable methods</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadOnly</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Collection&lt;String&gt; data =</span><br><span class="line">    <span class="keyword">new</span> ArrayList&lt;&gt;(Countries.names(<span class="number">6</span>));</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection&lt;String&gt; c =</span><br><span class="line">      Collections.unmodifiableCollection(</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;(data));</span><br><span class="line">    System.out.println(c); <span class="comment">// Reading is OK</span></span><br><span class="line">    <span class="comment">//- c.add("one"); // Can't change it</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; a = Collections.unmodifiableList(</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;(data));</span><br><span class="line">    ListIterator&lt;String&gt; lit = a.listIterator();</span><br><span class="line">    System.out.println(lit.next()); <span class="comment">// Reading is OK</span></span><br><span class="line">    <span class="comment">//- lit.add("one"); // Can't change it</span></span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; s = Collections.unmodifiableSet(</span><br><span class="line">      <span class="keyword">new</span> HashSet&lt;&gt;(data));</span><br><span class="line">    System.out.println(s); <span class="comment">// Reading is OK</span></span><br><span class="line">    <span class="comment">//- s.add("one"); // Can't change it</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For a SortedSet:</span></span><br><span class="line">    Set&lt;String&gt; ss =</span><br><span class="line">      Collections.unmodifiableSortedSet(</span><br><span class="line">        <span class="keyword">new</span> TreeSet&lt;&gt;(data));</span><br><span class="line"></span><br><span class="line">    Map&lt;String,String&gt; m =</span><br><span class="line">      Collections.unmodifiableMap(</span><br><span class="line">        <span class="keyword">new</span> HashMap&lt;&gt;(Countries.capitals(<span class="number">6</span>)));</span><br><span class="line">    System.out.println(m); <span class="comment">// Reading is OK</span></span><br><span class="line">    <span class="comment">//- m.put("Ralph", "Howdy!");</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For a SortedMap:</span></span><br><span class="line">    Map&lt;String,String&gt; sm =</span><br><span class="line">      Collections.unmodifiableSortedMap(</span><br><span class="line">        <span class="keyword">new</span> TreeMap&lt;&gt;(Countries.capitals(<span class="number">6</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">[ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">ALGERIA</span></span><br><span class="line"><span class="comment">[BENIN, BOTSWANA, ANGOLA, BURKINA FASO, ALGERIA,</span></span><br><span class="line"><span class="comment">BURUNDI]</span></span><br><span class="line"><span class="comment">&#123;BENIN=Porto-Novo, BOTSWANA=Gaberone, ANGOLA=Luanda,</span></span><br><span class="line"><span class="comment">BURKINA FASO=Ouagadougou, ALGERIA=Algiers,</span></span><br><span class="line"><span class="comment">BURUNDI=Bujumbura&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>为特定类型调用 “unmodifiable” 方法不会导致编译时检查，但是一旦发生转换，对修改特定集合内容的任何方法调用都将产生 <strong>UnsupportedOperationException</strong> 异常。</p>
<p>在每种情况下，在将集合设置为只读之前，必须使用有意义的数据填充集合。填充完成后，最好的方法是用 “unmodifiable” 方法调用生成的引用替换现有引用。这样，一旦使得内容无法修改，那么就不会冒有意外更改内容的风险。另一方面，此工具还允许将可修改的集合保留为类中的<strong>私有</strong>集合，并从方法调用处返回对该集合的只读引用。所以，你可以在类内修改它，但其他人只能读它。</p>
<!-- Synchronizing a Collection or Map -->
<h3 id="同步-Collection-或-Map"><a href="#同步-Collection-或-Map" class="headerlink" title="同步 Collection 或 Map"></a>同步 Collection 或 Map</h3><p><strong>synchronized</strong> 关键字是多线程主题的重要组成部分，更复杂的内容在<a href>第二十四章 并发编程</a>中介绍。在这里，只需要注意到 <strong>Collections</strong> 类包含一种自动同步整个集合的方法。 语法类似于 “unmodifiable” 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Synchronization.java</span></span><br><span class="line"><span class="comment">// Using the Collections.synchronized methods</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Synchronization</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection&lt;String&gt; c =</span><br><span class="line">      Collections.synchronizedCollection(</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    List&lt;String&gt; list = Collections</span><br><span class="line">      .synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    Set&lt;String&gt; s = Collections</span><br><span class="line">      .synchronizedSet(<span class="keyword">new</span> HashSet&lt;&gt;());</span><br><span class="line">    Set&lt;String&gt; ss = Collections</span><br><span class="line">      .synchronizedSortedSet(<span class="keyword">new</span> TreeSet&lt;&gt;());</span><br><span class="line">    Map&lt;String,String&gt; m = Collections</span><br><span class="line">      .synchronizedMap(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">    Map&lt;String,String&gt; sm = Collections</span><br><span class="line">      .synchronizedSortedMap(<span class="keyword">new</span> TreeMap&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最好立即通过适当的 “synchronized” 方法传递新集合，如上所示。这样，就不会意外地暴露出非同步版本。</p>
<!-- Fail Fast -->
<h4 id="Fail-Fast"><a href="#Fail-Fast" class="headerlink" title="Fail Fast"></a>Fail Fast</h4><p>Java 集合还具有防止多个进程修改集合内容的机制。如果当前正在迭代集合，然后有其他一些进程介入并插入，删除或更改该集合中的对象，则会出现此问题。也许在集合中已经遍历过了那个元素，也许还没有遍历到，也许在调用 <code>size()</code> 之后集合的大小会缩小…有许多灾难情景。 Java 集合库使用一种 <em>fail-fast</em> 的机制，该机制可以检测到除了当前进程引起的更改之外，其它任何对集合的更改操作。如果它检测到其他人正在修改集合，则会立即生成 <strong>ConcurrentModificationException</strong> 异常。这就是“fail-fast”的含义——它不会在以后使用更复杂的算法尝试检测问题（快速失败）。</p>
<p>通过创建迭代器并向迭代器指向的集合中添加元素，可以很容易地看到操作中的 fail-fast 机制，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/FailFast.java</span></span><br><span class="line"><span class="comment">// Demonstrates the "fail-fast" behavior</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FailFast</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection&lt;String&gt; c = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Iterator&lt;String&gt; it = c.iterator();</span><br><span class="line">    c.add(<span class="string">"An object"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      String s = it.next();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(ConcurrentModificationException e) &#123;</span><br><span class="line">      System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">java.util.ConcurrentModificationException</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>异常来自于在从集合中获得迭代器之后，又尝试在集合中添加元素。程序的两个部分可能会修改同一个集合，这种可能性的存在会产生不确定状态，因此异常会通知你更改代码。在这种情况下，应先将所有元素添加到集合，然后再获取迭代器。</p>
<p><strong>ConcurrentHashMap</strong> ， <strong>CopyOnWriteArrayList</strong> 和 <strong>CopyOnWriteArraySet</strong> 使用了特定的技术来避免产生 <strong>ConcurrentModificationException</strong> 异常。</p>
<!-- Holding References -->
<h2 id="持有引用"><a href="#持有引用" class="headerlink" title="持有引用"></a>持有引用</h2><p><strong>java.lang.ref</strong> 中库包含一组类，这些类允许垃圾收集具有更大的灵活性。特别是当拥有可能导致内存耗尽的大对象时，这些类特别有用。这里有三个从抽象类 <strong>Reference</strong> 继承来的类： <strong>SoftReference</strong> （软引用）， <strong>WeakReference</strong> （弱引用）和 <strong>PhantomReference</strong> （虚引用）继承了三个类。如果一个对象只能通过这其中的一个 <strong>Reference</strong> 对象访问，那么这三种类型每个都为垃圾收集器提供不同级别的间接引用（indirection）。</p>
<p>如果一个对象是 <em>可达的</em>（reachable），那么意味着在程序中的某个位置可以找到该对象。这可能意味着在栈上有一个直接引用该对象的普通引用，但也有可能是引用了一个对该对象有引用的对象，这可以有很多中间环节。如果某个对象是可达的，则垃圾收集器无法释放它，因为它仍然被程序所使用。如果某个对象是不可达的，则程序无法使用它，那么垃圾收集器回收该对象就是安全的。</p>
<p>使用 <strong>Reference</strong> 对象继续保持对该对象的引用，以到达该对象，但也允许垃圾收集器释放该对象。因此，程序可以使用该对象，但如果内存即将耗尽，则允许释放该对象。</p>
<p>可以通过使用 <strong>Reference</strong> 对象作为你和普通引用之间的中介（代理）来实现此目的。此外，必须没有对象的普通引用（未包含在 <strong>Reference</strong> 对象中的对象）。如果垃圾收集器发现对象可通过普通引用访问，则它不会释放该对象。</p>
<p>按照 <strong>SoftReference</strong> ， <strong>WeakReference</strong> 和 <strong>PhantomReference</strong> 的顺序，每个都比前一个更“弱”，并且对应于不同的可达性级别。软引用用于实现对内存敏感的缓存。弱引用用于实现“规范化映射”（ canonicalized mappings）——对象的实例可以在程序的多个位置同时使用，以节省存储，但不会阻止其键（或值）被回收。虚引用用于调度 pre-mortem 清理操作，这是一种比 Java 终结机制（Java finalization mechanism）更灵活的方式。</p>
<p>使用 <strong>SoftReference</strong> 和 <strong>WeakReference</strong> ，可以选择是否将它们放在 <strong>ReferenceQueue</strong> （用于 pre-mortem 清理操作的设备）中，但 <strong>PhantomReference</strong> 只能在 <strong>ReferenceQueue</strong> 上构建。下面是一个简单的演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/References.java</span></span><br><span class="line"><span class="comment">// Demonstrates Reference objects</span></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VeryBig</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">10000</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span>[] la = <span class="keyword">new</span> <span class="keyword">long</span>[SIZE];</span><br><span class="line">  <span class="keyword">private</span> String ident;</span><br><span class="line">  VeryBig(String id) &#123; ident = id; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> ident; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Finalizing "</span> + ident);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">References</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ReferenceQueue&lt;VeryBig&gt; rq =</span><br><span class="line">    <span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Reference&lt;? extends VeryBig&gt; inq = rq.poll();</span><br><span class="line">    <span class="keyword">if</span>(inq != <span class="keyword">null</span>)</span><br><span class="line">      System.out.println(<span class="string">"In queue: "</span> + inq.get());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// Or, choose size via the command line:</span></span><br><span class="line">    <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)</span><br><span class="line">      size = Integer.valueOf(args[<span class="number">0</span>]);</span><br><span class="line">    LinkedList&lt;SoftReference&lt;VeryBig&gt;&gt; sa =</span><br><span class="line">      <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">      sa.add(<span class="keyword">new</span> SoftReference&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> VeryBig(<span class="string">"Soft "</span> + i), rq));</span><br><span class="line">      System.out.println(</span><br><span class="line">        <span class="string">"Just created: "</span> + sa.getLast());</span><br><span class="line">      checkQueue();</span><br><span class="line">    &#125;</span><br><span class="line">    LinkedList&lt;WeakReference&lt;VeryBig&gt;&gt; wa =</span><br><span class="line">      <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">      wa.add(<span class="keyword">new</span> WeakReference&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> VeryBig(<span class="string">"Weak "</span> + i), rq));</span><br><span class="line">      System.out.println(</span><br><span class="line">        <span class="string">"Just created: "</span> + wa.getLast());</span><br><span class="line">      checkQueue();</span><br><span class="line">    &#125;</span><br><span class="line">    SoftReference&lt;VeryBig&gt; s =</span><br><span class="line">      <span class="keyword">new</span> SoftReference&lt;&gt;(<span class="keyword">new</span> VeryBig(<span class="string">"Soft"</span>));</span><br><span class="line">    WeakReference&lt;VeryBig&gt; w =</span><br><span class="line">      <span class="keyword">new</span> WeakReference&lt;&gt;(<span class="keyword">new</span> VeryBig(<span class="string">"Weak"</span>));</span><br><span class="line">    System.gc();</span><br><span class="line">    LinkedList&lt;PhantomReference&lt;VeryBig&gt;&gt; pa =</span><br><span class="line">      <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">      pa.add(<span class="keyword">new</span> PhantomReference&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> VeryBig(<span class="string">"Phantom "</span> + i), rq));</span><br><span class="line">      System.out.println(</span><br><span class="line">        <span class="string">"Just created: "</span> + pa.getLast());</span><br><span class="line">      checkQueue();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output: (First and Last 10 Lines)</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@15db9742</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@6d06d69c</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@7852e922</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@4e25154f</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@70dea4e</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@5c647e05</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@33909752</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@55f96302</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@3d4eac69</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.SoftReference@42a57993</span></span><br><span class="line"><span class="comment">...________...________...________...________...</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.PhantomReference@45ee12a7</span></span><br><span class="line"><span class="comment">In queue: null</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.PhantomReference@330bedb4</span></span><br><span class="line"><span class="comment">In queue: null</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.PhantomReference@2503dbd3</span></span><br><span class="line"><span class="comment">In queue: null</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.PhantomReference@4b67cf4d</span></span><br><span class="line"><span class="comment">In queue: null</span></span><br><span class="line"><span class="comment">Just created: java.lang.ref.PhantomReference@7ea987ac</span></span><br><span class="line"><span class="comment">In queue: null</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>当运行此程序（将输出重定向到文本文件以查看页面中的输出）时，将会看到对象是被垃圾收集了的，虽然仍然可以通过 <strong>Reference</strong> 对象访问它们（使用 <code>get()</code> 来获取实际的对象引用）。 还可以看到 <strong>ReferenceQueue</strong> 始终生成包含 <strong>null</strong> 对象的 <strong>Reference</strong> 。 要使用它，请从特定的 <strong>Reference</strong> 类继承，并为新类添加更多有用的方法。</p>
<!-- The WeakHashMap -->
<h3 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h3><p>集合类库中有一个特殊的 <strong>Map</strong> 来保存弱引用： <strong>WeakHashMap</strong> 。 此类可以更轻松地创建规范化映射。在这种映射中，可以通过仅仅创建一个特定值的实例来节省存储空间。当程序需要该值时，它会查找映射中的现有对象并使用它（而不是从头开始创建一个）。 该映射可以将值作为其初始化的一部分，但更有可能的是在需要时创建该值。</p>
<p>由于这是一种节省存储空间的技术，因此 <strong>WeakHashMap</strong> 允许垃圾收集器自动清理键和值，这是非常方便的。不能对放在 <strong>WeakHashMap</strong> 中的键和值做任何特殊操作，它们由 map 自动包装在 <strong>WeakReference</strong> 中。当键不再被使用的时候才允许清理，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/CanonicalMapping.java</span></span><br><span class="line"><span class="comment">// Demonstrates WeakHashMap</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String ident;</span><br><span class="line">  Element(String id) &#123; ident = id; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> ident; &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hashCode(ident);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> r <span class="keyword">instanceof</span> Element &amp;&amp;</span><br><span class="line">      Objects.equals(ident, ((Element)r).ident);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Finalizing "</span> +</span><br><span class="line">      getClass().getSimpleName() + <span class="string">" "</span> + ident);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Key</span> <span class="keyword">extends</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">  Key(String id) &#123; <span class="keyword">super</span>(id); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Value</span> <span class="keyword">extends</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">  Value(String id) &#123; <span class="keyword">super</span>(id); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CanonicalMapping</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">// Or, choose size via the command line:</span></span><br><span class="line">    <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)</span><br><span class="line">      size = Integer.valueOf(args[<span class="number">0</span>]);</span><br><span class="line">    Key[] keys = <span class="keyword">new</span> Key[size];</span><br><span class="line">    WeakHashMap&lt;Key,Value&gt; map =</span><br><span class="line">      <span class="keyword">new</span> WeakHashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">      Key k = <span class="keyword">new</span> Key(Integer.toString(i));</span><br><span class="line">      Value v = <span class="keyword">new</span> Value(Integer.toString(i));</span><br><span class="line">      <span class="keyword">if</span>(i % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">        keys[i] = k; <span class="comment">// Save as "real" references</span></span><br><span class="line">      map.put(k, v);</span><br><span class="line">    &#125;</span><br><span class="line">    System.gc();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Key</strong> 类必须具有 <code>hashCode()</code> 和 <code>equals()</code> ，因为它将被用作散列数据结构中的键。 <code>hashCode()</code> 的内容在<a href>附录：理解hashCode和equals方法</a>中进行了描述。</p>
<p>运行程序，你会看到垃圾收集器每三个键跳过一次。对该键的普通引用也被放置在 <strong>keys</strong> 数组中，因此这些对象不能被垃圾收集。</p>
<!-- Java 1.0/1.1 Collections -->
<h2 id="Java-1-0-1-1-的集合类"><a href="#Java-1-0-1-1-的集合类" class="headerlink" title="Java 1.0 / 1.1 的集合类"></a>Java 1.0 / 1.1 的集合类</h2><p>不幸的是，许多代码是使用 Java 1.0 / 1.1 中的集合编写的，甚至新代码有时也是使用这些类编写的。编写新代码时切勿使用旧集合。旧的集合类有限，所以关于它们的讨论不多。由于它们是不合时宜的，所以我会尽量避免过分强调一些可怕的设计决定。</p>
<!-- Vector & Enumeration -->
<h3 id="Vector-和-Enumeration"><a href="#Vector-和-Enumeration" class="headerlink" title="Vector 和 Enumeration"></a>Vector 和 Enumeration</h3><p>Java 1.0 / 1.1 中唯一的自扩展序列是 <strong>Vector</strong> ，因此它被用于很多地方。它的缺陷太多了，无法在这里描述（参见《Java编程思想》第1版，可从<a href="www.OnJava8.com">www.OnJava8.com</a>免费下载）。基本上，你可以将它看作是具有冗长且笨拙的方法名称的 <strong>ArrayList</strong> 。在修订后的 Java 集合库中，<strong>Vector</strong> 已经被调整适配过，因此可以作为 <strong>Collection</strong> 和 <strong>List</strong> 来使用。事实证明这有点不正常，集合类库仍然包含它只是为了支持旧的 Java 代码，但这会让一些人误以为 <strong>Vector</strong> 已经变得更好了。</p>
<p>迭代器的 Java 1.0 / 1.1 版本选择创建一个新名称“enumeration”，而不是使用每个人都熟悉的术语（“iterator”）。 <strong>Enumeration</strong> 接口小于 <strong>Iterator</strong> ，只包含两个方法，并且它使用更长的方法名称：如果还有更多元素，则 <code>boolean hasMoreElements()</code> 返回 <code>true</code> ， <code>Object nextElement()</code> 返回此enumeration的下一个元素 （否则会抛出异常）。</p>
<p><strong>Enumeration</strong> 只是一个接口，而不是一个实现，甚至新的类库有时仍然使用旧的 <strong>Enumeration</strong> ，这是不幸的，但通常是无害的。应该总是在自己的代码中使用 <strong>Iterator</strong> ，但要做好准备应对那些提供 <strong>Enumeration</strong> 的类库。</p>
<p>此外，可以使用 <code>Collections.enumeration()</code> 方法为任何 <strong>Collection</strong> 生成 <strong>Enumeration</strong> ，如下例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Enumerations.java</span></span><br><span class="line"><span class="comment">// Java 1.0/1.1 Vector and Enumeration</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> onjava.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Enumerations</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Vector&lt;String&gt; v =</span><br><span class="line">      <span class="keyword">new</span> Vector&lt;&gt;(Countries.names(<span class="number">10</span>));</span><br><span class="line">    Enumeration&lt;String&gt; e = v.elements();</span><br><span class="line">    <span class="keyword">while</span>(e.hasMoreElements())</span><br><span class="line">      System.out.print(e.nextElement() + <span class="string">", "</span>);</span><br><span class="line">    <span class="comment">// Produce an Enumeration from a Collection:</span></span><br><span class="line">    e = Collections.enumeration(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">ALGERIA, ANGOLA, BENIN, BOTSWANA, BURKINA FASO,</span></span><br><span class="line"><span class="comment">BURUNDI, CAMEROON, CAPE VERDE, CENTRAL AFRICAN</span></span><br><span class="line"><span class="comment">REPUBLIC, CHAD,</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>要生成 <strong>Enumeration</strong> ，可以调用 <code>elements()</code> ，然后可以使用它来执行向前迭代。</p>
<p>最后一行创建一个 <strong>ArrayList</strong> ，并使用 <code>enumeration()</code> 来将 <strong>ArrayList</strong> 适配为一个 <strong>Enumeration</strong> 。 因此，如果有旧代码需要使用 <strong>Enumeration</strong> ，你仍然可以使用新集合。</p>
<!-- Hashtable -->
<h3 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h3><p>正如你在本附录中的性能比较中所看到的，基本的 <strong>Hashtable</strong> 与 <strong>HashMap</strong> 非常相似，甚至方法名称都相似。在新代码中没有理由使用 <strong>Hashtable</strong> 而不是 <strong>HashMap</strong> 。</p>
<!-- Stack -->
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>之前使用 <strong>LinkedList</strong> 引入了栈的概念。 Java 1.0 / 1.1 <strong>Stack</strong> 的奇怪之处在于，不是以组合方式使用 <strong>Vector</strong> ，而是继承自 <strong>Vector</strong> 。 因此它具有 <strong>Vector</strong> 的所有特征和行为以及一些额外的 <strong>Stack</strong> 行为。很难去知道设计师是否有意识地认为这样做是有用的，或者它是否只是太天真了，无论如何，它在进入发行版之前显然没有经过审查，所以这个糟糕的设计仍然存在（但不要使用它）。</p>
<p>这是 <strong>Stack</strong> 的简单演示，向栈中放入枚举中每一个类型的 <strong>String</strong> 形式。它还展示了如何轻松地将 <strong>LinkedList</strong> 用作栈，或者使用在<a href>第十二章：集合</a>章节中创建的 <strong>Stack</strong> 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Stacks.java</span></span><br><span class="line"><span class="comment">// Demonstration of Stack Class</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Month &#123; JANUARY, FEBRUARY, MARCH, APRIL,</span><br><span class="line">  MAY, JUNE, JULY, AUGUST, SEPTEMBER,</span><br><span class="line">  OCTOBER, NOVEMBER &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stacks</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Stack&lt;String&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(Month m : Month.values())</span><br><span class="line">      stack.push(m.toString());</span><br><span class="line">    System.out.println(<span class="string">"stack = "</span> + stack);</span><br><span class="line">    <span class="comment">// Treating a stack as a Vector:</span></span><br><span class="line">    stack.addElement(<span class="string">"The last line"</span>);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">"element 5 = "</span> + stack.elementAt(<span class="number">5</span>));</span><br><span class="line">    System.out.println(<span class="string">"popping elements:"</span>);</span><br><span class="line">    <span class="keyword">while</span>(!stack.empty())</span><br><span class="line">      System.out.print(stack.pop() + <span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using a LinkedList as a Stack:</span></span><br><span class="line">    LinkedList&lt;String&gt; lstack = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(Month m : Month.values())</span><br><span class="line">      lstack.addFirst(m.toString());</span><br><span class="line">    System.out.println(<span class="string">"lstack = "</span> + lstack);</span><br><span class="line">    <span class="keyword">while</span>(!lstack.isEmpty())</span><br><span class="line">      System.out.print(lstack.removeFirst() + <span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using the Stack class from</span></span><br><span class="line">    <span class="comment">// the Collections Chapter:</span></span><br><span class="line">    onjava.Stack&lt;String&gt; stack2 =</span><br><span class="line">      <span class="keyword">new</span> onjava.Stack&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(Month m : Month.values())</span><br><span class="line">      stack2.push(m.toString());</span><br><span class="line">    System.out.println(<span class="string">"stack2 = "</span> + stack2);</span><br><span class="line">    <span class="keyword">while</span>(!stack2.isEmpty())</span><br><span class="line">      System.out.print(stack2.pop() + <span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">stack = [JANUARY, FEBRUARY, MARCH, APRIL, MAY, JUNE,</span></span><br><span class="line"><span class="comment">JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER]</span></span><br><span class="line"><span class="comment">element 5 = JUNE</span></span><br><span class="line"><span class="comment">popping elements:</span></span><br><span class="line"><span class="comment">The last line NOVEMBER OCTOBER SEPTEMBER AUGUST JULY</span></span><br><span class="line"><span class="comment">JUNE MAY APRIL MARCH FEBRUARY JANUARY lstack =</span></span><br><span class="line"><span class="comment">[NOVEMBER, OCTOBER, SEPTEMBER, AUGUST, JULY, JUNE, MAY,</span></span><br><span class="line"><span class="comment">APRIL, MARCH, FEBRUARY, JANUARY]</span></span><br><span class="line"><span class="comment">NOVEMBER OCTOBER SEPTEMBER AUGUST JULY JUNE MAY APRIL</span></span><br><span class="line"><span class="comment">MARCH FEBRUARY JANUARY stack2 = [NOVEMBER, OCTOBER,</span></span><br><span class="line"><span class="comment">SEPTEMBER, AUGUST, JULY, JUNE, MAY, APRIL, MARCH,</span></span><br><span class="line"><span class="comment">FEBRUARY, JANUARY]</span></span><br><span class="line"><span class="comment">NOVEMBER OCTOBER SEPTEMBER AUGUST JULY JUNE MAY APRIL</span></span><br><span class="line"><span class="comment">MARCH FEBRUARY JANUARY</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>String</strong> 形式是由 <strong>Month</strong> 中的枚举常量生成的，使用 <code>push()</code> 压入到栈中，然后使用 <code>pop()</code> 从栈顶部取出。为了说明一点，将 <strong>Vector</strong> 的操作也在 <strong>Stack</strong> 对象上执行， 这是可能的，因为凭借继承， <strong>Stack</strong> 是 <strong>Vector</strong> 。 因此，可以在 <strong>Vector</strong> 上执行的所有操作也可以在 <strong>Stack</strong> 上执行，例如 <code>elementAt()</code> 。</p>
<p>如前所述，在需要栈行为时使用 <strong>LinkedList</strong> ，或者从 <strong>LinkedList</strong> 类创建的 <strong>onjava.Stack</strong> 类。</p>
<!-- BitSet -->
<h3 id="BitSet"><a href="#BitSet" class="headerlink" title="BitSet"></a>BitSet</h3><p><strong>BitSet</strong> 用于有效地存储大量的开关信息。仅从尺寸大小的角度来看它是有效的，如果你正在寻找有效的访问，它比使用本机数组（native array）稍慢。</p>
<p>此外， <strong>BitSet</strong> 的最小大小是 <strong>long</strong> ：64位。这意味着如果你要存储更小的东西，比如8位， <strong>BitSet</strong> 就是浪费，如果尺寸有问题，你最好创建自己的类，或者只是用一个数组来保存你的标志。（只有在你创建许多包含开关信息列表的对象时才会出现这种情况，并且只应根据分析和其他指标来决定。如果你做出此决定只是因为您认为 <strong>BitSet</strong> 太大，那么最终会产生不必要的复杂性并且浪费大量时间。）</p>
<p>当添加更多元素时，普通集合会扩展， <strong>BitSet</strong>也会这样做。以下示例显示了 <strong>BitSet</strong> 的工作原理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collectiontopics/Bits.java</span></span><br><span class="line"><span class="comment">// Demonstration of BitSet</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bits</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printBitSet</span><span class="params">(BitSet b)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"bits: "</span> + b);</span><br><span class="line">    StringBuilder bbits = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; b.size() ; j++)</span><br><span class="line">      bbits.append(b.get(j) ? <span class="string">"1"</span> : <span class="string">"0"</span>);</span><br><span class="line">    System.out.println(<span class="string">"bit pattern: "</span> + bbits);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line">    <span class="comment">// Take the LSB of nextInt():</span></span><br><span class="line">    <span class="keyword">byte</span> bt = (<span class="keyword">byte</span>)rand.nextInt();</span><br><span class="line">    BitSet bb = <span class="keyword">new</span> BitSet();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">      <span class="keyword">if</span>(((<span class="number">1</span> &lt;&lt; i) &amp;  bt) != <span class="number">0</span>)</span><br><span class="line">        bb.set(i);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        bb.clear(i);</span><br><span class="line">    System.out.println(<span class="string">"byte value: "</span> + bt);</span><br><span class="line">    printBitSet(bb);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> st = (<span class="keyword">short</span>)rand.nextInt();</span><br><span class="line">    BitSet bs = <span class="keyword">new</span> BitSet();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">15</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">      <span class="keyword">if</span>(((<span class="number">1</span> &lt;&lt; i) &amp;  st) != <span class="number">0</span>)</span><br><span class="line">        bs.set(i);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        bs.clear(i);</span><br><span class="line">    System.out.println(<span class="string">"short value: "</span> + st);</span><br><span class="line">    printBitSet(bs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> it = rand.nextInt();</span><br><span class="line">    BitSet bi = <span class="keyword">new</span> BitSet();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">31</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">      <span class="keyword">if</span>(((<span class="number">1</span> &lt;&lt; i) &amp;  it) != <span class="number">0</span>)</span><br><span class="line">        bi.set(i);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        bi.clear(i);</span><br><span class="line">    System.out.println(<span class="string">"int value: "</span> + it);</span><br><span class="line">    printBitSet(bi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test bitsets &gt;= 64 bits:</span></span><br><span class="line">    BitSet b127 = <span class="keyword">new</span> BitSet();</span><br><span class="line">    b127.set(<span class="number">127</span>);</span><br><span class="line">    System.out.println(<span class="string">"set bit 127: "</span> + b127);</span><br><span class="line">    BitSet b255 = <span class="keyword">new</span> BitSet(<span class="number">65</span>);</span><br><span class="line">    b255.set(<span class="number">255</span>);</span><br><span class="line">    System.out.println(<span class="string">"set bit 255: "</span> + b255);</span><br><span class="line">    BitSet b1023 = <span class="keyword">new</span> BitSet(<span class="number">512</span>);</span><br><span class="line">    b1023.set(<span class="number">1023</span>);</span><br><span class="line">    b1023.set(<span class="number">1024</span>);</span><br><span class="line">    System.out.println(<span class="string">"set bit 1023: "</span> + b1023);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">byte value: -107</span></span><br><span class="line"><span class="comment">bits: &#123;0, 2, 4, 7&#125;</span></span><br><span class="line"><span class="comment">bit pattern: 101010010000000000000000000000000000000000</span></span><br><span class="line"><span class="comment">0000000000000000000000</span></span><br><span class="line"><span class="comment">short value: 1302</span></span><br><span class="line"><span class="comment">bits: &#123;1, 2, 4, 8, 10&#125;</span></span><br><span class="line"><span class="comment">bit pattern: 011010001010000000000000000000000000000000</span></span><br><span class="line"><span class="comment">0000000000000000000000</span></span><br><span class="line"><span class="comment">int value: -2014573909</span></span><br><span class="line"><span class="comment">bits: &#123;0, 1, 3, 5, 7, 9, 11, 18, 19, 21, 22, 23, 24,</span></span><br><span class="line"><span class="comment">25, 26, 31&#125;</span></span><br><span class="line"><span class="comment">bit pattern: 110101010101000000110111111000010000000000</span></span><br><span class="line"><span class="comment">0000000000000000000000</span></span><br><span class="line"><span class="comment">set bit 127: &#123;127&#125;</span></span><br><span class="line"><span class="comment">set bit 255: &#123;255&#125;</span></span><br><span class="line"><span class="comment">set bit 1023: &#123;1023, 1024&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>随机数生成器用于创建随机 <strong>byte</strong> ， <strong>short</strong> 和 <strong>int</strong> ，并且每个都在 <strong>BitSet</strong> 中转换为相应的位模式。这样可以正常工作，因为 <strong>BitSet</strong> 是64位，所以这些都不会导致它的大小增加，然后创建更大的 <strong>BitSet</strong> 。 请注意， <strong>BitSet</strong> 会根据需要进行扩展。</p>
<p>对于可以命名的固定标志集， <strong>EnumSet</strong> （参见<a href>第二十二章：枚举</a>章节）通常比 <strong>BitSet</strong> 更好，因为 <strong>EnumSet</strong> 允许操作名称而不是数字位位置，从而可以减少错误。 <strong>EnumSet</strong> 还可以防止意外地添加新的标记位置，这可能会导致一些严重的，难以发现的错误。使用 <strong>BitSet</strong> 而不是 <strong>EnumSet</strong> 的唯一原因是，不知道在运行时需要多少标志，或者为标志分配名称是不合理的，或者需要 <strong>BitSet</strong> 中的一个特殊操作（请参阅 <strong>BitSet</strong> 和 <strong>EnumSet</strong> 的 JDK 文档）。</p>
<!-- Summary -->
<h2 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h2><p>集合可以说是编程语言中最常用的工具。有些语言（例如Python）甚至将基本集合组件（列表，映射和集合）作为内置函数包含在其中。</p>
<p>正如在<a href>第十二章：集合</a>章节中看到的那样，可以使用集合执行许多非常有用的操作，而不需要太多努力。但是，在某些时候，为了正确地使用它们而不得不更多地了解集合，特别是，必须充分了解散列操作以编写自己的 <code>hashCode()</code> 方法（并且必须知道何时需要），并且你必须充分了解各种集合实现，以根据你的需求选择合适的集合。本附录涵盖了这些概念，并讨论了有关集合库的其他有用详细信息。你现在应该已经准备好在日常编程任务中使用 Java 集合了。</p>
<p>集合库的设计很困难（大多数库设计问题都是如此）。在 C++ 中，集合类涵盖了许多不同类的基础。这比之前可用的 C++ 集合类更好，但它没有很好地转换为 Java 。在另一个极端，我看到了一个由单个类“collection”组成的集合库，它同时充当线性序列和关联数组。 Java 集合库试图在功能和复杂性之间取得平衡。结果在某些地方看起来有点奇怪。与早期 Java 库中的一些决策不同，这些奇怪的不是事故，而是在基于复杂性的权衡下而仔细考虑的决策。</p>
<p>[^1]: <strong>java.util</strong> 中的 <strong>Map</strong> 使用 <strong>Map</strong> 的 <code>getKey()</code> 和 <code>getValue()</code> 执行批量复制，因此这是有效的。如果自定义 <strong>Map</strong> 只是复制整个 <strong>Map.Entry</strong> ，那么这种方法就会出现问题。</p>
<p>[^2]: 虽然当我用这种方式描述它的时候听起来很奇怪而且好像没什么用处，但在<a href>第十九章 类型信息</a>章节中已经看到过，这种动态行为也可以非常强大有用。</p>
<p>[^3]: 如果这些加速仍然无法满足性能需求，则可以通过编写自己的 <strong>Map</strong> 并将其自定义为特定类型来进一步加速表查找，以避免因向 <strong>对象</strong> 转换而导致的延迟。为了达到更高的性能水平，速度爱好者可以使用 Donald Knuth 的《计算机程序设计艺术（第3卷）：排序与查找》（第二版），将溢出桶列表（overflow bucket lists）替换为具有两个额外优势的阵列：它们可以针对磁盘存储进行优化，并且它们可以节省大部分创建和回收个别记录（individual records）的时间。</p>
<!-- 分页 -->
<div style="page-break-after: always;"></div>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/01/3/3_book/OnJava8/24-Concurrent-Programming/" rel="next" title="第二十四章 并发编程">
                <i class="fa fa-chevron-left"></i> 第二十四章 并发编程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/01/3/3_book/OnJava8/Appendix-Low-Level-Concurrency/" rel="prev" title="附录:并发底层原理">
                附录:并发底层原理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="kay wu">
          <p class="site-author-name" itemprop="name">kay wu</p>
           
              <p class="site-description motion-element" itemprop="description">给时间以生命，而不是给生命以时间</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">168</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Minato262" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      Github
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#附录-集合主题"><span class="nav-text">附录:集合主题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#示例数据"><span class="nav-text">示例数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List行为"><span class="nav-text">List行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set行为"><span class="nav-text">Set行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在Map中使用函数式操作"><span class="nav-text">在Map中使用函数式操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#选择Map片段"><span class="nav-text">选择Map片段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#填充集合"><span class="nav-text">填充集合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Suppliers-填充集合"><span class="nav-text">使用 Suppliers 填充集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Map-Suppliers"><span class="nav-text">Map Suppliers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用享元（Flyweight）自定义Collection和Map"><span class="nav-text">使用享元（Flyweight）自定义Collection和Map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合功能"><span class="nav-text">集合功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可选操作"><span class="nav-text">可选操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#不支持的操作"><span class="nav-text">不支持的操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set和存储顺序"><span class="nav-text">Set和存储顺序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SortedSet"><span class="nav-text">SortedSet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#队列"><span class="nav-text">队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优先级队列"><span class="nav-text">优先级队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#双端队列"><span class="nav-text">双端队列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#理解Map"><span class="nav-text">理解Map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#性能"><span class="nav-text">性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SortedMap"><span class="nav-text">SortedMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedHashMap"><span class="nav-text">LinkedHashMap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合工具类"><span class="nav-text">集合工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#排序和搜索列表"><span class="nav-text">排序和搜索列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建不可修改的-Collection-或-Map"><span class="nav-text">创建不可修改的 Collection 或 Map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#同步-Collection-或-Map"><span class="nav-text">同步 Collection 或 Map</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Fail-Fast"><span class="nav-text">Fail Fast</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#持有引用"><span class="nav-text">持有引用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WeakHashMap"><span class="nav-text">WeakHashMap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-1-0-1-1-的集合类"><span class="nav-text">Java 1.0 / 1.1 的集合类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vector-和-Enumeration"><span class="nav-text">Vector 和 Enumeration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hashtable"><span class="nav-text">Hashtable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack"><span class="nav-text">Stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BitSet"><span class="nav-text">BitSet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本章小结"><span class="nav-text">本章小结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kay wu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
